---
title: Postgres Distributed (PGD) presets on BigAnimal
navTitle: PGD presets on BigAnimal
deepToC: true
---

## Commit scope

[Commit scopes](../../../pgd/latest/durability/commit-scopes.mdx) in PGD is a set of rules that describes the behavior of the system as transactions are committed. Because they define how transactions are replicated across a distributed database, they impact consistency and reliability.

The actual behavior depends on which kind of commit scope a commit scope's rule uses: [Group Commit](), Commit At Most Once, Lag Control, Synchronous Commit, or a combination of these.

Customizing these settings can be complex, presenting a challenge for users. 

### BigAnimal's commit_scope preset options

BigAnimal's commit scope presets simplify managing commit scopes in PGD. These presets balance customization with ease of use, allowing users to enjoy PGD's benefits without the complexity of manual configurations:

| Preset ID | Local group         | External groups     | Use Case                             |
|-----------|---------------------|--------------------|--------------------------------------|
| ba001     | MAJORITY, SYNCHRONOUS_COMMIT  | N/A                | High consistency for critical data   |
| ba002     | ALL, LAG_CONTROL         | ALL, LAG_CONTROL        | Manages replication lag locally and externally |
| ba003     | MAJORITY, SYNCHRONOUS_COMMIT  | ALL LAG_CONTROL        | Combines high consistency for local with lag control for external|
| ba004     | MAJORITY, SYNCHRONOUS_COMMIT  | ANY 1, SYNCHRONOUS COMMIT | High consistency with external validation |

!!! Note
ba001 is also the only BigAnimal preset that works with single or multi-grouped PGD clusters. The rest, ba002-ba004, work for multi-grouped PGD clusters only.
!!!



### ba001

ba001 offers a default setup that optimizes data consistency and reliability across distributed environments. This is the baseline BigAnimal provided commit_scope and is the commit_scope for all new sub-groups:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba001_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location-a) SYNCHRONOUS_COMMIT',
    wait_for_ready := true
);
```

The rule says that for any transaction originating from a certain subgroup of nodes (those in location-a), the majority of the nodes in that subgroup (those in location-a) must acknowledge the transaction before it is committed.

ba001 utilizes the `MAJORITY`, instead of `ALL` so that in the case of 3 data nodes, the third is asynchronous. This allows for a node failure without interrupting the single region service. 

To make this commit_scope the default_commit_scope for the node group, use the following command:

```sql
SELECT bdr.alter_node_group_option(
  node_group_name := 'location-a',
  config_key := 'default_commit_scope',
  config_value := 'ba001_location-a'
);
```

### ba002

ba002 is a lag control scope intended to provide additional control over replication lag, offering an alternative approach to synchronous commit by allowing for asynchronous behavior with lag control. To define ba002:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba002_location-a',
    origin_node_group := 'location-a',
    rule := 'ALL (location_a) LAG_CONTROL (max_commit_delay=1s, max_lag_size=100MB) AND ALL NOT (location_a) LAG_CONTROL (max_lag_size=1000MB, max_commit_delay=4s, max_lag_time=30s)',
    wait_for_ready := true
);
```

The first part of the rule says that for `ALL` nodes of location_a, which is the origin_node_group in this case, monitor transactions for lag according to 

`max_commit_delay=1s` effectively means that the minimum transaction rate Lag Control allows is `max_connections per` second(as each transaction process sleeps at most 1s when there is lag).

ba002's comprehensive approach, integrating ALL and NOT with specific lag control measures, positions it as a robust alternative for managing data replication with enhanced precision. This preset not only aims to maintain high data integrity by requiring unanimous node agreement but also offers sophisticated control over replication lag, ensuring optimal transaction rates and system responsiveness.

### ba003

ba003 is a combination of synchronous commit and lag control, ba001 and ba002. 

To configure ba003, use the following:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba003_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location_a) SYNCHRONOUS_COMMIT AND ANY 1 NOT (location_a) LAG_CONTROL (max_lag_size=1000MB, max_commit_delay=4s, max_lag_time=30s)',
    wait_for_ready := true
);
```

ba003, like [ba001](#ba001) utilizes `MAJORITY` instead of `ALL` so that in cases where there are 3 data nodes, the third is asynchronous and allows for a node failure without interrupting the single region service. Also, like ba001, ba003 uses `SYNCHRONOUS_COMMIT` to ensure high levels of data consistency by requiring confirmation from a specified number of nodes before a transaction is considered committed.

It then expands on this durability introduced in ba001 by adding lag control, which reigns in the amount of acceptable data loss in case of regional failure. 


### ba004

ba004 is a durability-oriented BigAnimal-provided commit_scope. 

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba004_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location_a) SYNCHRONOUS_COMMIT AND ANY 1 NOT (location_a) SYNCHRONOUS_COMMIT',
    wait_for_ready := true
);
```

Just as in [ba001](#ba001) and [ba003](#ba003), ba004 uses `SYNCHRONOUS_COMMIT` to keep potential data loss at near zero, as the data is replicated before commit success is signaled to the application. Again, `MAJORITY` is used so that in a three-node scenario in a region, one node can experience failure without compromising the cluster.

However, in ba004, durability increases over ba001 due to the utilization of `NOT` allowing for the requiring of confirmation outside of the subgroup.



<!-- Why BigAnimal's management of commit scope matters. Discuss the strategic advantage of using BigAnimal's managed commit scopes. Explain how it supports business objectives like recovery point objectives (RPO).

<!-- Conclusion - Recap the importance of understanding commit scopes within PGD on BigAnimal. Encourage customers to explore further or contact support for deeper insights. -->





<!-- ## Security presets -->

<!-- ## Peformance and optimization presets -->

<!-- ## Backup and recovery presets -->

<!-- ## Scaling and resource management presets -->


