---
title: Postgres Distributed (PGD) presets on BigAnimal
navTitle: PGD presets on BigAnimal
deepToC: true
---

## Commit scope

[Commit scopes](../../../pgd/latest/durability/commit-scopes.mdx) in PGD is a set of rules that describes the behavior of the system as transactions are committed. Because they define how transactions are replicated across a distributed database, they impact consistency and reliability.

The actual behavior depends on which kind of commit scope a commit scope's rule uses: [Group Commit](), Commit At Most Once, Lag Control, Synchronous Commit, or a combination of these.

Customizing these settings can be complex, presenting a challenge for users. 

### BigAnimal's commit_scope preset options

BigAnimal's commit scope presets simplify managing commit scopes in PGD. These presets balance customization with ease of use, allowing users to enjoy PGD's benefits without the complexity of manual configurations:

| Preset ID | Local group         | External groups     | Use Case                             |
|-----------|---------------------|--------------------|--------------------------------------|
| ba001     | MAJORITY, SYNCHRONOUS_COMMIT  | N/A                | High consistency for critical data   |
| ba002     | ALL, LAG_CONTROL         | ALL, LAG_CONTROL        | Manages replication lag locally and externally |
| ba003     | MAJORITY, SYNCHRONOUS_COMMIT  | ALL, LAG_CONTROL        | Combines high consistency locally with lag control for external|
| ba004     | MAJORITY, SYNCHRONOUS_COMMIT  | ANY 1, SYNCHRONOUS COMMIT | Higher consistency via external validation |

!!! Note
ba001 is also the only BigAnimal preset that works with single-grouped PGD clusters. All of them, including ba001, work with multi-grouped clusters.
!!!

### ba001

ba001 offers a default setup that optimizes data consistency and reliability across distributed environments. Here is an example definition for a group of nodes, `location-a`:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba001_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location-a) SYNCHRONOUS_COMMIT',
    wait_for_ready := true
);
```

The rule says that for transactions originating from a node in `location-a`, the majority of the nodes in `location-a` must acknowledge the transaction before it is committed.

ba001 uses `MAJORITY` instead of `ALL` so that in the case of 3 data nodes, the third can be updated asynchronously. This allows for a node failure without interrupting a single region service. 

This is the baseline BigAnimal provided commit_scope and is the commit_scope for all new sub-groups.

### ba002

ba002 allows for asynchronous behavior but with lag control for tighter consistency (that is, tighter than the default asynchronous behavior) across the distributed system. An example definition of ba002 for nodes in `location-a` looks like the following:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba002_location-a',
    origin_node_group := 'location-a',
    rule := 'ALL (location-a) LAG_CONTROL (max_commit_delay=1s, max_lag_size=100MB) AND ALL NOT (location-a) LAG_CONTROL (max_lag_size=1000MB, max_commit_delay=4s, max_lag_time=30s)',
    wait_for_ready := true
);
```

The first part of the rule says that for all nodes of location_a, which is the `origin_node_group` in this case, nodes in `location-a` are monitored according to `max_lag_size=100MB` and `max_commit_delay=1s`. Specifically, as lag size approaches the set max of 100MB, the system begins injecting commit delays on the origin node of up to 1 second so that replication to the other node(s) in the group can catch up.

The second part of the rule (after the `AND`) says that for all nodes not in `location_a`, those nodes are monitored according to `max_lag_size=1000MB`, `max_lag_time=30s`and `max_commit_delay=4s`. Specifically, as lag size or time approaches either of their respective limits (1000MB or 30s), the system begins injecting commit delays on the origin node of up to 4 seconds so that replication to those nodes outside the origin node group can catch up.

### ba003

ba003 is a combination of SYNCHRNOUS_COMMIT for the local group with LAG_CONTROL parameters met by at least one external node.

To configure ba003, use the following:

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba003_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location_a) SYNCHRONOUS_COMMIT AND ANY 1 NOT (location_a) LAG_CONTROL (max_lag_size=1000MB, max_commit_delay=4s, max_lag_time=30s)',
    wait_for_ready := true
);
```

The first part of the rule states that for any transaction originating on a node in the `origin_node_group` (in this case `location-a`), a majority of the nodes in `location_a` must confirm the transaction before it is committed. 

The second part of the rule states that at least one node not in `location_a` must keep lag within the LAG_CONTROL parameters (max_lag_size=1000MB, max_lag_time=30s) with respect to its replicating transactions originating from a node in the origin_node_group (here location_a), or a commit delays of up to 4 seconds will be used to slow down processing on the originating node to allow for the lagging node to catch up.


### ba004

```sql
SELECT bdr.add_commit_scope(
    commit_scope_name := 'ba004_location-a',
    origin_node_group := 'location-a',
    rule := 'MAJORITY (location_a) SYNCHRONOUS_COMMIT AND ANY 1 NOT (location_a) SYNCHRONOUS_COMMIT',
    wait_for_ready := true
);
```

ba004 says that for all transactions originating from a node in the `origin_node_group` (in the above example `location-a`), a majority of the nodes of `location-a`, and at least one node not in `location-a`, must confirm the transaction before it is committed.

Just as in [ba001](#ba001) and [ba003](#ba003), ba004 uses `SYNCHRONOUS_COMMIT` to keep potential data loss at near zero, as the data is replicated before commit success is signaled to the application. Again, `MAJORITY` is used so that in a three-node scenario in a region, one node can experience failure without compromising the cluster. However, in this case the commit scope also requires confirmation from one node outside the cluster to be confirmed.

### Setting default_commit_scope

To make a commit_scope the default_commit_scope for the node group, use the following command:

```sql
SELECT bdr.alter_node_group_option(
  node_group_name := '<node_group_name>',
  config_key := 'default_commit_scope',
  config_value := '<commit_scope_name>'
);
```











<!-- Why BigAnimal's management of commit scope matters. Discuss the strategic advantage of using BigAnimal's managed commit scopes. Explain how it supports business objectives like recovery point objectives (RPO).

<!-- Conclusion - Recap the importance of understanding commit scopes within PGD on BigAnimal. Encourage customers to explore further or contact support for deeper insights. -->





<!-- ## Security presets -->

<!-- ## Peformance and optimization presets -->

<!-- ## Backup and recovery presets -->

<!-- ## Scaling and resource management presets -->


