# Packages

-   [klio.enterprisedb.io/v1alpha1](#klioenterprisedbiov1alpha1)

## klio.enterprisedb.io/v1alpha1

Package v1alpha1 contains API Schema definitions for the klio v1alpha1 API group.

### Resource Types

-   [PluginConfiguration](#pluginconfiguration)
-   [Server](#server)

#### BaseConfiguration

BaseConfiguration defines the configuration for the base server.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                   | Description                                                             | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- | -------- | ------- | ---------- |
| `resources` *[ResourceRequirements](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#resourcerequirements-v1-core)* | Resources defines the resource requirements for the Kopia server        |          |         |            |
| `adminUser` *[LocalObjectReference](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#localobjectreference-v1-core)* | AdminUser is a reference to a secret of type 'kubernetes.io/basic-auth' |          |         |            |

#### CacheConfiguration

CacheConfiguration defines the configuration for the cache directory.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                               | Description | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | -------- | ------- | ---------- |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#persistentvolumeclaimspec-v1-core)* |             | True     |         |            |

#### DataConfiguration

DataConfiguration defines the configuration for the data directory.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                               | Description                                                                                                                         | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#persistentvolumeclaimspec-v1-core)* | Template to be used to generate the Persistent Volume Claim needed for the data folder,<br />containing base backups and WAL files. | True     |         |            |

#### PluginConfiguration

PluginConfiguration is the Schema for the client configuration API.

| Field                                                                                                              | Description                                                     | Required | Default | Validation |
| ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------- | -------- | ------- | ---------- |
| `apiVersion` *string*                                                                                              | `klio.enterprisedb.io/v1alpha1`                                 | True     |         |            |
| `kind` *string*                                                                                                    | `PluginConfiguration`                                           | True     |         |            |
| `metadata` *[ObjectMeta](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#objectmeta-v1-meta)* | Refer to Kubernetes API documentation for fields of `metadata`. | True     |         |            |
| `spec` *[PluginConfigurationSpec](#pluginconfigurationspec)*                                                       |                                                                 | True     |         |            |
| `status` *[PluginConfigurationStatus](#pluginconfigurationstatus)*                                                 |                                                                 |          |         |            |

#### PluginConfigurationSpec

PluginConfigurationSpec defines the desired state of client configuration.

*Appears in:*

-   [PluginConfiguration](#pluginconfiguration)

| Field                                                                                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Required | Default | Validation                             |
| ------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ------- | -------------------------------------- |
| `serverAddress` *string*                                                                                                 | ServerAddress is the address of the Klio server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `tier2` *boolean*                                                                                                        | Tier2 enables backup lookup in tier 2.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | True     |         |                                        |
| `clientSecretName` *string*                                                                                              | ClientSecretName is the name of the secret containing the client credentials                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `serverSecretName` *string*                                                                                              | ServerSecretName is the name of the secret containing the server TLS certificate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `clusterName` *string*                                                                                                   | ClusterName is the name of the PostgreSQL cluster we are connecting to                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |          |         |                                        |
| `pprof` *boolean*                                                                                                        | Pprof enables the pprof endpoint for performance profiling                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |          |         |                                        |
| `retention` *[RetentionPolicy](#retentionpolicy)*                                                                        | RetentionPolicy defines how many backups we should keep                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |          |         |                                        |
| `containers` *[Container](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#container-v1-core) array* | Containers allows defining a list of containers that will be merged with the Klio sidecar containers.<br />This enables users to customize the sidecars with additional environment variables, volume mounts,<br />resource limits, and other container settings without polluting the PostgreSQL container environment.<br />Merge behavior:<br />- Containers are matched by name (klio-plugin, klio-wal, klio-restore)<br />- User customizations serve as the base<br />- Klio required values (name, args, CONTAINER_NAME env var) always override user values<br />- User-defined environment variables and volume mounts are preserved<br />- Template defaults are applied only for fields not set by the user or Klio |          |         | MaxItems: 3 <br />                     |

#### PluginConfigurationStatus

PluginConfigurationStatus defines the observed state of ClientConfig.

*Appears in:*

-   [PluginConfiguration](#pluginconfiguration)

#### QueueConfiguration

QueueConfiguration defines the configuration for the directory hosting the
task queue.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                               | Description                                                                                                  | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | -------- | ------- | ---------- |
| `resources` *[ResourceRequirements](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#resourcerequirements-v1-core)*             | QueueResources defines the resource requirements for the NATS server                                         |          |         |            |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#persistentvolumeclaimspec-v1-core)* | PersistentVolumeClaimTemplate is used to generate the configuration for<br />the PVC hosting the work queue. | True     |         |            |

#### RetentionPolicy

RetentionPolicy defines how many backups we should keep.

*Appears in:*

-   [PluginConfigurationSpec](#pluginconfigurationspec)

| Field                   | Description                                                        | Required | Default | Validation |
| ----------------------- | ------------------------------------------------------------------ | -------- | ------- | ---------- |
| `keepLatest` *integer*  | KeepLatest is the number of latest backups to keep<br />optional   | True     |         |            |
| `keepAnnual` *integer*  | KeepAnnual is the number of annual backups to keep<br />optional   | True     |         |            |
| `keepMonthly` *integer* | KeepMonthly is the number of monthly backups to keep<br />optional | True     |         |            |
| `keepWeekly` *integer*  | KeepWeekly is the number of weekly backups to keep<br />optional   | True     |         |            |
| `keepDaily` *integer*   | KeepDaily is the number of daily backups to keep<br />optional     | True     |         |            |
| `keepHourly` *integer*  | KeepHourly is the number of hourly backups to keep<br />optional   | True     |         |            |

#### S3Configuration

S3Configuration is the configuration to a S3 defined tier 2.

*Appears in:*

-   [Tier2Configuration](#tier2configuration)

| Field                                                             | Description                                                                                   | Required | Default | Validation |
| ----------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `bucketName` *string*                                             | BucketName is the name of the bucket                                                          | True     |         |            |
| `prefix` *string*                                                 | Prefix is the prefix to be used for the stored files                                          |          |         |            |
| `endpoint` *string*                                               | Endpoint is the endpoint to be used                                                           |          |         |            |
| `region` *string*                                                 | Region is the region to be used                                                               |          |         |            |
| `walEncryptionPassword` *[SecretKeySelector](#secretkeyselector)* | WALEncryptionPassword is a pointer to the key in a secret containing the encryption password. | True     |         |            |
| `accessKeyId` *[SecretKeySelector](#secretkeyselector)*           | The S3 access key ID                                                                          |          |         |            |
| `secretAccessKey` *[SecretKeySelector](#secretkeyselector)*       | The S3 access key                                                                             |          |         |            |
| `sessionToken` *[SecretKeySelector](#secretkeyselector)*          | The S3 session token                                                                          |          |         |            |
| `customCaBundle` *[SecretKeySelector](#secretkeyselector)*        | A pointer to a custom CA bundle                                                               |          |         |            |

#### Server

Server is the Schema for the servers API.

| Field                                                                                                              | Description                                                     | Required | Default | Validation |
| ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------- | -------- | ------- | ---------- |
| `apiVersion` *string*                                                                                              | `klio.enterprisedb.io/v1alpha1`                                 | True     |         |            |
| `kind` *string*                                                                                                    | `Server`                                                        | True     |         |            |
| `metadata` *[ObjectMeta](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#objectmeta-v1-meta)* | Refer to Kubernetes API documentation for fields of `metadata`. | True     |         |            |
| `spec` *[ServerSpec](#serverspec)*                                                                                 |                                                                 | True     |         |            |
| `status` *[ServerStatus](#serverstatus)*                                                                           |                                                                 |          |         |            |

#### ServerSpec

ServerSpec defines the desired state of Server.

*Appears in:*

-   [Server](#server)

| Field                                                                                                                                                | Description                                                                                                                                                                                                                                                                                                                               | Required | Default      | Validation |
| ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------------ | ---------- |
| `baseConfiguration` *[BaseConfiguration](#baseconfiguration)*                                                                                        | BaseConfiguration is the configuration of the Kopia server                                                                                                                                                                                                                                                                                |          |              |            |
| `image` *string*                                                                                                                                     | Image is the image to be used for the Klio server                                                                                                                                                                                                                                                                                         | True     |              |            |
| `imagePullPolicy` *[PullPolicy](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#pullpolicy-v1-core)*                            | ImagePullPolicy defines the policy for pulling the image                                                                                                                                                                                                                                                                                  |          | IfNotPresent |            |
| `imagePullSecrets` *[LocalObjectReference](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#localobjectreference-v1-core) array* | ImagePullSecrets is an optional list of references to secrets in the same namespace to use for pulling any of the<br />images                                                                                                                                                                                                             |          |              |            |
| `tlsSecretName` *string*                                                                                                                             | TLSSecretName is the name of the Kubernetes secret containing the server-side certificate<br />to be used for the Klio server.                                                                                                                                                                                                            | True     |              |            |
| `caSecretName` *string*                                                                                                                              | ClientCASecretName is the name of the Kubernetes secret containing the CA certificate<br />to be used by the Klio server to validate the users.                                                                                                                                                                                           | True     |              |            |
| `resources` *[ResourceRequirements](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#resourcerequirements-v1-core)*              | Resources defines the resource requirements for the Klio server                                                                                                                                                                                                                                                                           |          |              |            |
| `cacheConfiguration` *[CacheConfiguration](#cacheconfiguration)*                                                                                     | CacheConfiguration is the configuration of the PVC that should be<br />used for the cache                                                                                                                                                                                                                                                 | True     |              |            |
| `dataConfiguration` *[DataConfiguration](#dataconfiguration)*                                                                                        | DataConfiguration is the configuration of the PVC that should be used<br />for the base backups                                                                                                                                                                                                                                           | True     |              |            |
| `queueConfiguration` *[QueueConfiguration](#queueconfiguration)*                                                                                     | QueueConfiguration is the configuration of the PVC that should host<br />the task queue.                                                                                                                                                                                                                                                  |          |              |            |
| `password` *[SecretKeySelector](#secretkeyselector)*                                                                                                 | Password is a reference to a secret containing the Klio password                                                                                                                                                                                                                                                                          | True     |              |            |
| `tier2` *[Tier2Configuration](#tier2configuration)*                                                                                                  | Tier2 is the Tier 2 configuration                                                                                                                                                                                                                                                                                                         | True     |              |            |
| `template` *[PodTemplateSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.32/#podtemplatespec-v1-core)*                         | Template to override the default StatefulSet of the Klio server.<br />WARNING: Modifying this template may break the server functionality if not done carefully.<br />This field is primarily intended for advanced configuration such as telemetry setup.<br />Use at your own risk and ensure thorough testing before applying changes. |          |              |            |

#### ServerStatus

ServerStatus defines the observed state of Server.

*Appears in:*

-   [Server](#server)

#### Tier2Configuration

Tier2Configuration is the tier 2 configuration.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                      | Description                                                     | Required | Default | Validation |
| ------------------------------------------ | --------------------------------------------------------------- | -------- | ------- | ---------- |
| `s3` *[S3Configuration](#s3configuration)* | S3 contains the configuration parameters for an S3-based tier 2 | True     |         |            |
