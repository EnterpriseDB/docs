# Packages

-   [klio.enterprisedb.io/v1alpha1](#klioenterprisedbiov1alpha1)

## klio.enterprisedb.io/v1alpha1

Package v1alpha1 contains API Schema definitions for the klio v1alpha1 API group.

### Resource Types

-   [PluginConfiguration](#pluginconfiguration)
-   [Server](#server)

#### Cache

Cache defines the configuration for the cache directory.

*Appears in:*

-   [Tier1Configuration](#tier1configuration)
-   [Tier2Configuration](#tier2configuration)

| Field                                                                                                                                               | Description | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | -------- | ------- | ---------- |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#persistentvolumeclaimspec-v1-core)* |             | True     |         |            |

#### Data

Data defines the configuration for the data directory.

*Appears in:*

-   [Tier1Configuration](#tier1configuration)

| Field                                                                                                                                               | Description                                                                                                                         | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#persistentvolumeclaimspec-v1-core)* | Template to be used to generate the Persistent Volume Claim needed for the data folder,<br />containing base backups and WAL files. | True     |         |            |

#### ImageConfiguration

ImageConfiguration contains the information needed to download
the Klio image.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                                | Description                                                                                                                   | Required | Default      | Validation          |
| ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | -------- | ------------ | ------------------- |
| `image` *string*                                                                                                                                     | Image is the image to be used for the Klio server                                                                             | True     |              |                     |
| `imagePullPolicy` *[PullPolicy](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#pullpolicy-v1-core)*                            | ImagePullPolicy defines the policy for pulling the image                                                                      |          | IfNotPresent | Optional: {} <br /> |
| `imagePullSecrets` *[LocalObjectReference](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#localobjectreference-v1-core) array* | ImagePullSecrets is an optional list of references to secrets in the same namespace to use for pulling any of the<br />images |          |              | Optional: {} <br /> |

#### PluginConfiguration

PluginConfiguration is the Schema for the client configuration API.

| Field                                                                                                              | Description                                                     | Required | Default | Validation          |
| ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------- | -------- | ------- | ------------------- |
| `apiVersion` *string*                                                                                              | `klio.enterprisedb.io/v1alpha1`                                 | True     |         |                     |
| `kind` *string*                                                                                                    | `PluginConfiguration`                                           | True     |         |                     |
| `metadata` *[ObjectMeta](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#objectmeta-v1-meta)* | Refer to Kubernetes API documentation for fields of `metadata`. | True     |         |                     |
| `spec` *[PluginConfigurationSpec](#pluginconfigurationspec)*                                                       |                                                                 | True     |         |                     |
| `status` *[PluginConfigurationStatus](#pluginconfigurationstatus)*                                                 |                                                                 |          |         | Optional: {} <br /> |

#### PluginConfigurationSpec

PluginConfigurationSpec defines the desired state of client configuration.

*Appears in:*

-   [PluginConfiguration](#pluginconfiguration)

| Field                                                                                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Required | Default | Validation                             |
| ------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ------- | -------------------------------------- |
| `serverAddress` *string*                                                                                                 | ServerAddress is the address of the Klio server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `tier1` *[Tier1PluginConfiguration](#tier1pluginconfiguration)*                                                          | Tier1 is the Tier 1 configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |          |         | Optional: {} <br />                    |
| `tier2` *[Tier2PluginConfiguration](#tier2pluginconfiguration)*                                                          | Tier2 is the Tier 2 configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |          |         | Optional: {} <br />                    |
| `clientSecretName` *string*                                                                                              | ClientSecretName is the name of the secret containing the client credentials                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `serverSecretName` *string*                                                                                              | ServerSecretName is the name of the secret containing the server TLS certificate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | True     |         | MinLength: 1 <br />Required: {} <br /> |
| `clusterName` *string*                                                                                                   | ClusterName is the name of the PostgreSQL cluster we are connecting to                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |          |         | Optional: {} <br />                    |
| `pprof` *boolean*                                                                                                        | Pprof enables the pprof endpoint for performance profiling                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |          |         | Optional: {} <br />                    |
| `containers` *[Container](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#container-v1-core) array* | Containers allows defining a list of containers that will be merged with the Klio sidecar containers.<br />This enables users to customize the sidecars with additional environment variables, volume mounts,<br />resource limits, and other container settings without polluting the PostgreSQL container environment.<br />Merge behavior:<br />- Containers are matched by name (klio-plugin, klio-wal, klio-restore)<br />- User customizations serve as the base<br />- Klio required values (name, args, CONTAINER_NAME env var) always override user values<br />- User-defined environment variables and volume mounts are preserved<br />- Template defaults are applied only for fields not set by the user or Klio |          |         | MaxItems: 3 <br />Optional: {} <br />  |

#### PluginConfigurationStatus

PluginConfigurationStatus defines the observed state of ClientConfig.

*Appears in:*

-   [PluginConfiguration](#pluginconfiguration)

#### Queue

Queue defines the configuration for the directory hosting the
task queue.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                                                                                                               | Description                                                                                                  | Required | Default | Validation |
| --------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | -------- | ------- | ---------- |
| `pvcTemplate` *[PersistentVolumeClaimSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#persistentvolumeclaimspec-v1-core)* | PersistentVolumeClaimTemplate is used to generate the configuration for<br />the PVC hosting the work queue. | True     |         |            |

#### RetentionPolicy

RetentionPolicy defines how many backups we should keep.

*Appears in:*

-   [Tier1PluginConfiguration](#tier1pluginconfiguration)
-   [Tier2PluginConfiguration](#tier2pluginconfiguration)

| Field                   | Description                                                        | Required | Default | Validation |
| ----------------------- | ------------------------------------------------------------------ | -------- | ------- | ---------- |
| `keepLatest` *integer*  | KeepLatest is the number of latest backups to keep<br />optional   | True     |         |            |
| `keepAnnual` *integer*  | KeepAnnual is the number of annual backups to keep<br />optional   | True     |         |            |
| `keepMonthly` *integer* | KeepMonthly is the number of monthly backups to keep<br />optional | True     |         |            |
| `keepWeekly` *integer*  | KeepWeekly is the number of weekly backups to keep<br />optional   | True     |         |            |
| `keepDaily` *integer*   | KeepDaily is the number of daily backups to keep<br />optional     | True     |         |            |
| `keepHourly` *integer*  | KeepHourly is the number of hourly backups to keep<br />optional   | True     |         |            |

#### S3Configuration

S3Configuration is the configuration to a S3 defined tier 2.

*Appears in:*

-   [Tier2Configuration](#tier2configuration)

| Field                                                       | Description                                          | Required | Default | Validation          |
| ----------------------------------------------------------- | ---------------------------------------------------- | -------- | ------- | ------------------- |
| `bucketName` *string*                                       | BucketName is the name of the bucket                 | True     |         |                     |
| `prefix` *string*                                           | Prefix is the prefix to be used for the stored files |          |         | Optional: {} <br /> |
| `endpoint` *string*                                         | Endpoint is the endpoint to be used                  |          |         | Optional: {} <br /> |
| `region` *string*                                           | Region is the region to be used                      |          |         | Optional: {} <br /> |
| `accessKeyId` *[SecretKeySelector](#secretkeyselector)*     | The S3 access key ID                                 |          |         | Optional: {} <br /> |
| `secretAccessKey` *[SecretKeySelector](#secretkeyselector)* | The S3 access key                                    |          |         | Optional: {} <br /> |
| `sessionToken` *[SecretKeySelector](#secretkeyselector)*    | The S3 session token                                 |          |         | Optional: {} <br /> |
| `customCaBundle` *[SecretKeySelector](#secretkeyselector)*  | A pointer to a custom CA bundle                      |          |         | Optional: {} <br /> |

#### Server

Server is the Schema for the servers API.

| Field                                                                                                              | Description                                                     | Required | Default | Validation          |
| ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------- | -------- | ------- | ------------------- |
| `apiVersion` *string*                                                                                              | `klio.enterprisedb.io/v1alpha1`                                 | True     |         |                     |
| `kind` *string*                                                                                                    | `Server`                                                        | True     |         |                     |
| `metadata` *[ObjectMeta](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#objectmeta-v1-meta)* | Refer to Kubernetes API documentation for fields of `metadata`. | True     |         |                     |
| `spec` *[ServerSpec](#serverspec)*                                                                                 |                                                                 | True     |         |                     |
| `status` *[ServerStatus](#serverstatus)*                                                                           |                                                                 |          |         | Optional: {} <br /> |

#### ServerSpec

ServerSpec defines the desired state of Server.

*Appears in:*

-   [Server](#server)

| Field                                                                                                                                                | Description                                                                                                                                                                                                                                                                                                                               | Required | Default      | Validation          |
| ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------------ | ------------------- |
| `image` *string*                                                                                                                                     | Image is the image to be used for the Klio server                                                                                                                                                                                                                                                                                         | True     |              |                     |
| `imagePullPolicy` *[PullPolicy](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#pullpolicy-v1-core)*                            | ImagePullPolicy defines the policy for pulling the image                                                                                                                                                                                                                                                                                  |          | IfNotPresent | Optional: {} <br /> |
| `imagePullSecrets` *[LocalObjectReference](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#localobjectreference-v1-core) array* | ImagePullSecrets is an optional list of references to secrets in the same namespace to use for pulling any of the<br />images                                                                                                                                                                                                             |          |              | Optional: {} <br /> |
| `tlsSecretName` *string*                                                                                                                             | TLSSecretName is the name of the Kubernetes secret containing the server-side certificate<br />to be used for the Klio server.                                                                                                                                                                                                            | True     |              |                     |
| `caSecretName` *string*                                                                                                                              | ClientCASecretName is the name of the Kubernetes secret containing the CA certificate<br />to be used by the Klio server to validate the users.                                                                                                                                                                                           | True     |              |                     |
| `tier1` *[Tier1Configuration](#tier1configuration)*                                                                                                  | Tier1 is the Tier 1 configuration                                                                                                                                                                                                                                                                                                         | True     |              |                     |
| `tier2` *[Tier2Configuration](#tier2configuration)*                                                                                                  | Tier2 is the Tier 2 configuration                                                                                                                                                                                                                                                                                                         | True     |              |                     |
| `queue` *[Queue](#queue)*                                                                                                                            | Queue is the configuration of the PVC that should host<br />the task queue.                                                                                                                                                                                                                                                               |          |              | Optional: {} <br /> |
| `template` *[PodTemplateSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.35/#podtemplatespec-v1-core)*                         | Template to override the default StatefulSet of the Klio server.<br />WARNING: Modifying this template may break the server functionality if not done carefully.<br />This field is primarily intended for advanced configuration such as telemetry setup.<br />Use at your own risk and ensure thorough testing before applying changes. |          |              | Optional: {} <br /> |

#### ServerStatus

ServerStatus defines the observed state of Server.

*Appears in:*

-   [Server](#server)

#### TLSConfiguration

TLSConfiguration contains the information needed to configure
the PKI infrastructure of the Klio server.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                    | Description                                                                                                                                     | Required | Default | Validation |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `tlsSecretName` *string* | TLSSecretName is the name of the Kubernetes secret containing the server-side certificate<br />to be used for the Klio server.                  | True     |         |            |
| `caSecretName` *string*  | ClientCASecretName is the name of the Kubernetes secret containing the CA certificate<br />to be used by the Klio server to validate the users. | True     |         |            |

#### Tier1Configuration

Tier1Configuration is the tier 1 configuration.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                     | Description                                                                        | Required | Default | Validation |
| --------------------------------------------------------- | ---------------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `cache` *[Cache](#cache)*                                 | Cache is the configuration of the PVC that should be<br />used for the cache       | True     |         |            |
| `data` *[Data](#data)*                                    | Data is the configuration of the PVC that should be used<br />for the base backups | True     |         |            |
| `encryptionKey` *[SecretKeySelector](#secretkeyselector)* | EncryptionKey is a reference to a secret containing the Klio password              | True     |         |            |

#### Tier1PluginConfiguration

Tier1PluginConfiguration configures tier1 backup and recovery settings.

*Appears in:*

-   [PluginConfigurationSpec](#pluginconfigurationspec)

| Field                                             | Description                                             | Required | Default | Validation          |
| ------------------------------------------------- | ------------------------------------------------------- | -------- | ------- | ------------------- |
| `retention` *[RetentionPolicy](#retentionpolicy)* | RetentionPolicy defines how many backups we should keep |          |         | Optional: {} <br /> |

#### Tier2Configuration

Tier2Configuration is the tier 2 configuration.

*Appears in:*

-   [ServerSpec](#serverspec)

| Field                                                     | Description                                                                  | Required | Default | Validation |
| --------------------------------------------------------- | ---------------------------------------------------------------------------- | -------- | ------- | ---------- |
| `cache` *[Cache](#cache)*                                 | Cache is the configuration of the PVC that should be<br />used for the cache | True     |         |            |
| `s3` *[S3Configuration](#s3configuration)*                | S3 contains the configuration parameters for an S3-based tier 2              | True     |         |            |
| `encryptionKey` *[SecretKeySelector](#secretkeyselector)* | EncryptionKey is a reference to a secret containing the Klio password        | True     |         |            |

#### Tier2PluginConfiguration

Tier2PluginConfiguration configures tier2 backup and recovery settings.

*Appears in:*

-   [PluginConfigurationSpec](#pluginconfigurationspec)

| Field                                             | Description                                                                          | Required | Default | Validation          |
| ------------------------------------------------- | ------------------------------------------------------------------------------------ | -------- | ------- | ------------------- |
| `enableBackup` *boolean*                          | EnableBackup controls whether WAL and base backups should be stored in tier2         |          |         | Optional: {} <br /> |
| `enableRecovery` *boolean*                        | EnableRecovery controls whether tier2 should be included in the recovery source list |          |         | Optional: {} <br /> |
| `retention` *[RetentionPolicy](#retentionpolicy)* | RetentionPolicy defines how many backups we should keep                              |          |         | Optional: {} <br /> |
