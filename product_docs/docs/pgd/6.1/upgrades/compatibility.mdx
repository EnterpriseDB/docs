---
title: Compatibility changes
---

## Summary

There are some changes in PGD 6.1 that are not compatible with 5.8.1 and other previous versions.

## Connection Manager 

PGD 6 introduces a new Connection Manager which replaces the PGD 5's proxy solution with a tightly integrated approach using a background worker to expose read-write, read-only and http-status network interfaces in PGD. 
For more details check [here](/pgd/latest/reference/connection-manager/%3E).

CM opens 2 ports, one for read-write connections (by default 6432) and one for read-only connections (by default 6433).
These automatically route the sessions to the correct nodes according to the routing configuration.
The read-only connections only allow read-only transactions.

CM performs session-level pooling in 6.1 and handles the authentication and TLS termination directly using the CM endpoints.
The `pg_hba.conf` rules, `ssl_cert_file, and `ssl_key_file` are all used automatically.
The supported authentication methods include: reject, trust, md5, scram, and PAM.

In `bdr.stat_activity` there are new columns named `connection_manager_client_addr` and `connection_manager_client_port` which expose the client address connected to CM (as standard `client_addr` will show the address of the node the client is connected through) and also `session_read_only` column which indicates whether the session is read-only.
There are several additional views showing the number of connected clients to CM on the current node and which nodes the connections are routed to.

When `%r` or `%h` is used in `log_line_prefix`, both the `client_addr` and the `connection_manager_client_addr` are logged, showing both which node the client is connected through and the real client address.

CM logs to the Postgres log.

CM also optionally exposes an http(s) interface (port 8080 by default), which provides liveness check, info about whether the node is read-write or read-only (or neither) and some information about routing.

## DDL behavior

### Locking changes

There is a new global lock type, `ddl_locking = leader` that's used by PGD 6.1 by default instead of the global DML lock.
This lock ensures that a table is exclusively locked on all group leaders (as opposed to all nodes).
For PGD Essential this means that in practice the lock is engaged immediately as there is only one leader, which means the system exhibits the same behavior as a single node Postgres setup.

`LOCK TABLE` and `TRUNCATE TABLE` now use this new lock type by default (before the default behavior was to not lock outside of the origin node).

These locking changes are not backward compatible with 5.8.1 or older versions.

## Join/part behavior

### Sequences conversion

When creating a PGD cluster, existing sequences are automatically converted to distributed ones.
This is not backwards compatible with 5.8.1 or older versions.

### Parting a node drops it

When a node is parted, it is eventually dropped and the node will not be seen in the `PARTED` state at the end of the parting.
Therefore, scripts that wait for the node to reach `PARTED` state may need change.
Parting can also take longer than earlier versions since this operation waits till the group slot on all crosses of the last transaction from the parting node to ensure consistency.

This behavior is not backward compatible with 5.8.1 or older versions.

## Other

### Replica identity

Replica identity defaults to FULL now.
This removes some edge cases in conflict detection between inserts, updates, and deletes across node crashes and recovery.
This is not backwards compatible with PGD 5.8.1 or older versions.

### Run on (all) writes

Run on (all) writes is now not replicated.
The `bdr.xact_replicate` is set to `off` by default, reducing possible accidental issues with replication of commands sent via the run on (all) nodes command.

### General UI improvements

- Workers renamed to not contain 'pglogical' (this is not backwards compatible with 5.81 or previous versions)
- Previously deprecated configuration parameters (GUCs) now removed (this includes, for example, all the pglogical prefixed GUCsâ€”this is not backwards compatible with PGD 5.8.1 or older versions).
- Conflicts are logged neither to Postgres log or `conflict_history` table by default (this is not backwards compatible with PGD 5.8.1 or older versions)

