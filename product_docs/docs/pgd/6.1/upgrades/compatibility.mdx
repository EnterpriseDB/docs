---
title: Compatibility changes
---

Many changes in PGD 6.1 aren't backward compatible with PGD 5, PGD 4, or PGD 3.7.

## **PGD Essential and PGD Expanded**
We now offer two variants of PGD, the Essential and Expanded.

## Routing with Connection Manager
A new built-in [Connection Manager](../reference/connection-manager/overview) replaces PGD 4.x HARP Proxy and PGD 5.x proxy solution with a tightly integrated approach. The connection manager automatically runs on every data node. Move to this connection manager while upgrading to 6.x.


## **New compared to PGD 5.7** 
- When `%r` or `%h` is used in `log_line_prefix`, both the `client_addr` and the `connection_manager_client_addr` are logged, showing both which node the client is connected through and the real client address. 
- Connection manager logs to the Postgres log.
- The connection manager also optionally exposes an http(s) interface (port 8080 by default), which provides liveness check, info about whether the node is read-write, or read-only (or neither) and some information about routing.
- There are no more proxies, and the Connection Manager is configurable via group options.

### **DDL behavior**

#### **Table rewrites are now supported**

ALTER TABLE which needs to rewrite table (i.e. some forms of data type change) now works. The rewrite is replicated similarly to table sync, so even non-immutable expressions are replicated correctly.

#### **Locking changes** 

There is a new global lock type thatâ€™s used by PGD 6.0 by default instead of the global DML lock. This lock ensures that a table is exclusively locked on all group leaders (as opposed to all nodes). For PGD Essential this in practice means that the lock is taken immediately as there is only one leader, which means the same behavior as a single node Postgres.

`LOCK TABLE` and `TRUNCATE TABLE` now use this new lock type by default.  Previously, the default behavior was to not lock outside the origin node.

#### **Tablespace commands are replicated**

Tablespace commands are replicated with PGD 6.

#### **Database commands are replicated**

Database commands are replicated with PGD 6.

#### **Role replication includes the same SCRAM key**

This means that, for example, pgbouncer can use SCRAM authentication, unlike with previous versions of PGD.

#### **`CREATE INDEX CONCURRENTLY` and `REINDEX CONCURRENTLY` are streamed to replicas**

These two commands are streamed as they are executed, reducing the time needed to replicate them by half.

## **Join/part behavior**

### **Sequences are automatically converted to distributed ones** 

When creating a PGD cluster, existing sequences are automatically converted to distributed ones.

### **Roles are synchronized by logical join**

No need to predefine roles when adding a node.

### **Tablespaces are synchronized by logical join**

### **Nodes have UUIDs**

Nodes now have UUIDs, which are used for slot and origin names for more consistent identification across node name reuse.

## **CLI**

### **New `pgd node init` command**

This command will initialize the PGD node. Initialization means either create new cluster/group if the specified one does not exist, or joining the group, using the best method supported in given the configuration.

### **Tiered tables**

Tiered tables are GA in PGD 6.

## **Other**

### **Predefined commit scopes**

In PGD 6 when cluster is created, it contains four predefined commit scopes:

* **local protect** \- ensures data is on disk on local node, does not wait for replication  
  * ASYNCHRONOUS COMMIT  
* **lag protect** \- tries to keep lag within 30s within the majority of the PGD group, slows down ingest when the lag starts closing to that target  
  * MAJORITY ORIGIN GROUP LAG CONTROL (max_lag_time = 30s, max_commit_delay = 10s)  
* **majority protect** \- ensure the majority of the PGD group confirms the replication of the transaction before considering it committed  
  * MAJORITY ORIGIN GROUP SYNCHRONOUS COMMIT  
* **adaptive protect** \- similar to majority protect, but if the majority cannot be reached within 10s, degrades to local protect as long as the node is still a write leader  
  * MAJORITY ORIGIN GROUP SYNCHRONOUS COMMIT DEGRADE ON (timeout = 10s, require_write_lead = true) TO ASYNCHRONOUS COMMIT

### **Replica identity defaults to FULL** 

This removes some edge cases in conflict detection between inserts, updates and deletes across node crashes and recovery.

### **Run on (all) nodes writes not replicated**

The `bdr.xact_replicate` is set to off by default, reducing possible accidental issues with replication of commands sent via the run on (all) nodes command. 

### **General UI improvements**

- Worker types in `pg_stat_activity_view`  
- Workers renamed to not contain pglogical  
- Custom wait events for every wait in the extension (previously only about half was covered)  
- Reduced some internal log messages to debug level to avoid confusing users  
- Past deprecated configuration parameters (GUCs) now removed (that includes for example all the pglogical prefixed ones)  
- Conflicts are not logged to Postgres log by default