---
title: Step 4 - Configuring the cluster
navTitle: Configuring
deepToC: true
---

## Configuring the cluster

The next step in the process is to configure the database and the cluster.

This involves logging into each host and running the `pgd` command to create the cluster as the database user.

These steps will vary according to which platform you are using and which version of Postgres you are using.

## Cluster name

You will need to choose a name for your cluster. This is the name that will be used to identify the cluster in the PGD CLI and in the database. It will be referred to as `<cluster-name>` in the examples. If not specified, the default name is `pgd`.

## Group names

You will also need to choose a name for the group. This is the name that will be used to identify the group in the PGD CLI and in the database. It will be referred to as `<group-name>` in the examples.

The group name must be unique within the cluster.

## Node names

You will also need to choose a name for each node. This is the name that will be used to identify the node in the PGD CLI and in the database. It will be referred to as `<node-name>` in the examples. This is separate from the host name, which is the name of the machine on which the node is running.

The node name must be unique within the group and within the cluster.

## Paths and users

The paths and users used in the examples will vary according to which version of Postgres you are using and which platform you are using.

<TabContainer>

<Tab title="EDB Postgres Advanced Server" active>

<TabContainer syncKey="platform">
<Tab title="Debian/Ubuntu">

|                           |                                     |
|---------------------------|-------------------------------------|
| Postgres User               | `enterprisedb`                      |
| Postgres Port               | `5444`                              |
| Postgres Executable files | `/usr/lib/edb-as/$PG_VERSION/bin/`    |
| Postgres Data Directory   | `/var/lib/edb-as/$PG_VERSION/main/` |

```shell
sudo --preserve-env=PG_VERSION -iu enterprisedb
export PATH=$PATH:/usr/lib/edb-as/$PG_VERSION/bin/
export PGDATA=/var/lib/edb-as/$PG_VERSION/main/
export PGPORT=5444
```

</Tab>
<Tab title="CentOS/RHEL" active>    

|                           |                                    |
|---------------------------|------------------------------------|
| Postgres User               | `enterprisedb`                     |
| Postgres Port               | `5444`                             |
| Postgres Executable files | `/usr/edb/as$PG_VERSION/bin/`      |
| Postgres Data Directory   | `/var/lib/edb/as$PG_VERSION/data/` |

```shell
sudo --preserve-env=PG_VERSION -iu enterprisedb
export PATH=$PATH:/usr/edb/as$PG_VERSION/bin/
export PGDATA=/var/lib/edb/as$PG_VERSION/data/
export PGPORT=5444
```

</Tab>
</TabContainer>
</Tab>
<Tab title="EDB Postgres Extended">


<TabContainer syncKey="platform">
<Tab title="Debian/Ubuntu">

|                           |                                      |
|---------------------------|--------------------------------------|
| Postgres User               | `postgres`                           |
| Postgres Port               | `5432`                               |
| Postgres Executable files | `/usr/lib/edb-pge/$PG_VERSION/bin/`  |
| Postgres Data Directory   | `/var/lib/edb-pge/$PG_VERSION/main/` |

```shell
sudo --preserve-env=PG_VERSION -iu postgres
export PATH=$PATH:/usr/lib/edb-pge/$PG_VERSION/bin/
export PGDATA=/var/lib/edb-pge/$PG_VERSION/main/
export PGPORT=5432
```

</Tab>
<Tab title="CentOS/RHEL" active>

|                           |                                      |
|---------------------------|--------------------------------------|
| Postgres User               | `postgres`                           |
| Postgres Port               | `5432`                               |
| Postgres Executable files | `/usr/edb/pge$PG_VERSION/bin/`       |
| Postgres Data Directory   | `/var/lib/edb-pge/$PG_VERSION/data/` |

```shell
sudo --preserve-env=PG_VERSION -iu postgres
export PATH=$PATH:/usr/edb/pge$PG_VERSION/bin/
export PGDATA=/var/lib/edb-pge/$PG_VERSION/data/
export PGPORT=5432
```

</Tab>
</TabContainer>
</Tab>
<Tab title="Community PostgreSQL">
<br/><br/><br/>


!!! note Not available

<br/><br/>


Community PostgreSQL is only operable with PGD Expanded.

<br/><br/>


!!!

<br/><br/><br/><br/>
</Tab>
</TabContainer>

## On each host

1. Log in as the database user and set the environment variables. Copy and paste the scripts above to login and set required environment variables. In the scripts above: 
   - The `PG_VERSION` variable is set to the version of Postgres you are using (we assume you have set this in the previous step and use the `--preserve-env` option of sudo to preserve its setting when switching users.).
   - The `PGPORT` variable is set to the port number for the database.
   - The `PGDATA` variable is set to the data directory for the database. The `PATH` variable is set to include the Postgres executable files.

2. Set the `PGPASSWORD` environment variable to the password for the database user. This is required for the `pgd` command to connect to the database.
    ```bash
    export PGPASSWORD=<db-password>
    ```
    This is the password for the database user. In the examples, the password is `secret`.

1. Run the pgd node setup command

### On the first host

The first host in the cluster is also the first node and will be where we begin the cluster creation.
On the first host, run the following command to create the cluster:

```bash
pgd node <first-node-name> setup --dsn "host=<first-host> user=<db-user> port=<db-port> dbname=<dbname>" --group-name <group-name>
```

This command will create the data directory and initialize the database, then will create the cluster and the group on the first node.

### On the second host

On the second host, run the following command to create the cluster:

```bash
pgd node <second-node-name> setup --dsn "host=<second-host> user=<db-user> port=<db-port> dbname=<db-name>" --cluster-dsn "host=<first-host> user=<db-user> port=<db-port> dbname=<db-name>"
```

This command will create the node on the second host, and then join the cluster using the cluster-dsn setting to connect to the first host.

### On the third host

On the third host, run the following command to create the cluster:

```bash
pgd node <third-node-name> setup --dsn "host=<third-host> user=<db-user> port=<db-port> dbname=<db-name>" --cluster-dsn "host=<first-host> user=<db-user> port=<db-port> dbname=<db-name>"
```

This command will create the node on the third host, and then join the cluster using the cluster-dsn setting to connect to the first host.

## Worked example

In this example, we will configure the PGD Essential cluster with EDB Postgres Extended Server 17 on a CentOS/RHEL system that we [configured](02-configure-repository) and [installed](03-installing-database-and-pgd) in the previous steps.

We will now create a cluster called `pgd` with three nodes called `node-1`, `node-2`, and `node-3`.

* The group name will be `group-1`. The hosts are `host-1`, `host-2`, and `host-3`.
* The Postgres version is 17.
* The database user is `postgres`.
* The database port is 5432.
* The database name is `pgddb`.
* The Postgres executable files are in `/usr/edb/pge17/bin/`.
* The Postgres data directory is in `/var/lib/edb-pge/17/main/`.
* The Postgres password is `secret`.

(Note that we assume the Postgres version environment variable PG_VERSION is set to `17` from the previous step, and that we are preserving the environment variable when switching users.)

#### On the first host

```bash
sudo --preserve-env=PG_VERSION -iu postgres
export PATH=$PATH:/usr/edb/pge$PG_VERSION/bin/
export PGDATA=/var/lib/edb-pge/$PG_VERSION/data/
export PGPASSWORD=secret
pgd node node-1 setup "host=host-1 user=postgres port=5432 dbname=pgddb" --group-name group-1
```

#### On the second host

```bash
sudo --preserve-env=PG_VERSION -iu postgres
export PATH=$PATH:/usr/edb/pge$PG_VERSION/bin/
export PGDATA=/var/lib/edb-pge/$PG_VERSION/data/
export PGPASSWORD=secret
pgd node node-2 setup "host=host-2 user=postgres port=5432 dbname=pgddb" --cluster-dsn "host=host-1 user=postgres port=5432 dbname=pgddb"
```

#### On the third host

```bash
sudo --preserve-env=PG_VERSION -iu postgres
export PATH=$PATH:/usr/edb/pge$PG_VERSION/bin/
export PGDATA=/var/lib/edb-pge/$PG_VERSION/data/
export PGPASSWORD=secret
pgd node node-3 setup "host=host-3 user=postgres port=5432 dbname=pgddb" --cluster-dsn "host=host-1 user=postgres port=5432 dbname=pgddb"
```
