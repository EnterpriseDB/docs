---
title: "Manually Deploying PGD Essential Near-Far Architecture"
navTitle: Manual Near-Far Deployments
description: How to manually deploy the PGD Essential Near-Far Architecture.
---

The following instructions describe how to manually deploy the PGD Essential Near-Far architecture. This architecture is designed for a single location that needs to be reasonably highly available and needs to be able to recover from a disaster. It does this by having a two data node cluster in the primary location and a single data node in a secondary location.

In this guide, we will use the `pgd` command line tool to create the cluster and configure the nodes. The instructions assume that you have already installed PGD Essential and have access to the `pgd` command line tool. 

We will refer to the primary location as the `active` location and the secondary location as the `dr` location.

## PGD Configuration

The primary location is configured with two data nodes, in their own group "active". This location will be where the majority of the client connections will be made.

The secondary location is configured with one data node, in its own group "dr".

They are all members of the same cluster.

Once created with pgd-cli, the routing and fencing of the nodes needs to be configured.

First, we disable the routing on both the "active" and "dr" groups.

```shell
pgd group dr set-option enable_routing off --dsn "host=localhost port=5432 dbname=pgddb user=pgdadmin"
pgd group active set-option enable_routing off --dsn "host=localhost port=5432 dbname=pgddb user=pgdadmin"
```

Then we should enable the routing on the "pgd" top-level group.

```shell
pgd group pgd set-option enable_routing on --dsn "host=localhost port=5432 dbname=pgddb user=pgdadmin"
```

Finally, we enable the fencing on the "dr" group.

```shell
pgd group dr set-option enable_fencing on --dsn "host=localhost port=5432 dbname=pgddb user=pgdadmin"
```

This will ensure that the "dr" group is fenced off from the other nodes in the cluster and does not receive client connections by default.
The "active" group will continue to operate normally and will continue to replicate data to the "dr" group.

