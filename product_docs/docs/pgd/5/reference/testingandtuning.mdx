---
title: Testing and tuning commands
navTitle: Testing and tuning
indexdepth: 2
---

EDB Postgres Distributed has tools which help with testing and tuning of your PGD clusters. For background, read the [Testing and Tuning](../testingandtuning) section.


## `pgd_bench`

### Synopsis

A benchmarking tool for PGD enhanced PostgreSQL.

```shell
pgd_bench [OPTION]... [DBNAME] [DBNAME2]
```

`DBNAME` may be a conninfo string of the format:
  `"host=10.1.1.2 user=postgres dbname=master"`

Consult the [Testing and Tuning - Pgd_bench](../testingandtuning#pgd_bench)] section for examples
of `pgd_bench` options and usage.

### Options

`pgd_bench` specific options include:

#### Setting mode

`-m` or `--mode`

Which can be set to `regular`, `camo`, or `failover`. It defaults to `regular`.

* regular &mdash; Only a single node is needed to run `pgd_bench`
* camo &mdash; A second node must be specified to act as the camo partner
* failover &mdash; A second node must be specified to act as the failover.

When using `-m failover`, an additional option `--retry` is available. This will
instruct `pgd_bench` to retry transactions when there is a failover. The `--retry` 
option is automatically enabled with `-m camo`.

#### Setting GUC variables

 `-o` or `--set-option`
 
This option is followed by `NAME=VALUE` entries, which will be applied using the 
Postgresql [`SET`](https://www.postgresql.org/docs/current/sql-set.html) command on each server, and only those servers, that `pgd_bench` connects to. 

The other options are identical to the Community PostgreSQL `pgbench`. For more
details, consult the [official documentation on
`pgbench`](https://www.postgresql.org/docs/current/pgbench.html).

We list all the options (`pgd_bench` and `pgbench`) below for completeness.

#### Initialization options:
-   `-i, --initialize`  &mdash; invokes initialization mode
-   `-I, --init-steps=[dtgGvpf]+` (default `"dtgvp"`)  &mdash; run selected initialization steps
    -   `d`  &mdash; drop any existing `pgbench` tables
    -   `t`  &mdash; create the tables used by the standard `pgbench` scenario
    -   `g`  &mdash; generate data client-side and load it into the standard tables, replacing any data already present
    -   `G`  &mdash; generate data server-side and load it into the standard tables, replacing any data already present
    -   `v`  &mdash; invoke `VACUUM` on the standard tables
    -   `p`  &mdash; create primary key indexes on the standard tables
    -   `f`  &mdash; create foreign key constraints between the standard tables
-   `-F, --fillfactor=NUM` &mdash; set fill factor
-   `-n, --no-vacuum` &mdash; do not run `VACUUM` during initialization
-   `-q, --quiet` &mdash; quiet logging (one message each 5 seconds)
-   `-s, --scale=NUM` &mdash; scaling factor
-   `--foreign-keys` &mdash; create foreign key constraints between tables
-   `--index-tablespace=TABLESPACE` &mdash; create indexes in the specified tablespace
-   `--partition-method=(range|hash)` &mdash; partition `pgbench_accounts` with this method (default: range)
-   `--partitions=NUM` &mdash; partition `pgbench_accounts` into `NUM` parts (default: 0)
-   `--tablespace=TABLESPACE` &mdash; create tables in the specified tablespace
-   `--unlogged-tables` &mdash; create tables as unlogged tables (Note: unlogged tables are not replicated)

#### Options to select what to run:
-   `-b, --builtin=NAME[@W]` &mdash; add builtin script NAME weighted at W (default: 1). Use `-b list` to list available scripts.
-   `-f, --file=FILENAME[@W]` &mdash; add script `FILENAME` weighted at W (default: 1)
-   `-N, --skip-some-updates` &mdash;  updates of pgbench_tellers and pgbench_branches. Same as `-b simple-update`
-   `-S, --select-only` &mdash; perform SELECT-only transactions. Same as `-b select-only`

#### Benchmarking options:
-   `-c, --client=NUM` &mdash; number of concurrent database clients (default: 1)
-   `-C, --connect` &mdash; establish new connection for each transaction
-   `-D, --define=VARNAME=VALUE` &mdash;  define variable for use by custom script
-   `-j, --jobs=NUM` &mdash; number of threads (default: 1)
-   `-l, --log` &mdash; write transaction times to log file
-   `-L, --latency-limit=NUM` &mdash; count transactions lasting more than NUM ms as late
-   `-m, --mode=regular|camo|failover` &mdash; mode in which pgbench should run (default: `regular`)
-   `-M, --protocol=simple|extended|prepared` &mdash; protocol for submitting queries (default: `simple`)
-   `-n, --no-vacuum` &mdash; do not run `VACUUM` before tests
-   `-o, --set-option=NAME=VALUE` &mdash; specify runtime SET option
-   `-P, --progress=NUM`  &mdash; show thread progress report every NUM seconds
-   `-r, --report-per-command`  &mdash;  latencies, failures and retries per command
-   `-R, --rate=NUM`  &mdash; target rate in transactions per second
-   `-s, --scale=NUM`  &mdash; report this scale factor in output
-   `-t, --transactions=NUM`  &mdash; number of transactions each client runs (default: 10)
-   `-T, --time=NUM`  &mdash; duration of benchmark test in seconds
-   `-v, --vacuum-all`  &mdash; vacuum all four standard tables before tests
-   `--aggregate-interval=NUM`  &mdash;  data over NUM seconds
-   `--failures-detailed`  &mdash; report the failures grouped by basic types
-   `--log-prefix=PREFIX`  &mdash; prefix for transaction time log file (default: `pgbench_log`)
-   `--max-tries=NUM`  &mdash; max number of tries to run transaction (default: 1)
-   `--progress-timestamp`  &mdash; use Unix epoch timestamps for progress
-   `--random-seed=SEED`  &mdash; set random seed ("time", "rand", integer)
-   `--retry`  &mdash; retry transactions on failover, used with "-m"
-   `--sampling-rate=NUM`  &mdash; fraction of transactions to log (e.g., 0.01 for 1%)
-   `--show-script=NAME`  &mdash; show builtin script code, then exit
-   `--verbose-errors`  &mdash; print messages of all errors

#### Common options:
-   `-d, --debug` &mdash; print debugging output
-   `-h, --host=HOSTNAME` &mdash; database server host or socket directory
-   `-p, --port=PORT` &mdash; database server port number
-   `-U, --username=USERNAME` &mdash; connect as specified database user
-   `-V, --version` &mdash; output version information, then exit
-   `-?, --help` &mdash; show help, then exit

