---
title: "Query Tool"
---

<div id="query_tool" class="registered_link"></div>


The Query Tool is a powerful, feature-rich environment that allows you to execute arbitrary SQL commands and review the result set. You can access the Query Tool via the `Query Tool` menu option on the `Tools` menu, or through the context menu of select nodes of the Browser tree control. The Query Tool allows you to:

-   Issue ad-hoc SQL queries.
-   Execute arbitrary SQL commands.
-   Edit the result set of a SELECT query if it is [updatable](../08_toc_pem_developer_tools/#updatable-result-set).
-   Displays current connection and transaction status as configured by the user.
-   Save the data displayed in the output panel to a CSV file.
-   Review the execution plan of a SQL statement in either a text, a graphical format or a table format (similar to <https://explain.depesz.com>).
-   View analytical information about a SQL statement.

![Query Tool tab](../images/query_tool.png)

You can open multiple copies of the Query tool in individual tabs simultaneously. To close a copy of the Query tool, click the `X` in the upper-right hand corner of the tab bar.

The Query Tool features two panels:

-   The upper panel displays the `SQL Editor`. You can use the panel to enter, edit, or execute a query. It also shows the `History` tab which can be used to view the queries that have been executed in the session, and a `Scratch Pad` which can be used to hold text snippets during editing. If the Scratch Pad is closed, it can be re-opened (or additional ones opened) by right-clicking in the SQL Editor and other panels and adding a new panel.
-   The lower panel displays the `Data Output` panel. The tabbed panel displays the result set returned by a query, information about a query's execution plan, server messages related to the query's execution and any asynchronous notifications received from the server.

**The Query Tool Toolbar**

The `Query Tool` toolbar uses context-sensitive icons that provide shortcuts to frequently performed tasks. If an icon is highlighted, the option is enabled; if the icon is grayed-out, the task is disabled. Please note that disabled icons may support functionality accessed via the [data editor](../08_toc_pem_developer_tools/04_editgrid/#editgrid).

![Query Tool toolbar](../images/query_toolbar.png)

Hover over an icon to display a tooltip that describes the icon's functionality:

<table><colgroup><col style="width: 16%" /><col style="width: 71%" /><col style="width: 11%" /></colgroup><thead><tr class="header"><th>Icon</th><th>Behavior</th><th>Shortcut</th></tr></thead><tbody><tr class="odd"><td><code>Open File</code></td><td>Click the <code>Open File</code> icon to display a previously saved query in the SQL Editor.</td><td>Accesskey + O</td></tr><tr class="even"><td><code>Save</code></td><td><p>Click the <code>Save</code> icon to perform a quick-save of a previously saved query, or to access the <code>Save</code> menu:</p><blockquote><ul><li>Select <code>Save</code> to save the selected content of the SQL Editor panel in a file.</li><li>Select <code>Save As</code> to open a new browser dialog and specify a new location to which to save the selected content of the SQL Editor panel.</li></ul></blockquote></td><td>Accesskey + S</td></tr><tr class="odd"><td><code>Find</code></td><td><p>Use the <code>Find</code> menu to search, replace, or navigate the code displayed in the SQL Editor:</p><blockquote><ul><li>Select <code>Find</code> to provide a search target, and search the SQL Editor contents.</li><li>Select <code>Find next</code> to locate the next occurrence of the search target.</li><li>Select <code>Find previous</code> to move to the last occurrence of the search target.</li><li>Select <code>Pesistent find</code> to identify all occurrences of the search target within the editor.</li><li>Select <code>Replace</code> to locate and replace (with prompting) individual occurrences of the target.</li><li>Select <code>Replace all</code> to locate and replace all occurrences of the target within the editor.</li><li>Select <code>Jump</code> to navigate to the next occurrence of the search target.</li></ul></blockquote></td><td><p>Cmd+F</p><p>Cmd+G</p><p>Cmd+Shift+G</p><p>Cmd+Shift+F</p><p>Alt+G</p></td></tr><tr class="even"><td><code>Copy</code></td><td>Click the <code>Copy</code> icon to copy the content that is currently highlighted in the Data Output panel. when in View/Edit data mode.</td><td>Accesskey + C</td></tr><tr class="odd"><td><code>Paste</code></td><td>Click the <code>Paste</code> icon to paste a previously row into a new row when in View/Edit data mode.</td><td>Accesskey + P</td></tr><tr class="even"><td><code>Delete</code></td><td>Click the <code>Delete</code> icon to mark the selected rows for delete when in View/Edit data mode.</td><td>Accesskey + D</td></tr><tr class="odd"><td><code>Edit</code></td><td><p>Use options on the <code>Edit</code> menu to access text editing tools; the options operate on the text displayed in the SQL Editor panel when in Query Tool mode:</p><blockquote><ul><li>Select <code>Indent Selection</code> to indent the currently selected text.</li><li>Select <code>Unindent Selection</code> to remove indentation from the currently selected text.</li><li>Select <code>Inline Comment Selection</code> to enclose any lines that contain the selection in SQL style comment notation.</li><li>Select <code>Inline Uncomment Selection</code> to remove SQL style comment notation from the selected line.</li><li>Select <code>Block Comment</code> to enclose all lines that contain the selection in C style comment notation. This option acts as a toggle.</li></ul></blockquote></td><td><p>Tab</p><p>Shift+Tab</p><p>Cmd+/</p><p>Cmd+.</p><p>Shift+Cmd+/</p></td></tr><tr class="even"><td><code>Filter</code></td><td><p>Click the <code>Filter</code> icon to set filtering and sorting criteria for the data when in View/Edit data mode. Click the down arrow to access other filtering and sorting options:</p><blockquote><ul><li>Click <code>Sort/Filter</code> to open the sorting and filtering dialogue.</li><li>Click <code>Filter by Selection</code> to show only the rows containing the values in the selected cells.</li><li>Click <code>Exclude by Selection</code> to show only the rows that do not contain the values in the selected cells.</li><li>Click <code>Remove Sort/Filter</code> to remove any previously selected sort or filtering options.</li></ul></blockquote></td><td>Accesskey + F</td></tr><tr class="odd"><td>Limit Selector</td><td>Select a value in the <code>Limit Selector</code> to limit the size of the dataset to a number of rows.</td><td>Accesskey + R</td></tr><tr class="even"><td><code>Stop</code></td><td>Click the <code>Stop</code> icon to cancel the execution of the currently running query.</td><td>Accesskey + Q</td></tr><tr class="odd"><td><code>Execute/Refresh</code></td><td><p>Click the <code>Execute/Refresh</code> icon to either execute or refresh the query highlighted in the SQL editor panel. Click the down arrow to access other execution options:</p><blockquote><ul><li>Add a check next to <code>Auto-Rollback</code> to instruct the server to automatically roll back a transaction if an error occurs during the transaction.</li><li>Add a check next to <code>Auto-Commit</code> to instruct the server to automatically commit each transaction. Any changes made by the transaction will be visible to others, and durable in the event of a crash.</li></ul></blockquote></td><td>F5</td></tr><tr class="even"><td><code>Explain</code></td><td><dl><dt>Click the <code>Explain</code> icon to view an explanation plan for the current query. The result of the</dt><dd><p>EXPLAIN is displayed graphically on the <code>Explain</code> tab of the output panel, and in text form on the <code>Data Output</code> tab.</p></dd></dl></td><td>F7</td></tr><tr class="odd"><td><code>Explain analyze</code></td><td><p>Click the <code>Explain analyze</code> icon to invoke an EXPLAIN ANALYZE command on the current query.</p><p>Navigate through the <code>Explain Options</code> menu to select options for the EXPLAIN command:</p><blockquote><ul><li>Select <code>Verbose</code> to display additional information regarding the query plan.</li><li>Select <code>Costs</code> to include information on the estimated startup and total cost of each plan node, as well as the estimated number of rows and the estimated width of each row.</li><li>Select <code>Buffers</code> to include information on buffer usage.</li><li>Select <code>Timing</code> to include information about the startup time and the amount of time spent in each node of the query.</li></ul></blockquote></td><td>Shift+F7</td></tr><tr class="even"><td><code>Commit</code></td><td>Click the <code>Commit</code> icon to commit the transaction.</td><td>Shift+CTRL+M</td></tr><tr class="odd"><td><code>Rollback</code></td><td>Click the <code>Rollback</code> icon to rollback the transaction.</td><td>Shift+CTRL+R</td></tr><tr class="even"><td><code>Clear</code></td><td><p>Use options on the <code>Clear</code> drop-down menu to erase display contents:</p><blockquote><ul><li>Select <code>Clear Query Window</code> to erase the content of the SQL Editor panel.</li><li>Select <code>Clear History</code> to erase the content of the <code>History</code> tab.</li></ul></blockquote></td><td>Accesskey + L</td></tr><tr class="odd"><td><code>Download as CSV</code></td><td>Click the <code>Download as CSV</code> icon to download the result set of the current query to a comma-separated list. You can specify the CSV settings through <code>Preferences -&gt; SQL Editor -&gt; CSV output</code> dialogue.</td><td>F8</td></tr><tr class="even"><td><code>Macros</code></td><td>Click the <em>Macros</em> icon to manage the macros. You can create, edit or clear the macros through <em>Manage Macros</em> option.</td><td></td></tr></tbody></table>

**The SQL Editor Panel**

The `SQL editor` panel is a workspace where you can manually provide a query, copy a query from another source, or read a query from a file. The SQL editor features syntax coloring and autocompletion.

![Query Tool - Query Editor tab](../images/query_sql_editor.png)

To use autocomplete, begin typing your query; when you would like the Query editor to suggest object names or commands that might be next in your query, press the Control+Space key combination. For example, type "*SELECT \* FROM*" (without quotes, but with a trailing space), and then press the Control+Space key combination to select from a popup menu of autocomplete options.

![Query Tool - Query Editor tab - Autocomplete feature](../images/query_autocomplete.png)

After entering a query, select the `Execute/Refresh` icon from the toolbar. The complete contents of the SQL editor panel will be sent to the database server for execution. To execute only a section of the code that is displayed in the SQL editor, highlight the text that you want the server to execute, and click the `Execute/Refresh` icon.

![Query Tool - Query Editor tab - Execute query](../images/query_execute_section.png)

The message returned by the server when a command executes is displayed on the `Messages` tab. If the command is successful, the `Messages` tab displays execution details.

![Query Tool - Query Editor - Message tab](../images/query_tool_message.png)

Options on the `Edit` menu offer functionality that helps with code formatting and commenting:

-   The auto-indent feature will automatically indent text to the same depth as the previous line when you press the Return key.
-   Block indent text by selecting two or more lines and pressing the Tab key.
-   Implement or remove SQL style or toggle C style comment notation within your code.

You can also **drag and drop** certain objects from the treeview which can save time in typing long object names. Text containing the object name will be fully qualified with schema. Double quotes will be added if required. For functions and procedures, the function name along with parameter names will be pasted in the Query Tool.

**The Data Output Panel**

The `Data Output` panel displays data and statistics generated by the most recently executed query.

![Query Tool - Data output tab](../images/query_output_data.png)

The `Data Output` tab displays the result set of the query in a table format. You can:

-   Select and copy from the displayed result set.
-   Use the `Execute/Refresh` options to retrieve query execution information and set query execution options.
-   Use the `Save results to file` icon to save the content of the `Data Output` tab as a comma-delimited file.
-   Edit the data in the result set of a SELECT query if it is updatable.

<div id="updatable-result-set" class="registered_link"></div>

A result set is updatable if:

-   All columns are either selected directly from a single table, or are not table columns at all (e.g. concatenation of 2 columns). Only columns that are selected directly from the table are editable, other columns are read-only.
-   All the primary key columns or OIDs of the table are selected in the result set.

Any columns that are renamed or selected more than once are also read-only.

Editable and read-only columns are identified using pencil and lock icons (respectively) in the column headers.

![Query Tool - Editable and Read-only columns](../images/query_tool_editable_columns.png)

The psycopg2 driver version should be equal to or above 2.8 for updatable query result sets to work.

An updatable result set is identical to the [Data Grid](../08_toc_pem_developer_tools/04_editgrid/#data-grid) in View/Edit Data mode, and can be modified in the same way.

If Auto-commit is off, the data changes are made as part of the ongoing transaction, if no transaction is ongoing a new one is initiated. The data changes are not committed to the database unless the transaction is committed.

If any errors occur during saving (for example, trying to save NULL into a column with NOT NULL constraint) the data changes are rolled back to an automatically created SAVEPOINT to ensure any previously executed queries in the ongoing transaction are not rolled back.

All rowsets from previous queries or commands that are displayed in the `Data Output` panel will be discarded when you invoke another query; open another query tool browser tab to keep your previous results available.

## Explain Panel

To generate the `Explain` or `Explain Analyze` plan of a query, click on `Explain` or `Explain Analyze` button in the toolbar.

More options related to `Explain` and `Explain Analyze` can be selected from the drop down on the right side of `Explain Analyze` button in the toolbar.

![Query Tool - Toolbar Explain button](../images/query_toolbar_explain.png)

Please note that pgAdmin generates the `Explain [Analyze]` plan in JSON format.

On successful generation of `Explain` plan, it will create three tabs/panels under the Explain panel.

-   Graphical

Please note that `EXPLAIN VERBOSE` cannot be displayed graphically. Click on a node icon on the `Graphical` tab to review information about that item; a popup window will display on the right side with the information about the selected object. For information on JIT statistics, triggers and a summary, Click on the button top-right corner; a similar popup window will be displayed when appropriate.

Use the download button on top left corner of the `Explain` canvas to download the plan as an SVG file.

**Note:** Download as SVG is not supported on Internet Explorer.

![Query Tool - Explain tab - Graphical plan tab](../images/query_output_explain_details.png)

Note that the query plan that accompanies the `Explain analyze` is available on the `Data Output` tab.

-   Table

`Table` tab shows the plan details in table format, it generates table format similar to `explain.depsez.com`. Each row of the table represent the data for a `Explain Plan Node`. It may contain the node information, exclusive timing, inclusive timing, actual vs planned rows differences, actual rows, planned rows, loops.

background color of the exclusive, inclusive, and Rows X columns may vary based on the difference between actual vs planned.

If percentage of the exclusive/inclusive timings of the total query time is: &gt; 90 - Red color &gt; 50 - Orange (between red and yellow) color &gt; 10 - Yellow color

If planner mis-estimated number of rows (actual vs planned) by 10 times - Yellow color 100 times - Orange (between Red and Yellow) color 1000 times - Red color

![Query Tool - Explain tab - Analysis tab](../images/query_explain_analyze_table.png)

-   Statistics

`Statistics` tab shows two tables: 1. Statistics per Plan Node Type 2. Statistics per Table

![Query Tool - Explain plan tab - Statistics tab](../images/query_explain_analyze_statistics.png)

## Messages Panel

Use the `Messages` tab to view information about the most recently executed query:

![Query Tool - Messages tab](../images/query_output_error.png)

If the server returns an error, the error message will be displayed on the `Messages` tab, and the syntax that caused the error will be underlined in the SQL editor. If a query succeeds, the `Messages` tab displays how long the query took to complete and how many rows were retrieved:

![Query Tool - Messages tabn](../images/query_output_messages.png)

*Query tool output information*

## Query History Panel

Use the `Query History` tab to review activity for the current session:

![Query Tool - Query History tab](../images/query_output_history.png)

The Query History tab displays information about recent commands:

-   The date and time that a query was invoked.
-   The text of the query.
-   The number of rows returned by the query.
-   The amount of time it took the server to process the query and return a result set.
-   Messages returned by the server (not noted on the `Messages` tab).
-   The source of the query (indicated by icons corresponding to the toolbar).

You can show or hide the queries generated internally by pgAdmin (during 'View/Edit Data' or 'Save Data' operations).

To erase the content of the `Query History` tab, select `Clear history` from the `Clear` drop-down menu.

Query History is maintained across sessions for each database on a per-user basis when running in Query Tool mode. In View/Edit Data mode, history is not retained. By default, the last 20 queries are stored for each database. This can be adjusted in <span class="title-ref">config\_local.py</span> by overriding the <span class="title-ref">MAX\_QUERY\_HIST\_STORED</span> value.

## Connection Status

Use the `Connection status` feature to view the current connection and transaction status by clicking on the status icon in query tool:

![Query Tool - Connection Status button](../images/query_tool_connection_status.png)

Change connection +\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

User can connect to another server or database from existing open session of query tool.

-   Click on the connection link next to connection status.
-   Now click on the *&lt;New Connection&gt;* option from the dropdown.

<img src="../images/new_connection_options.png" class="align-center" alt="Query tool connection options" />

-   Now select server, database, user, and role to connect and click OK.

<img src="../images/new_connection_dialog.png" class="align-center" alt="Query tool connection dialog" />

-   A newly created connection will now get listed in the options.
-   To connect, select the newly created connection from the dropdown list.

## Macros

Query Tool Macros enable you to execute pre-defined SQL queries with a single key press. Pre-defined queries can contain the placeholder $SELECTION$. Upon macro execution, the placeholder will be replaced with the currently selected text in the Query Editor pane of the Query Tool.

<img src="../images/query_tool_manage_macros.png" class="align-center" alt="Query Tool Manage macros" />

To create a macro, select the *Manage Macros* option from the *Macros* menu on the *Query Tool*. Select the key you wish to use, enter the name of the macro, and the query, optionally including the selection placeholder, and then click the *Save* button to store the macro.

<img src="../images/query_tool_manage_macros_dialog.png" class="align-center" alt="Query Tool Manage Macros dialogue" />

To clear a macro, select the macro on the *Manage Macros* dialogue, and then click the *Clear* button.

<img src="../images/query_tool_macros_clear_row.png" class="align-center" alt="Query Tool Manage Macros clear the row" />

The server will prompt you for confirmation to clear the macro.

<img src="../images/query_tool_macros_clear_confirmation.png" class="align-center" alt="Query Tool Manage Macros Clear row confirmation" />

To clear all macros, click on the *Clear* button on left side of the key. The server will prompt you for confirmation to clear all the rows.

<img src="../images/query_tool_macros_clear_all.png" class="align-center" alt="Query Tool Macros Clear All" />

To execute a macro, simply select the appropriate shortcut keys, or select it from the *Macros* menu.

<img src="../images/query_tool_macros_execution.png" class="align-center" alt="Query Tool Macros Execution" />
