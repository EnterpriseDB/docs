---
title: "Upgrading an HA PEM installation"
---

If you're using a [High Availability PEM](../../considerations/ha_pem.mdx), you can perform a major or minor upgrade of the PEM installation by following the relevant procedure below.

The example commands provided assume RHEL-based operating system.

!!!Important
This upgrade procedure is designed to minimize downtime to your PEM cluster.
However, it will restart your primary database instance once so you should ensure that automatic failover is disabled to allow the primary to come back up and avoid one of the replicas being promoted.
!!!

## Upgrading a deployment with colocated PEM web application and backend database

### Upgrade the primary

On the primary server:

1.  Update the PEM packages: 

    ```shell
    dnf upgrade edb-pem --allowerasing
    ```

1.  Execute the upgrade script: 

    ```shell
    /usr/edb/pem/bin/configure-pem-server.sh
    ``` 

### Upgrade the replicas

On each replica server:

1.  Update the PEM packages:

    ```shell
    dnf upgrade edb-pem --allowerasing
    ```

1.  If you are updating to PEM 10.x from PEM 9 or PEM 10.0, ensure that libpq5 is installed (this is done automatically on the primary by `configure_pem_server.sh`):

    ```shell
    dnf install libpq5
    ```

1.  Copy following the configuration files from the primary.

    ```
    /etc/httpd/conf.d/edb-pem.conf
    /etc/httpd/conf.d/edb-ssl-pem.conf
    /usr/edb/pem/share/.install-config
    /usr/edb/pem/web/pem.wsgi
    /usr/edb/pem/web/config_setup.py
    ```

1.  If you are using NGINX as your web server, also copy the following files from the primary.

    ```
    /etc/edb-uwsgi/uwsgi.ini
    /usr/lib/tmpfiles.d/edb-uwsgi.conf
    /etc/systemd/system/edb-uwsgi.service
    /etc/edb-uwsgi/apps-available/pem.ini
    /etc/nginx/conf.d/edb-pem.conf
    ```

    Then reload NGINX and uWSGI:

    ```shell
    systemctl daemon-reload
    systemctl enable edb-uwsgi
    systemctl start edb-uwsgi
    systemctl restart nginx
    ```

1.  If you are using Apache HTTPD as your web server, also copy the following files from the primary.

   ```
   /etc/httpd/conf.d/edb-pem.conf
   /etc/httpd/conf.d/edb-ssl-pem.conf
   ```

   The restart Apache HTTPD:

   ```shell
   systemctl restart httpd
   ```

The upgrade is complete. 

## Upgrading a deployment with separate PEM web application and backend database servers

### Upgrade the primary backend

On the primary backend database server:

1.  Update the PEM packages: 

    ```shell
    dnf upgrade edb-pem --allowerasing
    ```

1.  Execute the upgrade script: 

    ```shell
    /usr/edb/pem/bin/configure-pem-server.sh
    ``` 

### Upgrade the replica backends

On each replica database server:

1.  Update the PEM packages:

    ```shell
    dnf upgrade edb-pem --allowerasing
    ```

1.  Copy following the configuration files from the primary.

    ```
    /usr/edb/pem/share/.install-config
    ```

### Upgrade the web applications

On each web application server:

1.  Update the PEM packages:

    ```shell
    dnf upgrade edb-pem --allowerasing
    ```

1.  Execute the upgrade script: 

    ```shell
    /usr/edb/pem/bin/configure-pem-server.sh
    ``` 

The upgrade is complete. 