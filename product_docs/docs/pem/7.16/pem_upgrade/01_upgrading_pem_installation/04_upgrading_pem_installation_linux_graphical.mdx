---
title: "Upgrading a Graphical PEM Installation on a Linux Host"
---

To upgrade PEM component software on Linux hosts, simply install a newer version of the PEM component native packages in the following order:

1.  Invoke the PEM Agent native package installation on each monitored node `except` the PEM server host.
2.  Invoke the PEM server native package installation; it will upgrade `both` the PEM server and the PEM Agent that resides on the PEM server host.

During an installation, the component installation will automatically detect an existing installation, and perform an upgrade. After upgrading the PEM Agent and server, you can upgrade SQL Profiler if required; this step is platform-specific.

The following section walks you through the process of upgrading a PEM installation that was performed via a graphical installer on a Linux host.

## Prerequisites to Upgrade a PEM Installation on a Linux Host

If you are using a version of Postgres or Advanced Server released older than version 10, before the upgrade you must install the `libs` package for version 10 or above on the system where the PEM server is installed.

For Advanced Server:

```text
yum install edb-as<X>-server-libs
```

For PostgreSQL:

```text
yum install postgresql<X>-libs
```

Where `<X>` is the Postgres or Advanced Server version whose libs package you want to install.

## Upgrading a PEM Agent (Graphical Installation) on a CentOS or RHEL Host

The default installation location for the PEM Agent when installed by the graphical installer is `/opt/edb/pem`. In the example that follows, substitute your server installation location for `<PEM_installation_path>`.

1.  Use the version specific command to stop the `pemagent` service.

    On a CentOS or RHEL 7.x 0r 8.x host:

    ```text
    systemctl stop pemagent
    ```

2.  Install the supporting `epel-release` package on the host by running any one of the following commands:

    ```text
    yum install epel-release
    ```

    ```text
    yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-<X>.noarch.rpm
    ```

    Where `X` is the OS version.

    !!! Note
        -   You may need to enable the `[extras]` repository definition in the `CentOS-Base.repo` file (located in `/etc/yum.repos.d`).

        -   If you are a Red Hat Network user,
            -   You must also enable the `rhel-<x>-server-optional-rpms` repository to use EPEL packages, where *x* specifies the version of RHEL on the host. You can make the repository accessible by enabling the `RHEL optional subchannel` for `RHN-Classic`. If you have a certificate-based subscription, then you must also enable `rhel-<x>-server-eus-optional-rpms` repository to use EPEL packages or please see the `Red Hat Subscription Management Guide` for the required repository.
            -   You must also enable the `rhel-<x>-server-extras-rpms` repository, where `x` specifies the version of the RHEL on the host.


3.  Install and configure the `edb.repo` file:

    a.  You must also have credentials that allow access to the EDB repository. To request credentials, visit:

    [EDB Repository Access Steps](https://info.enterprisedb.com/rs/069-ALB-339/../images/Repository%20Access%2004-09-2019.pdf).

    b.  Create a repository configuration file; assume superuser privileges, and invoke the following command:

    ```text
    yum -y install https://yum.enterprisedb.com/edb-repo-rpms/edb-repo-latest.noarch.rpm
    ```

    The repository configuration file is named `edb.repo`. The file resides in `/etc/yum.repos.d`.

    c.  After creating the `edb.repo` file, to ensure that the value of the enabled parameter is `1`, and the `USERNAME` and `PASSWORD` placeholders in the `baseurl` specification are replaced with the name and password of a registered EDB user, run the following command:

    ```text
    sed -i "s@<username>:<password>@USERNAME:PASSWORD@" /etc/yum.repos.d/edb.repo
    ```

    If you want to install PEM Agent on a machine that is in isolated network, you must first create PEM repository on that machine. For more information about creating PEM repository on an isolated network, see [Creating a PEM repository in an Isolated Network](03_creating_pem_repository_in_isolated_network/#creating_pem_repository_in_isolated_network).

4.  The `yum makecache` command downloads the metadata for the currently enabled repositories; when the command completes, check the available packages to confirm that the list includes the latest PEM Agent:

    On a CentOS or RHEL 7.x or 8.x:

    ```text
    yum makecache

    yum list edb-pem-agent
    ```

    On a CentOS or RHEL 8.x:

    ```text
    dnf makecache

    dnf list edb-pem-agent
    ```

5.  Install the PEM Agent RPM; when the installation completes, you can use the `yum info` command to confirm installation information for the PEM Agent:

    On a CentOS or RHEL 7.x or 8.x:

    ```text
    yum install edb-pem-agent

    yum info edb-pem-agent
    ```

    On a CentOS or RHEL 8.x:

    ```text
    dnf install edb-pem-agent
    ```

6.  After installation, copy the PEM Agent configuration file (`agent.cfg`) from the previous location to the location required by the RPM installer:

    ```text
    cp /PEM_installation_path/agent/etc/agent.cfg /usr/edb/pem/agent/etc/agent.cfg
    ```

    !!! Note
        The Package Management and Streaming Replication features are deprecated from PEM 7.16 version. Please remove these parameters from `agent.cfg` file while copying the file if existing - `allow_package_management` and `allow_streaming_replication`, to avoid any warning messages in the worker log file after the PEM Agent service restart.

     a.  Open the agent configuration file located at:

    ```text
    /usr/edb/pem/agent/etc/agent.cfg
    ```

     Then set the value of the `ca_file` parameter:

    ```text
    ca_file=/usr/libexec/libcurl-pem/share/certs/ca-bundle.crt
    ```

     b.  Take a backup of the service file and agent certificates:

     On CentOS or RHEL 7.x or 8.x, use the following command to back up the service file:

    ```text
    cp /usr/lib/systemd/system/pemagent.service /usr/lib/systemd/system/pemagent.service_bkp
    ```

     Then, copy the agent certificates; in the following commands, `<agent_id>` should specify the agent identifier (for example, agent2 or agent3):

    ```text
    mv /root/.pem/<agent_id>.key /root/.pem/<agent_id>.key.bkp

    mv /root/.pem/<agent_id>.crt /root/.pem/<agent_id>.crt.bkp
    ```

     c.  Uninstall the PEM agent using bitrock uninstaller:

    ```text
    /PEM_installation_path/agent/uninstall-pemagent
    ```

     d.  Use version specific commands to restore the service file backup and agent certificates to original location. For example:

     On a RHEL or CentOS 7.x or 8.x host:

    ```text
    cp /usr/lib/systemd/system/pemagent.service_bkp /usr/lib/systemd/system/pemagent.service
    ```

     Then, move the agent certificate files; in the following commands, `<agent_id>` should specify the agent identifier (for example, agent2 or agent3):

    ```text
    mv /root/.pem/<agent_id>.key.bkp /root/.pem/<agent_id>.key

    mv /root/.pem/<agent_id>.crt.bkp /root/.pem/<agent_id>.crt
    ```

7.  Enable the `pemagent` service, and start `pemagent` and `httpd`.

    On a RHEL or CentOS 7.x or 8.x host, use the commands:

    ```text
    systemctl enable pemagent

    systemctl start pemagent
    ```

At this point, the PEM agent should be up and running; you can use the PEM web interface to check the agent version and status.

!!! Note
    If you have already configured or are planning to configure any shell/batch script run by a Linux agent that is upgraded from any version prior to version 7.11, you must modify the `agent.cfg` file and specify the user for the `batch_script_user` parameter. It is strongly recommended that you use a non-root user to run the scripts. Using the root user when running a script may result in compromising the data security and operating system security. However, if you want to restore the earlier behavior of the PEM agent and use the root user to run the scripts, then you need to set the value of `batch_script_user` parameter to `root`.

## Upgrading a PEM Server that was Installed with a Graphical Installer

The default installation location for the PEM server when installed by the graphical installer is `/opt/edb/pem`. In the example that follows, substitute your server installation location for `<PEM_installation_path>`.

### Upgrading a PEM Server that was Installed with a Graphical Installer on a CentOS or RHEL Host

1.  Logout from PEM.

2.  Stop the PEMHTTPD service on PEM server. In case PEM server and web server are on two different systems, run the command on the web server:

    On a CentOS or RHEL 7.x 0r 8.x host:

    ```text
    systemctl stop PEMHTTPD
    systemctl stop pemagent
    ```

3.  Install the supporting `epel-release` package on the host by running any one of the following commands:

    ```text
    yum install epel-release
    ```

    ```text
    yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-<X>.noarch.rpm
    ```

    Where `<X>` is the OS version.

    !!! Note
        -   You may need to enable the `[extras]` repository definition in the `CentOS-Base.repo` file (located in `/etc/yum.repos.d`).
        -   If you are a Red Hat Network user,
            -   You must also enable the `rhel-<x>-server-optional-rpms` repository to use EPEL packages, where *x* specifies the version of RHEL on the host. You can make the repository accessible by enabling the `RHEL optional subchannel` for `RHN-Classic`. If you have a certificate-based subscription, then you must also enable `rhel-<x>-server-eus-optional-rpms` repository to use EPEL packages or please see the `Red Hat Subscription Management Guide` for the required repository.
            -   You must also enable the `rhel-<x>-server-extras-rpms` repository, where `x` specifies the version of the RHEL on the host.

4.  Install and configure edb.repo file:

    a.  You must also have credentials that allow access to the EDB repository. To request credentials, visit:

    [EDB Repository Access Steps](https://info.enterprisedb.com/rs/069-ALB-339/../images/Repository%20Access%2004-09-2019.pdf).

    b.  Create a repository configuration file; assume superuser privileges, and invoke the following command:

    ```text
    yum -y install https://yum.enterprisedb.com/edb-repo-rpms/edb-repo-latest.noarch.rpm
    ```

    The repository configuration file is named `edb.repo`. The file resides in `/etc/yum.repos.d`.

    c.  After creating the `edb.repo` file, to ensure that the value of the enabled parameter is `1`, and the `username`
    and `password` placeholders in the `baseurl` specification are replaced with the name and password of a registered EDB user, run the following command:.

    ```text
    sed -i "s@<username>:<password>@USERNAME:PASSWORD@" /etc/yum.repos.d/edb.repo
    ```

    If you want to install PEM Agent on a machine that is in isolated network, you must first create PEM repository on that machine. For more information about creating PEM repository on an isolated network, see [Creating a PEM repository in an Isolated Network](03_creating_pem_repository_in_isolated_network/#creating_pem_repository_in_isolated_network).

5.  The `yum makecache` command downloads the metadata for the currently enabled repositories; when the command completes, check the available packages to confirm that the list includes the latest PEM Server:

    On a CentOS or RHEL 7.x or 8.x:

    ```text
    yum makecache

    yum list edb-pem
    ```

    On a CentOS or RHEL 8.x:

    ```text
    dnf makecache

    dnf list edb-pem
    ```

6.  Install the PEM Server RPM; when the installation completes, you can use the `yum info` command to confirm installation information for the PEM Server:

    On a CentOS or RHEL 7.x or 8.x:

    ```text
    yum install edb-pem

    yum info edb-pem
    ```

    On a CentOS or RHEL 8.x:

    ```text
    dnf install edb-pem
    ```

7.  After installation, copy the `agent.cfg` file from the current location (the location required by the graphical installer) to the location required by the RPM package:

    ```text
    cp /<PEM_installation_path>/agent/etc/agent.cfg /usr/edb/pem/agent/etc/agent.cfg
    ```

8.  Open the agent configuration file located at:

    ```text
    /usr/edb/pem/agent/etc/agent.cfg
    ```

    Then, set the value of the `ca_file` parameter:

    ```text
    ca_file=/usr/libexec/libcurl-pem/share/certs/ca-bundle.crt
    ```

9.  Copy the `pem.db` file (and other required files) to the RPM installation location and change the file ownership. In case PEM server and web server are on two different systems, run the below commands on the web server:

    ```text
    cp -r /<PEM_installation_path>/server/share/pemhome/.pem/* /var/lib/pemhome/.pem/

    chown -R pem:pem /var/lib/pemhome/.pem/
    ```

10. Change the home directory in the `passwd` file from the location identified by the graphical installer to the RPM location. In case PEM server and web server are on two different systems, run the commands on PEM server as well as web server:

    ```text
    usermod -m -d /var/lib/pemhome pem

    cat /etc/passwd | grep pem
    ```

11. Take a backup of the PEM service file and agent certificates:

    ```text
    cp /usr/lib/systemd/system/pemagent.service /usr/lib/systemd/system/pemagent.service_bkp

    mv /root/.pem/agent1.key /root/.pem/agent1.key.bkp

    mv /root/.pem/agent1.crt /root/.pem/agent1.crt.bkp
    ```

12. Uninstall the PEM server using the graphical uninstaller from PEM server and web server machines:

    ```text
    /<PEM_installation_path> /server/uninstall-pemserver
    ```

13. Restore the service file backup and agent certificates to original location on PEM server.

    ```text
    cp /usr/lib/systemd/system/pemagent.service_bkp /usr/lib/systemd/system/pemagent.service

    mv /root/.pem/agent1.crt.bkp /root/.pem/agent1.crt

    mv /root/.pem/agent1.key.bkp /root/.pem/agent1.key
    ```

14. Install the sslutils through RPM or Installer (In case of Windows, you may want to stop the database server before installation as installer may not be able to overwrite the file otherwise it would require system restart)

    Restart the database server (Restarting the database server is required as shared object of the extension has been upgraded)

    Refer section [Install sslutils](../02_upgrading_backend_database/#upgrading_backend_database)

    Use "ALTER EXTENSION" statement to upgrade the version

    ```text
    ALTER EXTENSION sslutils UPDATE [ TO new_version ]
    ```

15. Execute the PEM RPM configuration script on PEM server and web server; when prompted, provide the backend database details: the script should run without generating errors:

    ```text
    /usr/edb/pem/bin/configure-pem-server.sh
    ```

16. Enable the `pemagent` service on PEM server and web server. Start the `pemagent` and `httpd` services on the web server.

    On a CentOS or RHEL 7.x 0r 8.x host:

    ```text
    systemctl enable pemagent

    systemctl start pemagent

    systemctl start httpd
    ```

17. Launch the PEM web interface. Check the server and agent to confirm the PEM version, server status, and schema version. At this point, everything should be up and running.

18. You can now uninstall the PEMHTTD service from your web server, as it is no longer in use.

    ```text
    /opt/edb/pem/httpd/uninstall-pemhttpd
    ```

## Upgrading a SQL Profiler Installation with a Graphical Installer

SQL Profiler graphical installers are available for PostgreSQL and Advanced Server versions prior to 11.x (i.e. 10.x, 9.6).

To upgrade a SQL Profiler installation on a Linux host:

1.  Delete the existing SQL Profiler query set on each node by invoking the `uninstall-sql-profiler.sql` script. By default, if you are using PostgreSQL on a Linux host that was installed with a graphical installer, the script resides in the `share/postgresql/contrib` directory under the PostgreSQL installation; for Advanced Server, the script resides in the `share/contrib` directory under the Advanced Server installation. You can use the following server-specific commands.

    For PostgreSQL:

    ```text
    /opt/PostgreSQL/<x>/bin/psql -f /opt/PostgreSQL/<x>/share/postgresql/contrib/uninstall-sql-profiler.sql -d postgres -U postgres
    ```

    Where, `x` is the version of PostgreSQL and `-d` specifies the name of the maintenance database.

    For Advanced Server:

    ```text
    /opt/edb/as<x>/bin/psql -f /opt/edb/as<x>/share/contrib/uninstall-sql-profiler.sql -d edb -U enterprisedb
    ```

    Where, `x` is the version of Advanced Server and `-d` specifies the name of the maintenance database.

2.  Then, invoke the new SQL Profiler installer on each node you wish to profile. Run the installer as Administrator:

    For a PostgreSQL host:

    ```text
    sqlprofiler-pg-<x>-<y>-linux.exe
    ```

    Where `x` is the version of the PostgreSQL and `y` is the version of SQL Profiler. For example: `sqlprofiler-pg-12-7.14.0-1-linux.exe`.

    For Advanced Server:

    ```text
    sqlprofiler-edb-as<x>-<y>-linux.exe
    ```

    Where `x` is the version of Advanced Server and `y` is the version of SQL Profiler. For example: `sqlprofiler-edb-as12-7.14.0-1-linux.exe`.

    The SQL Profiler installer will detect the existing `SQL Profiler` installation and upgrade it with the latest version of SQL Profiler.

3.  Run the `sql-profiler.sql` script file in the maintenance database.

    For PostgreSQL:

    ```text
    /opt/PostgreSQL/<x>/bin/psql -f /opt/PostgreSQL/<x>/share/postgresql/contrib/sql-profiler.sql -d postgres -U postgres
    ```

    Where, `x` is the version of PostgreSQL and `-d` specifies the name of the maintenance database.

    For Advanced Server:

    ```text
    /opt/edb/as<x>/bin/psql -f /opt/edb/as<x>/share/contrib/sql-profiler.sql -d edb -U enterprisedb
    ```

    Where, `x` is the version of Advanced Server and `-d` specifies the name of the maintenance database.

4.  Restart the PostgreSQL/Advanced Server to resume profiling the node from the PEM Client.

After updating the PEM components, you are ready to update the backend database.
