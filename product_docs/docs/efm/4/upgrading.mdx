---
title: "Upgrading Failover Manager"
navTitle: "Upgrading"
redirects:
 - ../efm_user/12_upgrading_existing_cluster
 - /efm/4/12_upgrading_existing_cluster
legacyRedirectsGenerated:
  # This list is generated by a script. If you need add entries, use the `legacyRedirects` key.
  - "/edb-docs/d/edb-postgres-failover-manager/user-guides/user-guide/4.0/upgrading_existing_cluster.html"
  - "/edb-docs/d/edb-postgres-failover-manager/user-guides/user-guide/4.1/upgrading_existing_cluster.html"
---

<div id="upgrading_existing_cluster" class="registered_link"></div>

Failover Manager provides a utility to assist you when upgrading a cluster managed by Failover Manager. To upgrade an existing cluster, you must:

1.  Install Failover Manager 4.6 on each node of the cluster. For detailed information about installing Failover Manager, see [Installing Failover Manager](installing).

2.  After installing Failover Manager, invoke the `efm upgrade-conf` utility to create the `.properties` and `.nodes` files for Failover Manager 4.6. The Failover Manager installer installs the upgrade utility ([efm upgrade-conf](07_using_efm_utility/#efm_upgrade_conf)) to the `/usr/edb/efm-4.6/bin directory`. To invoke the utility, assume root privileges, and invoke the command:

   ```shell
   efm upgrade-conf <cluster_name>
   ```

   The efm `upgrade-conf` utility locates the `.properties` and `.nodes` files of preexisting clusters and copies the parameter values to a new configuration file for use by Failover Manager. The utility saves the updated copy of the configuration files in the `/etc/edb/efm-4.6` directory.

3.  Modify the `.properties` and `.nodes` files for Failover Manager 4.6, specifying any new preferences. Use your choice of editor to modify any additional properties in the properties file (located in the `/etc/edb/efm-4.6` directory) before starting the service for that node. For detailed information about property settings, see [The cluster properties file](04_configuring_efm/01_cluster_properties/#cluster_properties).

!!! Note
    `db.bin` is a required property. When modifying the properties file, ensure that the `db.bin` property specifies the location of the Postgres `bin` directory.

4.  If you're using Eager Failover, you must disable it before stopping the Failover Manager cluster. For more information, see [Disabling Eager Failover](04_configuring_efm/06_configuring_for_eager_failover/#disabling-eager-failover).

5. Use a version-specific command to stop the old Failover Manager cluster. For example, you can use the following command to stop a version 4.4 cluster:

   ```shell
   /usr/efm-4.4/bin/efm stop-cluster efm
   ```

6. Start the new [Failover Manager service](08_controlling_efm_service/#controlling_efm_service) (`edb-efm-4.6`) on each node of the cluster.

The following example shows invoking the upgrade utility to create the `.properties` and `.nodes` files for a Failover Manager installation:

```text
[root@hostname ~]# /usr/edb/efm-4.6/bin/efm upgrade-conf efm
Checking directory /etc/edb/efm-4.5
Processing efm.properties file

The following properties were added in addition to those in the previous installed version:
        pid.dir

Checking directory /etc/edb/efm-4.5
Processing efm.nodes file

Upgrade of files is finished. The owner and group for properties and nodes files have been set as 'efm'.
[root@hostname ~]#
```

If you're [using a Failover Manager configuration without sudo](04_configuring_efm/04_extending_efm_permissions/#running_efm_without_sudo), include the `-source` flag and specify the name of the directory in which the configuration files reside when invoking `upgrade-conf`. If the directory isn't the configuration default directory, the upgraded files are created in the directory from which the `upgrade-conf` command was invoked.

!!! Note
    If you're using a unit file, manually update the file to reflect the new Failover Manager service name when you perform an upgrade.

## Uninstalling Failover Manager

!!! Note
    If you are using custom scripts, check to see if they are calling any Failover Manager scripts. For example, a script that runs after promotion to perform various tasks and then calls Failover Manager's `efm_address` script to acquire a virtual IP address. If you have any custom scripts calling Failover Manager scripts, update the custom scripts to use the newly installed version of the Failover Manager script before uninstalling the older version of the Failover Manager script.

After upgrading to Failover Manager 4.6, you can use your native package manager to remove previous installations of Failover Manager. For example, use the following command to remove Failover Manager 4.4 and any unneeded dependencies:

-   On RHEL or CentOS 7.x:

```shell
yum remove edb-efm45
```

-   On RHEL or Rocky Linux or AlmaLinux 8.x:

```shell
dnf remove edb-efm45
```

-   On Debian or Ubuntu:

```shell
apt-get remove edb-efm45
```

-   On SLES:

```shell
zypper remove edb-efm45
```

## Performing a maintenance task

You can perform maintenance activities such as an OS patch or a minor database version upgrade. You can upgrade from one minor version to another (for example, from 10.1.5 to version 10.2.7) or apply a patch release for a version.

First, update the database server on each standby node of the Failover Manager cluster. Then, perform a switchover, promoting a standby node to the role of primary in the Failover Manager cluster. Then, perform a database update on the old primary node.

On each node of the cluster, perform the following steps to update the database server:

1.  Stop the Failover Manager agent.
2.  Stop the database server.
3.  Update the database server.
4.  Start the database service.
5.  Start the Failover Manager agent.

For detailed information about controlling the EDB Postgres Advanced Server service or upgrading your version of EDB Postres Advanced Server, see the [EDB Postgres Advanced Server Guide](/epas/latest/)

When your updates are complete, you can use the [efm set-priority](07_using_efm_utility/#efm_set_priority) command to add the old primary to the front of the standby list (if needed), and then switchover to return the cluster to its original state.
