---
title: "Load Balancing"
---

<div id="load_balancing" class="registered_link"></div>


EDB Ark uses pgPool functionality to implement automatic load balancing. Load balancing increases system performance by distributing client queries to replica nodes, while routing database modifications to the master node. Any modifications to the master node are subsequently propagated to each replica using Postgres streaming replication.

**Utilizing Load Balancing**

By default, load balancing is enabled on an EDB Ark cluster. To utilize load balancing, you should direct client applications to connect to the load balancing port (by default, 9999). A cluster's load balancing port number is displayed in the LBPORT column on the Details pane of the Clusters tab of the Ark console.

pgPool may direct the following statement types to *either* a primary or a standby node:

  - SELECT statements (not listed below)
  - COPY TO
  - DECLARE
  - FETCH
  - CLOSE
  - SHOW
  - SET
  - DISCARD
  - DEALLOCATE ALL

When deciding which node a query should be routed to, pgPool checks the transaction log number; if the transaction log number on the standby server is lower than the log number on the master, pgPool routes the statement to the master node. This helps to ensure that the data returned by the query is the most recent available.

In some cases, specific clauses within a query statement will signal pgPool to direct a statement to the master node. In other cases, the transaction type, or order of commands within a transaction can direct a statement to the master node. By default, the following transaction types will always be executed on the master node:

  - SELECT INTO, SELECT FOR UPDATE or SELECT FOR SHARE statements
  - SELECT statements within SERIALIZABLE transactions
  - SELECT statements that follow an INSERT statement
  - SET SESSION CHARACTERISTICS AS TRANSACTION… READ WRITE statements
  - SET transaction_read_only = off statements
  - EXPLAIN and EXPLAIN ANALYZE SELECT statements
  - START TRANSACTION… READ WRITE statements
  - LOCK commands that are stricter than ROW EXCLUSIVE MODE
  - Transactions that start with a BEGIN statement
  - The nextval() and setval() sequence functions
  - Large objects creation commands

Please Note: If your application uses JDBC, and the autocommit option is set to false, the JDBC driver will include a BEGIN and COMMIT statement with each SELECT statement. To enable load balancing when using the JDBC driver, your application must include a call to setAutoCommit(true).

pgPool directs the following non-query statement types to the master node only:

  - INSERT
  - UPDATE
  - DELETE
  - COPY FROM
  - TRUNCATE
  - CREATE
  - DROP
  - ALTER
  - COMMENT
  - PREPARE TRANSACTION
  - COMMIT PREPARED
  - ROLLBACK PREPARED
  - LISTEN
  - UNLISTEN
  - NOTIFY
  - VACUUM

**Selectively Enforcing Load Balancing**

pgPool does not enforce load balancing for `SELECT` statements with a leading white space or leading comment. For example, the following statement would be directed to the master node:

> `/*Ignore load balancing*/ SELECT * FROM emp;`

To enforce load balancing of `SELECT` statements with leading white space or comments, modify the `pgpool.conf` file, and set the `ignore_leading_white_space` parameter to `true`.

You can also use the `black_list` and `white_list` parameters (located in the `pgpool.conf` file) to instruct pgPool to direct specific statements or functions to the master node. This is useful for cases where a `SELECT` statement (normally directed to a replica) calls a function that in turn might modify the database, and so should be directed to the master.

**Monitoring Load Balancer Health**

By default, EDB Ark monitors the health of the load balancer to ensure that service is not interrupted. If the load balancer (pgpool) should fail while monitoring is enabled, PgPool will be automatically restarted. If the load balancer cannot be automatically restarted, EDB Ark will display a warning sign next to the cluster name on the Details panel and send a notification email to the cluster user.

Deselect the Monitor Load Balancer Health checkbox (located on the Details panel of the Clusters tab) to indicate that you do not wish for load balancer health to be monitored and automatically restarted if an interruption in service is detected.
