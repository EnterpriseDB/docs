---
title: Configuring a Thales CipherTrust Manager key as key wrapper for TDE
navTitle: Configuring Thales key as wrapper
description: Learn how to secure your encryption key with a Thales management key.
deepToC: true
---

You can configure TDE to use an external key from Thales CipherTrust Manager to wrap the data encryption key with a key from the Thales key store. This integration uses Thales REST API to allow cryptographic operations to directly connect to Thales CipherTrust Manager, bypassing other intermediate protocols.

To implement this integration, EDB provides two scripts that simplify the key creation and configuration of data key encryption/decryption processes:

- `edb_tde_createkey.py` uses the REST API to help you create an AES key on CipherTrust Manager.

- `edb_tde_crypto.py` uses the REST API to help you set up encryption and decryption commands with the created AES key.

## Overview

The configuration process consists in the following steps: 

1. Review the [prerequisites](#prerequisites).

1. [Install the package](#installing-the-scripts-package) with the scripts.

1. [Create the certificate for authentication](#creating-a-certificate-for-authentication). 

1. Create an AES 256 key on CipherTrust Manager. 

1. Configure TDE to use the created key as a wrapper for encryption and decryption.

## Prerequisites

- Ensure you have Python3 installed with `python3 --version`. If not, [install it](https://www.python.org/downloads/). 
- Ensure your Python3 installation includes the base64 encode and decode library (it includes the library per default).
- Install the [/jq command line JSON parser](https://jqlang.org/)

## Installing the scripts package

`edb_tde_createkey.py` and `edb_tde_crypto.py` are provided via a downloadable package you can obtain from the EDB repository. 

```shell
# TBD, maybe we'll need templating for this depenedin on the OS we need to support
dnf/zypper/apt-get 
```

## Creating a certificate for authentication

1.  Access your Thales CipherTrust Manager instance. 

1.  Navigate to the **CSR tool** under **CA**:

    ![Navigate to CSR tool](./images/01_CSR_tool.png)

1.  Create CSR. Ensure you use the RSA and 2048 and select **Create**: 

    ![Create CSR](./images/02_CSR_creation.png)
	
	In the same pop-up window, after the certificate has been created successfully, select **save csr** and **save private key**. You download a `CSR.pem` and `key.pem`.

	![Download the CSR](./images/03_CSR_creation_download.png)

1.  Link the CSR to a certificate authority (CA). Navigate to **CA** > **Local**.

    ![Navigate to local CA](./images/04_local_CA.png)

1.  Select a local CA. You can use the default local CA provided by CipherTrust. Then, select **Upload CSR**:

    ![Upload CSR to CA](./images/05_local_CA_selected.png)

1.  Enter the previously assigned **Display name**, paste the contents of the downloaded `CSR.pem` file and select **Issue Certificate**: 
    
	![Enter CSR details to issue a certificate](./images/06_enter_pem_contents.png)

1.  Download the `Certificate.pem` certificate: 

    ![Download the issued certificate](./images/07_download_certificate.png)

1.  Update your user configuration to allow certificate-based login. Navigate to **Access Management** > **Users** and select your user.

1.  Under **LOGIN**, enable **Allow user to login using certificate**, and enter a Certificate Subject Distinguished Name with `CN=` prefix: 

    ![Enable user to connect through certificate](./images/08_update_user_cert_login.png)

## Creating an AES key on Thales CipherTrust Manager

## Integrating with TDE for encryption and decryption 