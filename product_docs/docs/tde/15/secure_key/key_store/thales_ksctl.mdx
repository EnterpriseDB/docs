---
title: Configuring Thales as key store with ksctl
navTitle: Thales key store with ksctl
description: Learn how to secure your encryption key with a Thales management key using ksctl.
deepToC: true
---

You can configure TDE to use an external key from Thales CipherTrust Manager to wrap the data encryption key. Use `ksctl`, Thales CLI toolkit to configure the integration.

## Prerequisistes

- [Install the CLI Toolkit](https://thalesdocs.com/ctp/cm/latest/get_started/deployment/install-cli-toolkit/index.html)
- Optional: To simplify CLI usage, we recommend renaming the image name from `ksctl-darwin-amd64`, `ksctl-linux-amd64`, or `ksctl-win-amd64.exe` to `ksctl`.
- Ensure you move the image file to a directory within your PATH.

## Creating a configuration file

1.  Create a `ksctl` configuration file called `config.yaml` in the `.ksctl` directory with the following content: 

    ```
    KSCTL_VERBOSITY: false
    KSCTL_RESP: json
    KSCTL_USERNAME: *****
    KSCTL_PASSWORD: *********
    KSCTL_URL: https://**.***.***.***
    KSCTL_JWT:
    KSCTL_NOSSLVERIFY: true
    KSCTL_TIMEOUT: 30
    ```

    !!!note 
        Use the same credentials as the ones you use to access your Thales CipherTrust Manager UI account. 

## Creating an AES encryption key

1.  Create an AES encryption key with the `ksctl` utility: 

    ```
    ksctl keys create --name testkey --alg AES --size 256 --noexport --usage-mask 12
    ```

    This command creates a key named `testkey`, with AES-256 encryption algorithm , [noexport?], assigns cryptographic mask 12 (for encryption and decryption functionality only). See [Create a Key](https://thalesdocs.com/ctp/cm/latest/admin/cm_admin/keys/index.html#create-a-key) or run `ksctl keys create --help` for more key creation options. 

1.  Confirm the key was created: 

    ```
    ksctl keys get --name 'testkey'
    __OUTPUT__
    {
    	"id": "24360eab449640bebdc0b16ec1d65ef61beb363481f34638b82918064ab27ce2",
    	"uri": "kylo:kylo:vault:keys:testkey-v0",
    	"account": "kylo:kylo:admin:accounts:kylo",
    	"application": "ncryptify:gemalto:admin:apps:kylo",
    	"devAccount": "ncryptify:gemalto:admin:accounts:gemalto",
    	"createdAt": "2025-01-13T07:04:51.330901Z",
    	"name": "testkey",
    	"updatedAt": "2025-01-13T07:04:51.330901Z",
    	"usage": "blob",
    	"usageMask": 12,
    	"meta": {
    		"ownerId": "local|a0a89746-5db8-47d3-a64f-149b89d552a5"
    	},
    	"version": 0,
    	"algorithm": "AES",
    	"size": 256,
    	"unexportable": true,
    	"undeletable": false,
    	"neverExported": true,
    	"neverExportable": true,
    	"emptyMaterial": false,
    	"defaultIV": "acf0b7b2fca92732a835ac3ac3b895ab",
    	"sha1Fingerprint": "61ebe4f1117ed4e7",
    	"sha256Fingerprint": "a388a1e76436060ce523325b292254dc234b8e61ef485f4b5ae045298250440b",
    	"objectType": "Symmetric Key",
    	"activationDate": "2025-01-13T07:04:51.32435Z",
    	"state": "Active",
    	"aliases": [
    		{
    			"alias": "testkey",
    			"type": "string",
    			"index": 0
    		}
    	],
    	"uuid": "e97888f1-4d4f-4559-a37b-63bc0c837a6c",
    	"muid": "e97888f1-4d4f-4559-a37b-63bc0c837a6c7daed8fc-35a7-4b95-b37d-c342e1bd4767"
    }
    ```

    You can also confirm the key was created via the Thales CipherTrust Manager Portal. Go to **Access Management** > **Keys**. Select the key name to display more details. 

1.  Run a simplified encryption and decryption test. Replace the flag values in the following example with your key's values: 

    ```
    ksctl crypto encrypt -k testkey -l 'abcdefg' -i 'acf0b7b2fca92732a835ac3ac3b895ab' -m 'cbc'
    ```

    This command uses the default [Initialization Vector](https://thalesdocs.com/ctp/cm/latest/reference/xml/supp-key-algo/index.html#initialization-vectors) (`"defaultIV"` value from the `get --name` output of the previous step), a dummy text to encrypt `'abcdefg'` and [what does the -m flag do?]. 

    ```
    ksctl crypto decrypt -c
    ```

## Adding encryption and decryption



    


