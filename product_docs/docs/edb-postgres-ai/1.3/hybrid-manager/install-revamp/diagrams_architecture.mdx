---
title: Planning the architecture
navTitle: Planning architecture
description: Plan and document your Hybrid Manager platform architecture.
deepToC: true
---

# Architectural discovery

The goal of architectural discovery is to navigate and then document the necessary decisions to successfully deploy Hybrid Manager (HM) in your environment. 
These decisions form the blueprint for meeting infrastructure requirements (phase 2) and installing Kubernetes (phase 3).  These questions cover a very broad set of considerations extending just the database layer.  

This guide focuses on two perspectives:

* **Current state:** Where your existing database and application workloads are today.
* **Target state:** Where you intend to deploy Hybrid Manager immediately, and where you plan to expand over the next 1–2 years.

Acquiring and reviewing **diagrams** of your current and target environment is the most efficient way to complete this phase.

---

## Locality: where will Hybrid Manager live?

Understanding the physical or logical locations of your database and dependent applications is crucial for determining the necessary architecture.

* **Questions to answer:**
    * Where is the current database solution located in terms of **cloud regions (CSP)** or **physical data centers (on-premise)**?
    * Where are the dependent application workloads for these databases located?
    * Are there **upstream layers of dependency**, and where are those located?

* **Analysis:**
    * Locality determines the initial scope of the deployment (e.g., single cloud region vs. multi-region).
    * If you plan to span multiple regions, clouds, or hybrid cloud environments, **Postgres Distributed** is likely the appropriate database service recommendation.
    * The locality of upstream applications is key to minimizing network latency.

---

## Disaster recovery (hot/cold standby)

Disaster recovery (DR) ensures business continuity across different locations.

* **Questions to answer:**
    * How is disaster recovery, as a subset of business continuity, accomplished across these locations, or is there an **additional location assigned specifically as disaster recovery**?
    * How is disaster recovery capability **validated**, and how often?

* **Analysis:**
    * Having a dedicated secondary location indicates a strong architectural requirement.
    * If no formal DR practice exists, the HM DBaaS far-away replica solution may provide new capabilities.

---

## Activeness (active/passive vs. active/active)

Activeness describes how your distributed locations are utilized for critical workloads.

* **Questions to answer:**
    * If you have multiple locations, how does the critical dependent workload utilize these systems?
    * Is one location active and the other passive in terms of transaction processing (OLTP)?
    * Is one location active for OLTP, and the other active for analytical processing (OLAP/BI)?

* **Analysis:**
    * If your target state requires simultaneous writes to multiple database instances (i.e., true **active/active** across locations), **Postgres Distributed** is the required solution due to its multi-writer capability.
    * Understanding whether a location is passively waiting (cold standby) or actively running (hot standby) helps define resource requirements and recovery time objectives (RTO).
    * **Business continuity:** The architectural choices around active/passive, active/active, and standby models must balance the organization's tolerance for downtime/data loss against the cost of maintaining redundant systems.

These topics naturally follow the discussion of Activeness and help complete the picture of your application ecosystem.

* Ingress traffic routing in terms of the consuming application.
* Replication at various application layers.
* Caching layers (and their location relative to the database).
* Session demands (e.g., is session replication handled at the application layer?).

---

## Lifecycle operations

Understanding your operations practices helps determine the complexity of the Kubernetes environment required to manage the database service.

* **Questions to answer:**
    * How are components upgraded, and are the locations utilized in a particular pattern to support lifecycle operations patterns such as **Blue/Green** or **Canary**?
    * Consider both **DML and DDL updates** (data and schema) or **engine upgrades** such as database major versions?
    * What **pre-production environments** (staging, development, testing) are included in preparing for production lifecycle operations?

* **Analysis:**
    * Practices like Blue/Green deployment demonstrate capability that aligns well with the micromanaged upgrade and zero-downtime features offered by EDB's database solutions.

    * The existence and number of pre-production environments influence the total cluster count and resource sizing.
---

## Kubernetes: broad considerations
Supported platforms:
- Amazon EKS (Elastic Kubernetes Service)
- Google GKE (Google Kubernetes Engine)
- Rancher RKE2 (Rancher Kubernetes Engine)
- Red Hat OpenShift (RHOS)

Considerations:
- Hybrid Manager and Kubernetes have a 1:1 relationship—each HM deployment requires its own dedicated Kubernetes cluster.
- The Kubernetes cluster must be dedicated to Hybrid Manager at this time; sharing with other workloads is not supported.
- The customer is responsible for the full lifecycle management of the Kubernetes cluster (provisioning, upgrades, scaling, etc.)

---

## Hybrid Manager distributed reference architecture

This reference architecture, while requiring significant infrastructure (e.g., nine data centers), represents the ultimate architectural goal for achieving the highest levels of SLA and scale.

![Hybrid Manager Reference Architecture](../images/HCP_reference_architectures-reference.svg)

# Hybrid Manager Architectures

## Hybrid Manager Control Plane
The minimum install for Hybrid Manager colocates the Hybrid Manager control plane on the Kubernetes control nodes, although the pattern is slightly different in case of deployment on a CSP.  This mimimum architecture is fully functional for using Hybrid Manager to centralize a view of your Postgres and Oracle Estate using the Agent and facilitates Database Migration capabilities as well.  GenAI is also present in this deployment although it's capabilities will be limited due to the lack of Hybrid Manager operated Postgres instances.

![Hybrid Manager Minimum](../images/HCP_reference_architectures-minimum.svg)

### Diagram Legend

The legend defines the colors and logical groupings used in the architecture diagram:

* **Locality:** The highest-level physical or logical grouping, such as a physical data center or a geographical region (e.g., "City 1" and "Data Center 1").  
* **Kubernetes Cluster:** The complete Kubernetes environment, including all control plane and worker nodes, that hosts the entire platform.  
* **EDB Hybrid Manager:** The logical boundary for the core HM components. This is typically implemented as a dedicated Kubernetes namespace (e.g., control-plane).  
* **Compute Machine:** The virtual machines (e.g., vm01, vm02, vm03) that serve as the Kubernetes worker nodes, providing the CPU, memory, and storage for the cluster.  
* **Infrastructure Abstraction:** This critical layer represents Kubernetes-native resources that abstract underlying physical or virtual infrastructure. These resources must be provided by the Kubernetes cluster's environment.  
  * **Example 1: type: LoadBalancer**: This is a Kubernetes Service type that requests an external load balancer. In public cloud environments (like AWS, GCP, Azure), this is automatically provisioned as a managed service. In on-premises or bare-metal deployments, you must provide a solution (like MetalLB) to fulfill these LoadBalancer requests.  
  * **Example 2: StorageClass**: This resource abstracts the "Block Storage" and "Object Storage" requirements. It maps Kubernetes storage requests (Persistent Volume Claims) to actual, provisioned storage hardware or software (like local-pv, Ceph, vSphere, or cloud-based disks).

### External Requirements

These are the prerequisite services and infrastructure that must be available in your environment **before** you can deploy the Hybrid Manager. They are dependencies that the platform relies on but does not provide.

* **Container Registry:** Customer provided capability to which the EDB container registry namespace should be synchronized.
* **Domain Name Service:** Domain name resolution capability should be consistent across the entire fault domain including dependent workloads and engineers operating the platform.
* **Identity Provider:** An external LDAP or SAML service for user authentication via OIDC. See [Security and access management](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/install/customization/byo_idp/).  
* **Local Network:** The underlying network infrastructure allowing communication to and from the cluster.  In the cloud this is a properly configured VPC whereas on-premise it includes decisions about physical connectivity and switching with virutalized local area networking and link aggregation.
* **Key Management Service (KMS):** An external service to manage and store encryption keys specifically for the Transparent Data Encryption feature. See [KMS for TDE](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/install/customization/kms_for_tde/).  
* **Block Storage:** The requirement is a storage class which presents persistent, high-performance storage volumes to pods. This is typically used for database storage and is mapped via a Kubernetes StorageClass to underlying storage solutions.
* **Object Storage:** S3 compatible object storage for unstructured data, Postgres backups, parquet files and Hybrid Manager recover and mulit-location capabilities.
* **Certificate Signer Authority:** An internal or external CA to issue and sign TLS certificates for secure communication. See [Certificate Management](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/install/customization/cert-man/).


### Hybrid Manager Control Plane

These are the core microservices that make up the Hybrid Manager platform, running inside the Kubernetes cluster (within the "EDB Hybrid Manager" boundary).

* **GenAI**: Provides AI/ML capabilities. See [GenAI in Hybrid Manager](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/ai-factory/gen-ai/)
* **Postgres Lifecycle Operations**: Manages deployment, scaling, and updates. See [Using Hybrid Manager](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/cluster_management/)  
* **Telemetry**: Collects and reports metrics. See [Monitoring and observability](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/#monitoring-and-observability)  
* **Database Migration Assistant**: Assists with database migrations. See [Database migration](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/migration/)  
* **AuthN/AuthZ**: Handles authentication and authorization. See [Security and access management](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/#security-and-access-management)  
* **Estate**: Manages resource inventory. See [External Databases](https://www.enterprisedb.com/docs/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/)  
* **Federation**: Manages authentication and authorization across multiple Hybrid Manager instances.

## Hybrid Manager Data Plane (Postgres Lifecycle Orchestration)

The next step beyond the Hybrid Manager Control Plane is the Data Plane comprised primarily of Postgres centered capabilities extended into AI and Analytics functionality.

![Hybrid Manager Fully Featured](../images/HCP_reference_architectures-dbaas.svg)

## Hybrid Manager fully featured deployment

This view shows a fully capable Hybrid Manager deployment, including resources like GPU acceleration.

![Hybrid Manager Fully Featured](../images/HCP_reference_architectures-full-featured.svg)

## Hybrid Manager multi-location (hub and spoke)

The multi-location capability is primarily a DBaaS offering following a hub and spoke model.
1.  As a DBaaS offering, many additional capabilities are not available on the secondary Hybrid Manager.
2.  The primary HM controls the secondary (not vice versa). Eventually, multiple secondaries will be supported.
3.  Connectivity from the primary to the secondary is via load balanced endpoints, not a network mesh service (like Submariner).

![Hybrid Manager Multi-Location](../images/HCP_reference_architectures-multi-location.svg)

---

# Building your `values.yaml`

The decisions made during this discovery process will directly populate critical initial entries in your configuration file.

The `system` and `beacon_location_id` are determined by your architecture:

```yaml
system: <Kubernetes_Flavor>
bootstrapImageName: https://docker.enterprisedb.com/pgai-platform/edbpgai-bootstrap/bootstrap-<Kubernetes_Flavor>
bootstrapImageTag: <Version>
parameters:
  upm-beacon:
    beacon_location_id: <Deployment_Location_Name>
```