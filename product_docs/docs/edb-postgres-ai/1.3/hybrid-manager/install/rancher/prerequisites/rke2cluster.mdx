---
title: Creating a Rancher RKE2 cluster for use with Hybrid Manager
navTitle: Create RKE2 cluster
description: Learn how to create a Rancher RKE2 cluster for installing PG AI Hybrid Manager.
deepToC: true
---

## Compute requirements

### Control plane

- **3 machines minimum**
- **Specifications**: 16vCPU / 32GiB memory each
- **Availability**: Distributed across three availability zones
- **Storage**: At least 100GB local disk per machinery

### Postgres node fleet

- **3 machines minimum**
- **Specifications**: 16vCPU / 32GiB memory each
- **Scaling**: Adjust quantity/size based on workload requirements

## Network requirements

### CNI and IP addressing

- **CNI**: Working Container Network Interface (using Calico)
- **IP Space**: /16 IPv4 address space for each downstream Kubernetes cluster

### DNS requirements

- **DNS zone**: Must be available
- **DNS record**: Must point to the ingress endpoint (load balancer IP or NodePort IP) of the Hybrid Manager (HM) application

### Certificate node_management

- **Preferred**: [Custom certificates]()
- **Fallback**: Self-signed certificates (auto-generated)

## Load balancer controller

### Requirements

- **Load balancer controller** required if using `LoadBalancer` type services
- **Alternative**: Configure installation and services as 'NodePort'

### NodePort configuration

Configure the installation values.yaml if no Load Balancer controller is available.

```yaml
beaconAgent:
  provisioning:
    loadBalancerEnabled: false
    nodePortDomain: "<your nodeportdomain url here>"
```

!!! Note
    The `nodePortDomain` value is used as the URL for all Postgres clusters/instances.
    It should be a DNS name pointing to the IP addresses of the nodes where Postgres clusters/instances are running.
!!!

### Port requirements

#### Load balancer configuration

If you are using a load balancer, open the following ports:

- 443
- 8444
- 9443
- 9445

### NodePort configuration

If you are using NodePort for ingress instead of a load balancer, refer to the required ports:

- `ingress_http_node_port: "32542"`
  - This is the HTTP port of the portal.

- `ingress_https_node_port: "30288"`
  - This is the HTTPS port of the portal. 

- `ingress_grpc_tls_node_port: "30290"`
  - This is the GRPC port for the Beacon agent.

- `ingress_spire_tls_node_port: "30292"
  - This is the Spire TLS port.

## Storage Requirements

- **Block storage**: Working Kubernetes storageClass within the cluster
- **Volume Snapshots**: Volume snapshot classes within the cluster
- **Object Storage**: S3-compatible [object store]()

## Container registry

- Container registry **must** be accessible from the Rancher cluster
- This is to host Hybrid Manager images

## Identity Provider

- Optional but recommended
- This is to integrate with your identity provider (IDP)

## GPU

The Rancher UI currently misses some instance types with GPU when creating a machine pool.
The following workaround is recommended:

1. Create a machine pool with any instance type, and set the number as `0`.
2. Update the machine pool with the instance type having the GPU, for example, g6e.12xlarge. The Rancher UI shows missing instance types when updating the machine pool.
3. Scale up the machine pool.

!!! Note
Currently, the Rancher 


