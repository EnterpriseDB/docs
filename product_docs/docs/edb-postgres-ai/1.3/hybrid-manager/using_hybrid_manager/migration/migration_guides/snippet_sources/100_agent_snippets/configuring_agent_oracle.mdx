---
title: Configuring the HM Agent to register your Oracle database
navTitle: Configuring 
description: Configure the HM Agent to connect to your Oracle database.
---

Configure the HM Agent (deployed as `beacon-agent`) to allow it to connect to your Hybrid Manager (HM) and fetch monitoring data from the source database.

## Prerequisites

-   You [created a machine user and access key with the `estate ingester` role](/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/migration/migration_guides/oracle_to_hm_managed/agent_creating_machine_user/) assigned to it.

-   Request the administrator or installer of your HM instance to provide the hostname (URL) they set for the `beacon_server` service in the Helm chart configuration file used for installation. For this, they'll have to look up the value they set for `parameters.upm-beacon.server_host` (or `BEACON_SERVICE_DOMAIN_NAME`) in the `values.yaml` file. You will need this value later to configure the HM Agent.

-   The HM Agent requires a trusted connection to the `beacon_server` service in your HM instance. If the server running the Agent doesn't inherently trust the HM's TLS certificate (managed by your organization's security infrastructure), request the administrator or installer of your HM instance to provide the file with the certificate. Store this certificate on the machine running the HM Agent. You will need to provide the directory path to this certificate later to configure the HM Agent.

    See [What is the root certificate?](/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/admin_tasks/#what-is-the-root-certificate-ca) for more information about the certificate and instructions for admin to download it.

- You have installed Oracle's SQL*Plus utility on the auxiliary machine you're using to run the Agent.

## Set environment variables

Ensure that following environment variables are available in your configuration.
These environment variables must be permanently available as they are required each time the HM Agent starts.

!!!info
    It is possible to set these values directly in the config files, but as they contain secrets it is generally advisable to handle them as environment variables managed through a secrets manager.

1.  Set `BEACON_AGENT_ACCESS_KEY` to the access key you obtained from the console when you created a machine user. To set this value for a terminal session:

    ```shell
    export BEACON_AGENT_ACCESS_KEY=<access_key>
    ```

1.  Set the `DSN` environment variable to the Data Source Name (DSN) of the database you want to migrate. The `<username>` and `<password>` correspond to the user you granted permissions when preparing the database. To set this value for a terminal session:

    ```shell
    export DSN="oracle://<username>:<password>@localhost:8999/<oracle_db_name>"
    ```

    For example: 

    ```shell
    export DSN="oracle://oracle:oracle@localhost:1521/ORCLPDB1"
    ```

    If you plan to connect to more than one database with then HM Agent, you can specify multiple such variables, for example `DSN1`, `DSN2`. 
    You can use any name you wish for these variables because they will be referenced by name in the configuration file.

1.  Set the administrator-provided hostname (URL) for `parameters.upm-beacon.server_host` (or `BEACON_SERVICE_DOMAIN_NAME`) as an environment variable, so the HM Agent can access the correct service endpoint.
    
    To export it as an environment variable for this terminal session:

    ```shell
    export BEACON_SERVICE_DOMAIN_NAME=<beacon_service_domain_name>
    ```
      
1.  You need the project ID for the project you are using for this migration. From the HM console, navigate to your project. In the URL displayed in the browser, look for the ID with the `prj_` prefix. For example, if your browser displays this URL:
    
    ```shell
    https://portal.example.com/projects/prj_5Wuqyl5JtpvxjiYC/clusters
    ```

    In this example, the project ID is `prj_5Wuqyl5JtpvxjiYC`.

    Export your project ID as an environment variable for this terminal session, so the HM Agent can access the project you are using for this migration:

    ```shell
    export PROJECT_ID=<HM_console_project_ID>
    ```

## Prepare a configuration file

1.  Create an HM Agent configuration directory in your home directory:

    ```shell
    mkdir ${HOME}/.beacon
    ```

    !!!Note
    If the location specified above is not convenient, you also use either:

    - `/etc/beacon`
    - The directory from which you execute any `beacon-agent` command. 
    
    The HM Agent looks for its configuration file starting with `/etc/beacon`, then `${HOME}/.beacon`. As a final fallback, it searches the directory from which it's executed.
    !!!

1.  Inside this directory, create a new file `beacon_agent.yaml`:

    ```shell
    touch .beacon/beacon_agent.yaml
    ```

1.  Copy and paste the following template into the new file. This template is designed to enable the HM console to generate a migration assessment, as well as ingest all schemas for assessment and import. To control schema ingestion (for example, to exclude or include schemas), see [Controlling schema ingestion](/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/configure_agent/schema_ingestion/).

    ```yaml
    ---
    agent:
      access_key: $BEACON_AGENT_ACCESS_KEY
      beacon_server: $BEACON_SERVICE_DOMAIN_NAME:9443
      project_id: $PROJECT_ID
      providers:
        - onprem
      root_ca_path: ""
      schema_providers:
        - "onprem-schema"
    provider:
      onprem:
        databases:
          - resource_id: "<resource_id>"
            dsn: $DSN
            schema:
              enabled: true
              poll_interval: 15s 
            tags:
              - "<tag_names>"
    ```

1.  Replace all `< >` placeholders with appropriate values. 

    - `"<resource_id>"`: User-defined identifier for resource management. Record a unique `"<resource_id>"` value and reuse it when configuring the DMS Agent for migrations. This consistency is essential for the DMS to correctly correlate the resource across both the HM Agent and DMS Agent components.
  
    - `"<tag_names>"`: User-defined labels for resource management.

    - `root_ca_path:`: Set to `""` if your organization has configured the machine where HM Agent runs to trust HM's TLS certificate. Otherwise, set this to the path where you have stored the administrator-provided certificate. 

    Refer to [Parameter reference](/edb-postgres-ai/latest/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/configure_agent/#parameter-reference) for explanations of each parameter and more detailed information on how to obtain the appropriate value.

The HM Agent is now configured, you may proceed to running or configuring the HM Agent to run as a service.
