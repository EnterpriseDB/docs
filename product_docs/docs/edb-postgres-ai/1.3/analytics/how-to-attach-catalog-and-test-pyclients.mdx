---
title: How-to  ttach the catalog and test PyIceberg/PySpark â†’ PGAA reads
navTitle: Attach catalog + test clients
description: Attach the Lakekeeper catalog, verify tables in PGAA, and test access with PyIceberg and PySpark.
---
# Distributed Catalog Import with PGD High Availability

## Prerequisites

### Technical Requirements
- PostgreSQL with PGD (Postgres Distributed) High Availability configured
- PGAA extension with catalog registration completed
- Active network connectivity to Iceberg REST catalog
- Administrative privileges for DDL command replication
- EDB Hybrid Manager deployment with PGD testing validation

### Knowledge Requirements
- Understanding of PostgreSQL DDL replication concepts
- Familiarity with PGD High Availability command execution patterns
- Basic knowledge of Apache Iceberg table structures
- Awareness of transactional vs. analytical table distinctions

### Environment Setup
- PGD cluster with active high availability nodes
- Previously registered `lakekeeper-test` catalog (see prerequisite documentation)
- Network access to external data sources
- EDB Hybrid Manager monitoring and management interface configured

## Goals and Objectives

### Primary Goals
1. **Replicate Catalog Attachment**: Distribute catalog connection across PGD High Availability cluster nodes
2. **Validate Distributed Access**: Confirm external data accessibility from all cluster members
3. **Test Transactional Isolation**: Verify local tables remain protected during catalog operations

### Learning Outcomes
- Master PGD High Availability DDL replication for catalog management operations
- Understand interaction patterns between external catalogs and local transactional data
- Develop proficiency in hybrid data access validation procedures

## Key Takeaways

### Technical Capabilities
- **Distributed Catalog Management**: Synchronize external catalog access across database cluster
- **Hybrid Data Architecture**: Seamlessly combine transactional and analytical workloads
- **Replication Safety**: Maintain transactional integrity during external catalog operations

### Operational Benefits
- **Cluster-Wide Analytics**: Enable external data access from any PGD node
- **Fault Tolerance**: Preserve catalog connectivity during node failures
- **Development Consistency**: Ensure uniform data access patterns across environments

---

## Implementation Guide

### Step 1: Replicate Catalog Attachment Command

```sql
SELECT bdr.replicate_ddl_command($$
  SELECT pgaa.attach_catalog(
    'lakekeeper-test'
  )
$$);
```

**Function Analysis**:
- **`bdr.replicate_ddl_command()`**: Executes DDL operations across all active PGD High Availability nodes
- **Dollar Quoting**: `$$` syntax prevents SQL injection and handles nested quotes safely
- **`pgaa.attach_catalog()`**: Establishes catalog connection using previously registered configuration

**Replication Behavior**:
The PGD High Availability system ensures this command executes consistently across all cluster nodes, providing uniform catalog access regardless of connection endpoint. EDB Hybrid Manager tracks the replication status and validates successful execution across the distributed environment.

### Step 2: Validate External Data Accessibility

```sql
SELECT COUNT(*) FROM tpch_sf_1.lineitem;
```

**Expected Results**:
```
  count
---------
 6001215
(1 row)
```

**Verification Points**:
- **Row Count Consistency**: Confirms successful catalog attachment and data discovery
- **Cross-Node Access**: Validates that external tables are accessible from current PGD node
- **Performance Baseline**: Establishes reference metrics for large table operations

### Step 3: Examine Data Structure and Content

```sql
SELECT * FROM tpch_sf_1.lineitem LIMIT 1;
```

**Sample Output Analysis**:
```
 l_orderkey | l_partkey | l_suppkey | l_linenumber | l_quantity | l_extendedprice | l_discount | l_tax | l_returnflag | l_linestatus |     l_shipdate     |    l_commitdate    |   l_receiptdate    | l_shipinstruct | l_shipmode |                l_comment
------------+-----------+-----------+--------------+------------+-----------------+------------+-------+--------------+--------------+--------------------+--------------------+--------------------+----------------+------------+------------------------------------------
    5242311 |    170140 |      7692 |            4 |      38.00 |        45985.32 |       0.06 |  0.04 | A            | F            | 22-AUG-92 00:00:00 | 13-SEP-92 00:00:00 | 09-SEP-92 00:00:00 | NONE           | MAIL       | leep carefully about the furiously even
```

**Data Structure Verification**:
- **Order Management**: `l_orderkey`, `l_linenumber` provide transaction linking
- **Product References**: `l_partkey`, `l_suppkey` enable dimensional analysis
- **Financial Data**: Decimal precision maintained for monetary calculations
- **Temporal Information**: Date fields properly formatted for time-series analysis

**Important Note**: Row order is non-deterministic due to distributed storage characteristics. Focus on data integrity rather than specific record sequence.

### Step 4: Create Transactional Isolation Test

```sql
CREATE TABLE tpch_sf_1.sentinel_tx(value TEXT);
INSERT INTO tpch_sf_1.sentinel_tx VALUES ('still alive');
```

**Purpose and Design**:
- **Namespace Isolation**: Creates local transactional table in same schema as external catalog
- **Conflict Testing**: Verifies that catalog imports don't overwrite existing local tables
- **Data Integrity**: Ensures transactional ACID properties remain intact

**Table Characteristics**:
- **Schema Location**: `tpch_sf_1` matches external catalog schema namespace
- **Simple Structure**: Minimal design focuses testing on namespace behavior
- **Sentinel Pattern**: "Canary" table design detects unintended data modifications

## Critical Considerations

### PGD High Availability Replication Behavior
- **DDL Synchronization**: Catalog attachment replicates to all active nodes automatically
- **Node Consistency**: All cluster members gain identical external data access capabilities
- **Conflict Resolution**: PGD handles potential conflicts through established resolution policies
- **EDB Hybrid Manager Integration**: Monitoring and management interface provides visibility into replication status

### Namespace Management
- **Schema Overlap**: Local and external tables can coexist within same schema
- **Priority Handling**: Local transactional tables take precedence over external catalog tables
- **Metadata Separation**: PostgreSQL maintains distinct metadata for local vs. external objects

### Performance Implications
- **Network Dependencies**: Each PGD node requires independent connectivity to external catalog
- **Query Distribution**: External queries execute from the specific node handling the connection
- **Caching Behavior**: Catalog metadata may be cached differently across cluster nodes
- **EDB Monitoring**: Hybrid Manager provides performance metrics for distributed operations

### Transactional Guarantees
- **ACID Compliance**: Local tables maintain full transactional semantics
- **External Limitations**: Catalog tables may not support full PostgreSQL transaction isolation
- **Mixed Workloads**: Queries spanning local and external tables have limited transactional scope

## Troubleshooting Guidelines

### Common Issues
1. **PGD Replication Failures**: Verify all nodes are active and replication lag is minimal through EDB Hybrid Manager
2. **Catalog Connectivity**: Ensure network access from all cluster nodes to external services
3. **Schema Conflicts**: Monitor for naming collisions between local and external objects

### Diagnostic Queries
```sql
-- Verify PGD node status
SELECT node_name, node_status FROM bdr.local_node_summary;

-- Check catalog attachment across nodes
SELECT * FROM pgaa.catalogs WHERE catalog_name = 'lakekeeper-test';

-- Validate sentinel table integrity
SELECT * FROM tpch_sf_1.sentinel_tx;
```

### EDB Hybrid Manager Validation
- Monitor replication lag and node health through the management interface
- Verify catalog operations are reflected across all PGD High Availability nodes
- Review performance metrics for external catalog queries

## Business Applications

### Primary Use Cases
- **Enterprise Data Lake Integration**: Connect distributed PostgreSQL clusters to centralized data lakes
- **Multi-Region Analytics**: Enable consistent data access across geographically distributed PGD deployments
- **Hybrid Cloud Operations**: Combine on-premises transactional systems with cloud-based analytical storage

### Technical Benefits
- **High Availability Analytics**: Maintain external data access during node failures
- **Operational Simplicity**: Manage catalog connections through familiar PostgreSQL interfaces
- **Enterprise Monitoring**: Leverage EDB Hybrid Manager for comprehensive cluster oversight

---
