---
# IMPORTANT: Do not edit this file directly - it is generated from yaml source.
title: Trusted Postgres Architect 23.41.0 release notes
navTitle: Version 23.41.0
originalFilePath: product_docs/docs/tpa/23/rel_notes/src/tpa_23.41.0_rel_notes.yml
editTarget: originalFilePath
---

Released: 26 November 2025

New features, enhancements, bug fixes, and other changes in Trusted Postgres Architect 23.41.0 include the following:

## Highlights

- Perform updates of all cluster components - not just Postgres and PGD
- Hardening of the default Patroni configuration, with many new options to fine-tune security measures
- Support for minor version upgrades of PGD 6 (PGD-X and PGD-S)
- Support for Postgres 18

## Enhancements

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Secure etcd and Patroni defaults for new <code>tpaexec configure</code> clusters</summary><hr/><p>When creating a new cluster configuration using <code>tpaexec configure</code>, the
generated <code>config.yml</code> file will now automatically enable SSL/TLS encryption and
mutual TLS (mTLS) authentication for both <code>etcd</code> and <code>Patroni</code> by default. This
ensures that new deployments start with a secure communication baseline out-of-the-box.</p>
<p>The following variables are now set by default for new configurations:</p>
<ul>
<li><code>etcd_ssl_enabled: true</code></li>
<li><code>etcd_authentication_mode: mtls</code></li>
<li><code>patroni_ssl_enabled: true</code></li>
<li><code>patroni_authentication_mode: mtls</code></li>
</ul>
<p>Existing cluster configurations are unaffected by this change.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Support upgrade of components M1 and PGD/BDR clusters</summary><hr/><p>All cluster software components (failover managers, PEM, Barman, etc.) can now be updated, either to a specific
version by specifying the component package version in <code>config.yml</code> or to the
latest available when it is not provided. A list of components for upgrade can
be passed to the <code>--components</code> flag as a comma-separated list. If this flag is
not passed, <code>postgres</code> will be updated. Specifying <code>--components=all</code> will update
all applicable software components.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Improved automation of PGD5.9+ to PGD6 upgrade.</summary><hr/><p>For a PGD v5.9 to v6 migration, Connection Manager is a requirement instead
of PGD proxy. A new command <code>switch2cm</code> has been introduced to facilitate this
transition. The new command requires that the cluster's config.yml must be prepared
by running <code>tpaexec reconfigure &lt;cluster&gt; --enable-connection-manager</code>. https://www.enterprisedb.com/docs/tpa/latest/tpaexec-upgrade/#upgrading-from-pgd-always-on-to-pgd-x</p>
</details></td><td></td></tr>
<tr><td><details><summary>Communication with the <code>etcd</code> cluster can now be secured using SSL/TLS</summary><hr/><p>A new configuration parameter, <code>etcd_ssl_enabled</code>, has been introduced
to enable TLS encryption for all <code>etcd</code> communication. This significantly hardens
the security of the cluster''s distributed control plane. When <code>etcd_ssl_enabled</code>
is set to <code>true</code>:</p>
<ul>
<li>The deployment process automatically generates the required
TLS certificates for each <code>etcd</code> node. These certificates now include both DNS
and IP Subject Alternative Names (SANs) for robust validation.</li>
<li>Both peer-to-peer and client-server <code>etcd</code> connections are configured to use HTTPS.</li>
<li>Downstream components, including <strong>Patroni</strong> and internal health checks using <code>etcdctl</code>,
are automatically configured to connect to <code>etcd</code> securely over HTTPS.</li>
</ul>
<p>To maintain backward compatibility with existing deployments, this feature is disabled by
default (<code>etcd_ssl_enabled: false</code>).</p>
</details></td><td></td></tr>
<tr><td><details><summary>Mutual TLS (mTLS) Authentication for Patroni REST API</summary><hr/><p>Support for mutual TLS has been added to provide a more secure, certificate-based
authentication method for the Patroni REST API. A new configuration variable,
<code>patroni_authentication_mode</code>, is now available. You can set this to <code>mtls</code> to
enable this feature. When enabled (which requires <code>patroni_ssl_enabled: true</code>),
the deployment automation will:</p>
<ul>
<li>Configure the Patroni REST API server to require and validate client certificates.</li>
<li>Automatically configure clients, including <code>patronictl</code> and HAProxy health checks, with the necessary client certificates
and keys to connect securely.</li>
</ul>
<p>The default authentication mode remains <code>basic</code>
(username and password) to ensure backward compatibility with existing deployments.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Improve security of Patroni REST API with access <code>allowlist</code></summary><hr/><p>The security of the Patroni REST API has been enhanced by configuring an
<code>allowlist</code> for unsafe API endpoints (which accept <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>).
This measure prevents unauthorized nodes from performing administrative actions,
such as restarting a database node or changing the cluster configuration. The
<code>allowlist</code> is dynamically populated with the hostnames of the Patroni cluster
members based on the Ansible inventory, ensuring that only authorized nodes can
perform requests to these sensitive API endpoints.</p>
</details></td><td></td></tr>
<tr><td><details><summary>TPA now supports minor version upgrades for PGD-X</summary><hr/><p>The <code>tpaexec upgrade</code> command can now perform minor version upgrades of
postgres and PGD on a cluster running the PGD-X architecture. The upgrade process
checks cluster health and upgrades the nodes one at a time. This scenario supports
the use of <code>update_hosts</code> variable to upgrade a subset of the cluster when used
accordingly to the best practice recommendations found in the documentation.</p>
</details></td><td></td></tr>
<tr><td><details><summary>TPA now supports minor version upgrades for PGD-S</summary><hr/><p>The <code>tpaexec upgrade</code> command can now perform minor version upgrades of
postgres and PGD on a cluster running the PGD-S architecture. The upgrade process
checks cluster health and upgrades the nodes one at a time. This scenario supports
the use of <code>update_hosts</code> variable to upgrade a subset of the cluster when used
accordingly to the best practice recommendations found in the documentation.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Enable etcd Basic Authentication and Role-Based Access Control</summary><hr/><p>This release introduces a new capability to secure the etcd distributed
key-value store with client authentication. You can now enable basic authentication
and configure a dedicated user for Patroni with granular, least-privilege permissions.
A new configuration variable, <code>etcd_authentication_mode</code>, has been added to control
the feature. When set to <code>basic</code>, the deployment automation will:</p>
<ul>
<li>Set up an administrative <code>root</code> user.</li>
<li>Create a dedicated etcd user for Patroni, given by the new <code>patroni_etcd_user</code> configuration option, and grant it read-write permissions
limited to its cluster''s key prefix (e.g., <code>/tpa/cluster_name</code>).</li>
<li>Configure Patroni to automatically use these credentials to securely connect and authenticate
with etcd.</li>
</ul>
<p>To maintain backward compatibility, this feature is disabled by default
(<code>etcd_authentication_mode: none</code>).</p>
</details></td><td></td></tr>
<tr><td><details><summary>Mutual TLS (mTLS) Authentication for <code>etcd</code></summary><hr/><p>Support for mutual TLS has been added to secure all <code>etcd</code> communication.
A new <code>mtls</code> option is now available for the <code>etcd_authentication_mode</code> variable.
When <code>etcd_authentication_mode</code> is set to <code>mtls</code> (which requires <code>etcd_ssl_enabled: true</code>), the deployment automation will enforce certificate-based authentication
for:</p>
<ul>
<li>Peer-to-peer communication between all <code>etcd</code> nodes.</li>
<li>Client-server communication from clients like Patroni.</li>
</ul>
<p>TPA automatically configures both the <code>etcd</code>
servers and the Patroni clients with the necessary certificates and keys to ensure
a fully secure and validated connection.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Introduced new instance-level variables to control how servers and agents are displayed in PEM</summary><hr/><p>Introduced four new instance variables for use with the <code>pem-agent</code> role:</p>
<ul>
<li><code>monitoring_group</code> - <code>monitoring_agent_group</code> - <code>monitoring_cluster</code> - <code>monitoring_agent_cluster</code>
Also introduce the instance variable <code>pem_agent_group</code> for use with the <code>pem-server</code>
role alongside the existing variable <code>pem-server-group</code>. Collectively, these variables
determine which group and cluster the servers and agents are assigned to in PEM.
See the documentation for a full explanation.</li>
</ul>
</details></td><td></td></tr>
<tr><td><details><summary>Added support for validity period in OpenSSL generated certificates</summary><hr/><p>Previously, some SSL certificates (OpenVPN, PEM and TPA itself) used in TPA didn't come
with a way of specifying the number of days before expiration. This change adds
a variable called <code>openssl_certificate_validity</code> (default 3650 days), that can
be used to determine the number of days an SSL certificate will last before expiring.
In order to force TPA to reload a new certificate with a new expiration date,
you must pass the appropriate option to <code>tpaexec deploy</code> <code>-e pem_web_server_renew_tls_certificates=true&quot;</code>
or <code>-e tpa_tls_renew_tls_certificates=true&quot;)</code>.</p>
</details></td><td></td></tr>
</tbody></table>


## Changes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Changed the default EFM password encryption to scram-sha-256</summary><hr/><p>TPA now defaults to <code>efm_user_password_encryption: scram-sha-256</code> for
all new clusters configured with EFM as the failover manager. This change applies
when running <code>tpaexec configure</code> with <code>--enable-efm</code> or <code>--failover-manager efm</code>.
This addresses the deprecation of MD5 password encryption in PostgreSQL 18 and
provides improved security for all PostgreSQL versions. Existing clusters are
unaffected. Users can override this default by explicitly setting <code>efm_user_password_encryption: md5</code> in config.yml if needed, though MD5 support will be removed from TPA in a
future release.</p>
</details></td><td></td></tr>
<tr><td><details><summary>The <code>tpaexec configure</code> command now adds <code>efm_version</code> to config.yml.</summary><hr/><p>Support for explicitly adding the <code>efm_version</code> if introduced when executing
<code>tpaexec configure</code> and choosing EFM as the failover manager. This can be seen
when invoking <code>tpaexec</code> as follows: <code>tpaexec configure my-cluster-dir -a M1 --enable-efm --efm-version 5.2 (\u2026)</code>. Additionally, documentation covering
the <code>efm_version</code> selection has been added.</p>
</details></td><td></td></tr>
<tr><td><details><summary>TPA now runs <code>pgd-proxy</code> instead of <code>journalctl</code> for PGD Proxy version detection</summary><hr/><p>There are some edge cases where <code>journalctl</code> does not return the expected
version. Hence, TPA now runs <code>pgd-proxy</code> directly to get the version information
instead.</p>
</details></td><td>46753,46426</td></tr>
<tr><td><details><summary>Moved the pre-deploy hook outside repositories role.</summary><hr/><p>In previous versions, this hook was part of the repositories role.
When TPA introduced the possibility to exclude this role from deployments,
it created a situation whereby this hook could be unintentionally skipped.
To avoid this situation, we moved the hook
outside the role so it's always executed.</p>
</details></td><td>52412</td></tr>
<tr><td><details><summary>Added auto.basebackup property for EFM 5.2 and above.</summary><hr/><p>Starting with EFM 5.2, there will be a new property <code>auto.basebackup</code> that
adds on to the new auto-rebuild capability. Users can use the existing pg_rewind
feature, pg_basebackup, or tell EFM to use both (pg_basebackup will be run if
pg_rewind fails).</p>
</details></td><td></td></tr>
<tr><td><details><summary>Updated the internal dictionary of the AWS regions</summary><hr/><p>The change updates the internal dictionary of the AWS regions to expand
the coverage of the supported regions and corresponding AZs.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Documented <code>postgres_port</code> in TPA documentation</summary><hr/><p>Added detail of the parameter <code>postgres_port</code> in the TPA documentation.
<code>postgres_port</code> is the variable allowing the customization of the listening port
for Postgres. This variable ensures consistent use of the set value across
all components of the cluster relying on the information.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Disabled TRACK and TRACE methods on the PEM HTTPD server</summary><hr/><p>PEM 10.3 contains a fix for HTTPD configuration, moving the directive to rewrite TRACK/TRACE requests to the &lt;VirtualHost&gt; section for the
default virtual host on port defined by the &quot;pem_server_ssl_port&quot; variable.
This change applies the same fix to all new deployments of PEM, regardless of version.</p>
</details></td><td>54529</td></tr>
<tr><td><details><summary>Added <code>efm-post-config</code> hook.</summary><hr/><p>A new <code>efm-post-config</code> hook has been introduced to be able to execute
new tasks after the efm configuration has taken place. New documentation explaining
how to use it has also been developed under the 'TPA hooks' section.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Added support for pgaudit and postgis plugins on PG18.</summary><hr/><p>Adding PG18 support for those plugins. The version of those depends on
the Postgres version being supported as well. We have removed
versions 11 and 12 from the plugin lists as they are no longer
widely supported.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Start PGD proxy after the network is available</summary><hr/><p>This service needs the network service to be up and running before it can
be started. <code>Wants</code> and <code>After</code> directives have been added to the PGD Proxy service
unit to ensure that.</p>
</details></td><td>54251,52731</td></tr>
<tr><td><details><summary>Install libpq5 on PEM server v10+ for RHEL</summary><hr/><p>PEM 10.1 added <code>libpq5</code> as a dependency to fix <code>psycopg</code> errors related to <code>kerberos</code> authentication on RHEL 9 servers. To ensure <code>libpq5</code> is installed, TPA now explicitly installs it on RHEL servers when the PEM server version is 10 or greater.</p></details></td><td></td></tr>
<tr><td><details><summary>Install <code>libcurl-full</code> when required</summary><hr/><p><code>libcurl-minimal</code> is installed certain RHEL-esque images, and while it
satisfies the package dependencies for <code>edb-pem-agent</code>, it does NOT provide the
complete set of APIs required (namely for SMTP) If it is installed, we remove
it and install the <code>libcurl-full</code> meta-package to ensure full <code>libcurl</code> functionality
exists for the PEM agent. Because the <code>edb-pem</code> package depends on the <code>edb-pem-agent</code>
package, the <code>libcurl-minimal</code> package must also be removed on the PEM server
in order to avoid dependency resolution conflicts. This is done by installing
the package with the <code>allowerase</code> parameter.</p>
</details></td><td></td></tr>
</tbody></table>


## Bug Fixes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Patroni REST API SSL/TLS connections are now correctly configured and secure</summary><hr/><p>Previously, enabling SSL for the Patroni REST API (<code>patroni_ssl_enabled: true</code>) used a self-signed certificate. This resulted in <code>CERTIFICATE_VERIFY_FAILED</code>
errors for clients like <code>patronictl</code>, making the feature unusable in a secure
configuration. This has been fixed by implementing a proper certificate generation
process. The Patroni REST API server is now configured with a server certificate
signed by a Certificate Authority (CA) created by TPA for the TPA cluster. Additionally,
the <code>ctl</code> section of the <code>patroni.yml</code> configuration has been corrected to ensure
<code>patronictl</code> is properly configured to use the CA for server validation and to
present its own client certificate and key for authentication (mTLS). As a result,
enabling SSL for the Patroni REST API now provides a fully secure and verifiable
communication channel for all clients.'</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed race conditions during concurrent updates to the Barman .pgpass file</summary><hr/><p>Previously, when multiple backed-up nodes attempted to update the Barman
node's <code>.pgpass</code> file concurrently, a race condition could occur, resulting in partial
or incomplete entries. TPA now serializes this process, ensuring that the Barman
node's <code>.pgpass</code> file is updated sequentially to prevent loss.</p>
</details></td><td>52460</td></tr>
<tr><td><details><summary>Fix unwanted_packages to support 'common' key that applies to all distribution</summary><hr/><p>Previously, when setting <code>unwanted_packages</code> using the <code>common</code> key was not supported,
which differs from the behavior of other package dictionary that can be set in config.yml.
This fix introduces the support for the <code>common</code> key, ensuring
any package listed under this key will be removed if present on any distribution
in use in the cluster.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed task selection for pgdcli</summary><hr/><p>Fixed a bug whereby the <code>pgdcli</code> role would be run on <code>bdr</code> nodes even when task
selectors were used which should implicitly exclude it.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed a fatal error during Docker container provisioning</summary><hr/><p>When creating containers on modern versions of docker using user-defined
networks, <code>provision</code> would sometime crash with a 'dict object' has no attribute
'IPAddress' error. This was caused by an outdated method of discovering the container's
IP address. The logic has been updated to be compatible with modern Docker network
structures, making container creation more robust.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed <code>etcd</code> package installation on SLES</summary><hr/><p>Deployments on SLES-based distributions that require <code>etcd</code> (such as those
using Patroni) would previously fail because the <code>etcd</code> package could not be found
in the standard repositories. This has been resolved by enabling the PGDG <code>extras</code>
repository, which provides the necessary package and allows the installation to
succeed.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed an issue whereby <code>tpaexec test</code> did not remove data after testing in PGD clusters.</summary><hr/><p>After deploying a cluster and running <code>tpaexec test</code> on that cluster, creates
an additional entry in bdr.replication_set_table which is not later removed. The
fix makes the test run on a temporary schema called <code>tpatest</code>, which is later
removed after the test is finished.</p>
</details></td><td>53224</td></tr>
<tr><td><details><summary>Fixed issue with missing PGD CLI on proxy nodes when performing upgrade (3.7 to 5).</summary><hr/><p>When performing a regular deploy, or an upgrade from a 'BDR-Always-ON'
setup to 'PGD-Always-ON', the proxy nodes (previously deployed with the 'harp-proxy'
role), will not come shipped with the PGD CLI when trying to install it with the
'pgd-proxy' role, necessary to perform the upgrade. This fix ensures that the
PGD CLI will be installed on the proxy nodes and nodes with a 'bdr' role, also
on the nodes featuring only the 'pgdcli' role.</p>
</details></td><td></td></tr>
</tbody></table>


