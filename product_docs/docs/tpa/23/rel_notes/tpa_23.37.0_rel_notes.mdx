---
title: Trusted Postgres Architect 23.37.0 release notes
navTitle: Version 23.37.0
originalFilePath: product_docs/docs/tpa/23/rel_notes/src/tpa_23.37.0_rel_notes.yml
editTarget: originalFilePath
---

Released: 24 March 2025

New features, enhancements, bug fixes, and other changes in Trusted Postgres Architect 23.37.0 include the following:

## Highlights

- The `upgrade` command now supports minor-version upgrades of Postgres in Patroni and EFM clusters
- Upgrades in repmgr clusters have also been improved

## Enhancements

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Minor-version Postgres upgrades for M1 + Patroni clusters</summary><hr/><p>TPA can now upgrade Postgres to the latest minor version on an M1 cluster which uses Patroni as the failover manager. The upgrade process stops Barman on any Barman server in the cluster, then upgrades the replicas in the cluster. Then it switches to one replica as a temporary primary, upgrades Postgres on the original primary, and switches back to the original primary. Patroni's handling of the cluster is paused during the process and resumed afterwards. Then Barman is restarted and cluster health checks are run.</p>
</details></td><td>102662</td></tr>
<tr><td><details><summary>Improved minor-version Postgres upgrade for M1 + repmgr clusters</summary><hr/><p>Witness nodes were previously omitted from upgrade, they are now upgraded along with replicas. Postgres service restart is now more reliable and always run right after the package upgrade on the node is finished.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Minor-version Postgres upgrades for M1 + EFM clusters</summary><hr/><p>TPA can now upgrade Postgres to the latest minor version on an M1 cluster which uses EFM as the failover manager. The upgrade process stops Barman on any Barman server in the cluster, then upgrades the replicas in the clusters. Then it switches to one replica as a temporary primary, upgrades Postgres on the original primary, and switches back to the original primary. The EFM agent is started and stopped on the different servers at the correct times. Then Barman is restarted and cluster health checks are run.</p>
</details></td><td>103595</td></tr>
<tr><td><details><summary>Separated changed from unchanged tasks in output</summary><hr/><p>In TPA's default output plugin, tasks which return &quot;ok&quot; but with no changes are now separated from ones that have reported changes, which are now highlighted in yellow.</p></details></td><td></td></tr>
<tr><td><details><summary>Improved the speed of Docker instance deprovisioning</summary><hr/><p>When deprovisioning docker instances, TPA now kills the container instead of stopping it, and does so to all the instances in parallel.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Added <code>check.num.sync.period</code> property for EFM 5.x</summary><hr/><p>Starting with EFM 5.0, there is a new property <code>check.num.sync.period</code> that defines how often a primary agent will check to see if num_sync needs to change on the primary database. This can now be specified in <code>config.yml</code>.</p></details></td><td></td></tr>
</tbody></table>


## Changes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>TPA will now copy EFM config files if they are removed, even if no configuration changes</summary><hr/><p>If either the <code>efm.nodes</code> or <code>efm.properties</code> configuration files do not exist in the top-level EFM directory, the <code>efm upgrade-conf</code> command copies them from the <code>/raw</code> directory, even if there have been no configuration changes. This amends previous behavior that required a configuration change before the <code>upgrade-conf</code> command would run and copy files.</p>
</details></td><td></td></tr>
<tr><td><details><summary>TPA will now verify that the URI for EDB repository setup is accessible</summary><hr/><p>The EDB repos are set up using the setup script following the EDB Repos 2.0 documentation: piping the cURL output to bash for execution. However, if a user passes a nonexistent <code>EDB_SUBSCRIPTION_TOKEN</code> or repository to cURL, the exit code gets silently swallowed and replaced with a 0 because bash executes an empty input. In this version, a request is dispatched to a repository's GPG key endpoint to ensure a <code>404</code> response is not returned <em>before</em> continuing to download the setup script. Additionally, tasks related to EDB repository set up are now skipped if the repository has already been set up.'</p>
</details></td><td></td></tr>
<tr><td><details><summary>TPA will now raise an ArchitectureError when BDR-Always-ON is configured with BDR version 5</summary><hr/><p>An architecture error is now raised during <code>tpaexec configure</code> if <code>--bdr-version 5</code> is passed with <code>-a BDR-Always-ON</code> alerting the user that BDR version 5 should be used with <code>PGD-Always-ON</code>.</p>
</details></td><td></td></tr>
</tbody></table>


## Bug Fixes

<table class="table w-100"><thead><tr><th>Description</th><th width="10%">Addresses</th></tr></thead><tbody>
<tr><td><details><summary>Fixed <code>shared_preload_libraries</code> computation during deploy</summary><hr/><p>Fixed a limitation of Ansible's handling of list ordering that would trigger unneeded and uncontrolled rewriting of the <code>shared_preload_libraries</code> and subsequently require a Postgres service restart, even on second deployment scenarios with no changes to the configuration.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed an issue whereby unnecessary replication slots were created when configuring Patroni</summary><hr/><p>When setting up a Patroni cluster, a replication slot was created for each etcd-only node. This caused problems because the unused slots cause the WAL to accumulate. Slots are now only created for the DB servers.</p></details></td><td></td></tr>
<tr><td><details><summary>Fixed <code>patronictl switchover</code> command usage</summary><hr/><p>TPA will now correctly use <code>--leader</code> instead of the deprecated <code>--master</code> parameter when using <code>patronictl switchover</code> command.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed an issue with counting instances in BDR-Always-ON clusters containing PEM</summary><hr/><p>Fixed a bug whereby in certain circumstances, TPA would incorrectly calculate the number of instances in a BDR-Always-ON cluster with a PEM server, causing &quot;tpaexec configure&quot; to fail with &quot;StopIteration&quot;.</p>
</details></td><td></td></tr>
<tr><td><details><summary>Fixed an issue whereby a PEM server could be incorrectly picked as a cluster primary in EFM cluster.</summary><hr/><p>If a cluster is created with a pem-server, that backend is not monitored by EFM, hence, that node shouldn't be included when discovering a Postgres primary for the entire cluster. This behavior is now correctly implemented by TPA.</p>
</details></td><td>45279</td></tr>
<tr><td><details><summary>Fixed duplicated lines in .pgpass files</summary><hr/><p>Fixed a bug whereby extra lines could be added to .pgpass for the same user when re-running 'tpaexec deploy'.</p>
</details></td><td></td></tr>
</tbody></table>


