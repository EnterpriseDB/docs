---
title: "Performing an Incremental Backup"
---

<div id="performing_an_incremental_backup" class="registered_link"></div>


The WAL files produced at the time of the parent backup up to the start of the incremental backup contain information about which blocks were modified during that time interval. That information is consolidated into an MBM file for each WAL file by the WAL scanner.

The MBM files for the relevant WAL files are read, and the information is used to copy the modified blocks from the database cluster to the `archived_wals` directory as specified in the `archive_path` parameter in the `bart.cfg` file. When compared to a full backup, the number and sizes of relation files can be significantly less for an incremental backup.

For comparison, the following is an abbreviated list of the files copied to the archived `base` subdirectory of a full backup for one database:

    [root@localhost 14845]# pwd
    /opt/backup/acctg/1476301238969/base/base/14845
    [root@localhost 14845]# ls
    112        13182_vm   14740  16467  16615     2608_vm   2655  2699      2995      ...
    113        13184      14742  16471  174       2609      2656  2701      2995_vm   ...
    1247       13186      14745  16473  175       2609_fsm  2657  2702      2996      ...
    1247_fsm   13187      14747  16474  2187      2609_vm   2658  2703      2998      ...
    1247_vm    13187_fsm  14748  16476  2328      2610      2659  2704      2998_vm   ...
    1249       13187_vm   14749  16477  2328_fsm  2610_fsm  2660  2753      2999      ...
    1249_fsm   13189      14752  16479  2328_vm   2610_vm   2661  2753_fsm  2999_vm   ...
    1249_vm    13191      14754  16488  2336      2611      2662  2753_vm   3079      ...
    1255       13192      14755  16490  2336_vm   2611_vm   2663  2754      3079_fsm  ...
                                           .
                                           .
                                           .
    13182_fsm  14739      16465  16603  2608_fsm  2654      2696  2893_vm   3501_vm   ...

In contrast, the following is the content of the archived `base` subdirectory of the same database from a subsequent incremental backup:

    [root@localhost 14845]# pwd
    /opt/backup/acctg/1476301835391/base/base/14845
    [root@localhost 14845]# ls
    1247      1249      1259      16384  17006  2608      2610      2658  2663  2678  ...
    1247_fsm  1249_fsm  1259_fsm  16387  17009  2608_fsm  2610_fsm  2659  2673  2679  ...
    1247_vm   1249_vm   1259_vm   16389  17011  2608_vm   2610_vm   2662  2674  2703  ...

The information from the MBM files are consolidated into one file called a *consolidated block map* (CBM) file. During the restore operation for the incremental backup, the CBM file is used to identify the modified blocks to be restored for that backup.

In addition, the incremental backup also stores other required subdirectories and files from the database cluster as is done for full backups.

Before taking an incremental backup, an initial full backup must be taken with the `BACKUP` subcommand. This full backup establishes the parent of the first incremental backup.

The syntax for taking a full backup is:

    bart BACKUP –s { <server_name> | all } [ -F { p | t } ]
      [ -z ] [ –c <compression_level> ]
      [ --backup-name <backup_name> ]
      [ --thread-count <number_of_threads> ]
      [ { --with-pg_basebackup | --no-pg_basebackup } ]

<div class="note">

<div class="title">

Note

</div>

While a `BACKUP` subcommand is in progress, no other processes must run in parallel.

</div>

The syntax for taking an incremental backup is:

    bart BACKUP –s { <server_name> | all } [ -F p]
     [ --parent { <backup_id> | <backup_name> } ]
      [ --backup-name <backup_name> ]
      [ --thread-count <number_of_threads> ]
      [ --check ]

You must specify the following before taking an incremental backup:

-   `-Fp` option for plain text format as incremental backup can only be taken in the plain text format.
-   `--check` option to verify if the required MBM files are present in the `archived_wals` directory. The `--parent` option must be specified when the `--check` option is used.

See [BACKUP](../../04_using_bart/03_basic_bart_subcommand_usage/#backup) for more information about using the `BACKUP` subcommand.
