---
title: "Three by One Architecture"
navTitle: "Three by One"
---

<div id="three_by_one_overview" class="registered_link"></div>

---

The **Three By One** architecture consists of **three Postgres nodes** arranged in a **Physical Streaming Replication** relationship across **three Availability Zones** to achieve **High Availability**. The use of three Availability Zones enables full **Automated Failover** between all zones. Each of the Availability Zones also include a **Barman** backup service for full **Offsite Backup** purposes.

Each Availability Zone allows applications and user sessions to operate in full capacity in the event of an outage of either Zone. Depending on latency requirements, all Zones may exist within the same Region, or remote Regions for improved resilience. This design reflects a **medium-high RPO** due to intra-Zone latency, and a **medium RTO** since all Zones are automated.

This is an ideal architecture for lower cost production environments which require failover automation between multiple Availability Zones.

## Diagram

![](images/3x1.png)

## RADAR Chart

![](images/3x1-radar.png)

* **RPO** - Medium-High
  - Can survive Zone outage
  - Asynchronous by default
  - No local low latency Postgres replica nodes
* **RTO** - Medium-High
  - Automatic failover only between Zones
  - Physical streaming replication failover speeds
* **Latency** - Low-Medium
  - Asynchronous by default
  - May have application-facing cross-Zone or Region traffic
* **Cost** - Low-Medium
  - Lower node count
  - Three Availability Zones necessary
* **Resilience** - Medium
  - Can survive one node outage
  - Can survive a single Availability Zone outage
  - Multiple Availability Zone locations prevent mass outage
* **OLTP** - Low-Medium
  - Low node count for read distribution
  - Asynchronous commit times by default
* **OLAP** - Medium-High
  - Low amount of nodes to replicate
  - Slightly increased replication volume between multiple Zones

## Variants

### Postgres Distributed Variant

When using EDB Postgres Distributed, the Three by One architecture incorporates an optional **Proxy** resource into each Availability Zone. Accessing Postgres through the Proxy component substantially **improves RTO**, at a slightly increased cost due to licensing. All nodes in this variant are always writable, and the Proxy determines which should be the Lead write target in order to reduce the risk of write conflicts.

This particular design variant considers all PGD nodes as a single Write Group, so all Proxy nodes send traffic to a single Lead node. This architecture best fits applications with strong RTO requirements that are not particularly sensitive to write latency.

![](images/3x1-pgd.png)

### Synchronous Replication Variant

It is possible to moderately **improve RPO** for the Three by One design by using **Synchronous Replication**. While this also slightly increases write latency, it also mitigates the loss of committed transactions, especially in the event of a lost Availability Zone. This design also includes the minimum of two Synchronous Replicas, allowing one Replica to be offline at a time without interrupting write traffic on the Primary. Because the Synchronous Replicas are in separate Availability Zones, overall RPO is further enhanced.

![](images/3x1-sync.png)

### PgPool Variant

PgPool is commonly used to distribute read and write traffic to different targets. This variant of the Three by One design incorporates a PgPool node in each Availability Zone for slightly **improved Scalability**. Since all nodes reside in a separate Availability Zone, write latency is slightly increased for applications in separate Zones.

![](images/3x1-pool.png)

---

