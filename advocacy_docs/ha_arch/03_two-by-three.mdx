---
title: "Two by Three Architecture"
navTitle: "Two by Three"
---

<div id="two_by_three_overview" class="registered_link"></div>

---

The **Two by Three architecture** consists of **four Postgres nodes** arranged in a **Physical Streaming Replication** relationship across **two Availability Zones** to achieve **High Availability**. Each Zone is also equipped with a **Witness node** to enable **Automated Failover** within the Zone, and a **Barman** backup service for full **Offsite Backup** purposes.

Each Availability Zone allows applications and user sessions to operate in full capacity in the event of an outage of either Zone. Depending on latency requirements, this second Zone may exist within the same Region, or a remote Region for improved resilience. This design reflects a **medium RPO** since both Zones can survive node outages, and a **medium RTO** since both zones are automated.

This is a good architecture for high throughput production environments which require failover automation within each operational Zone, and more direct control over **Disaster Recovery** migrations.

## Diagram

![](images/2x3.png)

## RADAR Chart

![](images/2x3-radar.png)

* **RPO** - Medium
  - Loss of an Availability Zone will not result in total data loss
  - Asynchronous by default
* **RTO** - Medium
  - Automatic failover enabled within Zone
  - Physical streaming replication failover speeds
  - Second Zone must be manually activated in disaster scenario
* **Latency** - Low
  - Asynchronous by default
  - No application-facing cross-Zone or Region traffic
* **Cost** - Medium
  - Comparatively low node count
  - Two Availability Zones necessary
* **Resilience** - Medium
  - Can survive two node outages
  - Can survive a single Availability Zone outage
* **OLTP** - Medium
  - Medium node count for read distribution
  - Asynchronous commit times by default
* **OLAP** - Medium
  - Relatively few nodes to replicate
  - Low replication volume between two Zones

## Variants

### Postgres Distributed Variant

When using EDB Postgres Distributed, the Two by Three architecture adds an additional **Proxy** resource. Accessing Postgres through the Proxy component substantially **improves RTO**, at a slightly increased cost due to licensing. All nodes in this variant are always writable, and the Proxy determines which should be the principal write target in order to reduce the risk of write conflicts.

Each Availability Zone has its own Proxy and local Write Group so that each Zone may process write traffic simultaneously. This variant best fits applications with Location or Region-specific data, leading to naturally lower risk of write conflicts between each Zone.

![](images/2x3-pgd.png)

### Synchronous Replication Variant

It is possible to moderately **improve RPO** for the Two by Three design by using **Synchronous Replication**. While this also slightly increases write latency, it also mitigates the loss of committed transactions. This design also exceeds the minimum of two Synchronous Replicas, allowing one Replica to be offline at a time without interrupting write traffic on the Primary. Because the additional Synchronous Replicas are in another Availability Zone, overall RPO is further enhanced.

![](images/2x3-sync.png)

### PgPool Variant

PgPool is commonly used to distribute read and write traffic to different targets. This variant of the Two by Three design incorporates a PgPool node in each Availability Zone for slightly **improved Scalability**. Witness nodes may also be replaced with a Postgres Replica and added to the Read Pool to further increase read scalability. If applications are not particularly sensitive to latency, itâ€™s also possible to incorporate the remote Availability Zones into the Read Pool as well.

![](images/2x3-pool.png)

---

