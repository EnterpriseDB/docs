---
title: Installing Hybrid Manager on AWS EKS using the Hybrid Manager Operator
navTitle: Installing with Operator
description: Install the EDB Hybrid Manager on AWS EKS using the Hybrid Manager Operator.
---

You can install the Hybrid Manager on [Amazon EKS](https://aws.amazon.com/eks/) using the Hybrid Manager Operator. This is a Helm chart that deploys the Hybrid Manager platform on your EKS cluster. The operator is responsible for managing the lifecycle of the Hybrid Manager platform, including installing, upgrading, and uninstalling the platform.

!!! Important

    Complete the [prerequisites](prerequisites) before you start this part of the installation process. It will step through the process of creating an EKS cluster, installing the necessary components, and configuring the environment ready for the Hybrid Manager Operator.

## Set the version to install

The version of the EDB Hybrid Manager platform is set by the environment variable EDB_PLATFORM_VERSION. This should be set to the version of the platform you wish to install. For example, to install version v1.2.0, you would set the environment variable as follows:

```shell
export EDB_PLATFORM_VERSION="v1.2.0"
```

## Set your token

This installation process requires that you save your EDB subscription token as an environment variable. You can obtain it by going to your [EDB Account Profile](https://www.enterprisedb.com/accounts/profile). (Log in if prompted to.) There you will find an entry for Repos 2.0 token:

![Repo Token](../../images/repo-token.png)

Take this value and set it as an environment variable:

```shell
export EDB_SUBSCRIPTION_TOKEN="your-token"
```

## Obtain the bootstrap kit

HCP is installed using a bootstrap kit. This kit is a collection of scripts and charts that are used to install the EDB Hybrid Manager platform.

- [eks-install-operator.sh](assets-op/eks-install-operator.sh) - This script installs the Hybrid Manager Operator on your EKS cluster.
- [eks-install-secrets.sh](assets-op/eks-install-secrets.sh) - This script installs the secrets required for the installation process.
- [prepare.sh](assets-op/prepare-op.sh) - This script prepares the values file for the installation process.
- [hm-default-env.sh](assets-op/hm-default-env.sh) - This file contains the default environment variables for the installation process.
- [hm-default.yaml](assets-op/hm-default.yaml) - This file contains the default values for a configuration.

Copy all files to a directory on your local machine and `cd` into that directory.

### Install the Hybrid Manager Operator

To install the Hybrid Manager Operator, run the `eks-install-operator.sh` script. 
(As you already set the token as an environment variable, you can pipe it into the script). 
You will also need to set the environment variable `OPERATOR_VERSION` to the version of the operator you wish to install, for example `v1.2.0`.
This will typically be the same version as the EDB Hybrid Manager platform you are installing, so you can set it as follows:

```shell
export OPERATOR_VERSION=$EDB_PLATFORM_VERSION
```

Then you can run the script to install the operator:

```shell
echo $EDB_SUBSCRIPTION_TOKEN | $SHELL eks-install-operator.sh
```

## Install secrets

The install process requires a number of secrets to be installed in the Kubernetes cluster. These secrets are used to authenticate with the EDB Download Repository and to store the credentials for the EDB Software Deployment platform.

to install the secrets required for the bootstrap process, run the `install-secrets.sh` script. (As you already set the token as an environment variable, you can pipe it into the script.)

```shell
echo $EDB_SUBSCRIPTION_TOKEN | $SHELL eks-install-secrets.sh
```

```console
Enter the password for pgai-platform@docker.enterprisedb.com
namespace/edbpgai-bootstrap created
namespace/upm-replicator created
secret/edb-cred created
secret/edb-cred created
secret/edb-cred annotated
namespace/upm-griptape created
secret/fernet-secret created
namespace/upm-lakekeeper created
secret/pg-confounding-key created
```

## Prepare the values file

The bootstrap process requires a number of values to be set in the Helm chart. These values are stored in a file called `values.yaml`. You can create this file by running the `prepare.sh` script, which uses variables from the `default-env.sh` file. Edit the `default-env.sh` file to set the values you require.

This is the default `default-env.sh` file:

```shell
# exports for EKS
export EDB_PLATFORM_VERSION="v1.2.0"
export EDB_TARGET_PLATFORM="eks"
export CONTAINER_REGISTRY_URI="docker.enterprisedb.com/staging_pgai-platform"
export IMAGESET_REGISTRY_URI=$CONTAINER_REGISTRY_URI
export IMAGESET_AUTHTYPE="token"
export PORTAL_DOMAIN_NAME="portal.foo.network"
export TRANSPORTER_RW_SERVICE_DOMAIN_NAME="transporter.foo.network"
export BEACON_SERVICE_DOMAIN_NAME="beacon.foo.network"
export AUTHENTICATION_EMAIL="owner@mycompany.com"
export AUTHENTICATION_USER="owner@mycompany.com"
export LOCATION_NAME="default-location"
export STORAGE_CLASS="gp2"
export TRANSPORTER_FIPS_ENABLED=false

# Set a password hash for the user or pass a password to have it hashed for you.
# If you pass a password, you will need to remove it from your history.
# You can hash a password using the following command:
# echo -n "password" | htpasswd -BinC 10 admin | cut -d: -f2
#

# export AUTHENTICATION_PASSWORD="password"
# If setting AUTHENTICATION_PASSWORD_HASH, ensure it is single quoted to prevent variable expansion (e.g. $2y$10$...).
export AUTHENTICATION_PASSWORD_HASH='$2y$10$vKOAXfLHbeV1OQxMpxlLdOIwnX.JAN.ZrD9ZU//ocrNQwhQIMtXhy'
```

Here is a brief guide to the variables in the `default-env.sh` file.

| Variable                           | Description                                                                                                                                |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| EDB_TARGET_PLATFORM                | The target platform for the installation. Set to eks as we are installing on Amazon EKS.                                                   |
| CONTAINER_REGISTRY_URI             | The URI of the container registry to use. This is set to the EDB Download Repository.                                                      |
| IMAGESET_REGISTRY_URI              | The URI of the image set registry. This is set to the EDB Download Repository.                                                             |
| IMAGESET_AUTHTYPE                  | The authentication type for the image set registry. Set to token as we are using a token to authenticate with the EDB Download Repository. |
| TRANSPORTER_RW_SERVICE_DOMAIN_NAME | The domain name for the Transporter service.                                                                                               |
| PORTAL_DOMAIN_NAME                 | The domain name for the portal.                                                                                                            |
| BEACON_SERVICE_DOMAIN_NAME         | The domain name for the beacon service.                                                                                                    |
| AUTHENTICATION_EMAIL               | The email address of the user to create.                                                                                                   |
| AUTHENTICATION_USER                | The username of the user to create.                                                                                                        |
| AUTHENTICATION_PASSWORD            | The password of the user to create. This can be set as plain text or as a hash with AUTHENTICATION_PASSWORD_HASH.                          |
| AUTHENTICATION_PASSWORD_HASH       | The hash of the password to create.                                                                                                        |
| LOCATION_NAME                      | The location name for the beacon agent.                                                                                                    |
| STORAGE_CLASS                      | The storage class to use for the installation. This is set to gp2 for EBS volumes on AWS.                                                  |
| TRANSPORTER_FIPS_ENABLED          | Whether to enable FIPS mode for the Transporter service.                                                                                   |


<TabContainer>
<Tab title="Automatically">

Run the `prepare.sh` script to create the `values.yaml` file.

```shell
$SHELL prepare.sh
```

This create a `values.yaml` file with the values set in the `default-env.sh` file.

</Tab>

<Tab title="Manually">

You must start with the `hcp-
You need to create two values for the bootstrap process. These are the AES_256_KEY and the AUTHENTICATION_PASSWORD_HASH. You can create these values with the following commands:

```shell
export AES_256_KEY=$(openssl rand -base64 32)
```

If you have a password to hash, you can do so with the following command:

```shell
export AUTHENTICATION_PASSWORD_HASH=$(echo -n $AUTHENTICATION_PASSWORD | htpasswd -BinC 10 admin | cut -d: -f2)
```

You now need to edit `values.yaml` file and set the values required for your installation. Find the appropriate key in the `values.yaml` file and set the values as follows. Replace `$<name>` entries with the value you have set the environment variables of the same name to.

1.  Sets `bootstrapImageName` to $CONTAINER_REGISTRY_URI followed by "/edbpgai-bootstrap/bootstrap-" and then $EDB_TARGET_PLATFORM. eg, given the values above, this would be `docker.enterprisedb.com/staging_pgai-platform/edbpgai-bootstrap/bootstrap-eks`.
2.  Set `bootstrapImageTag` to $EDB_PLATFORM_VERSION.
3.  Set `parameters.upm-istio.cookie_aeskey` to $AES_256_KEY.
4.  Set `containerRegistryURL` to $CONTAINER_REGISTRY_URI.
5.  Set `system` to $EDB_TARGET_PLATFORM.
6.  Set `parameters.global.portal_domain_name` to $PORTAL_DOMAIN_NAME.
7.  Set `parameters.transporter-rw-service.domain_name` to $TRANSPORTER_RW_SERVICE_DOMAIN_NAME.
8.  Set `parameters.transporter-dp-agent.rw_service_url` to `https://` followed by $TRANSPORTER_RW_SERVICE_DOMAIN_NAME followed by `/transporter`. eg, given the values above, this would be `https://transporter.foo.network/transporter`.
9.  Set `parameters.upm-beacon.server_host` to $BEACON_SERVICE_DOMAIN_NAME.
10. Set `pgai.portal.authentication.staticPasswords[0].email` to $AUTHENTICATION_EMAIL.
11. Set `pgai.portal.authentication.staticPasswords[0].hash` to $AUTHENTICATION_PASSWORD_HASH.
12. Set `pgai.portal.authentication.staticPasswords[0].username` to $AUTHENTICATION_USER.
13. Set `pgai.portal.authentication.staticPasswords[0].userID` "c5998173-a605-449a-a9a5-4a9c33e26df".
14. Set `beaconAgent.location` to $LOCATION_NAME

</Tab>
</TabContainer>

## Apply the Helm chart

With the `values.yaml` file prepared, you can apply the Helm chart to start the bootstrap process. This create the necessary resources in the Kubernetes cluster to start the bootstrap process.

```shell
helm upgrade -n edbpgai-bootstrap \
   --install -f ./values.yaml \
   --version "${EDB_PLATFORM_VERSION/-appl/+appl}" \
   edbpgai-bootstrap edbpgai/edbpgai-bootstrap
```

This command installs the bootstrap container in the Kubernetes cluster. The bootstrap container then installs the rest of the EDB Software Deployment platform.

## Follow the bootstrap process

The bootstrap process takes time to complete. You can follow the progress by looking at the logs of the bootstrap container:

```shell
kubectl logs -f -l app=edbpgai-bootstrap -n edbpgai-bootstrap
```

## Configure the IP address in /etc/hosts

Obtain the IP address of your ingress gateway to configure in your `/etc/hosts` file. Run:

```shell
kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.status.loadBalancer.ingress[0].hostname}' | strings | nslookup
```

This command returns output like:

```console
Server:         192.168.111.1
Address:        192.168.111.1#53

Non-authoritative answer:
Name:   k8s-istiosys-istioing-b3dc9b4f3c-81dc5c45b1d5f6d2.elb.us-east-1.amazonaws.com
Address: 52.70.180.102
```

You can then add the IP address to your `/etc/hosts` file:

```shell
echo "52.70.180.102 portal.foo.network" | sudo tee -a /etc/hosts
```

Substitute the IP address with the value you obtained earlier.

## Next steps

You can now verify the installation by [connecting to the HCP portal](portalconnection.mdx).
