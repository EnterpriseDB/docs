---
title: PGAIHM tiered tables
navTitle: Tiered tables

---

## Overview

Tiered tables in PGAIHM are used for archiving cold data. Tiered tables leverage the EDB Postgres Distributed (PGD) autopartition feature to manage the movement of data between transactional (hot) storage and analytical (cold) storage. The goal is to provide flexibility in managing data aging, allowing both automated and manual control over the offloading process.

## Topologies

Tiered tables operate in a PGD environment. The underlying topology involves:

-   **Partitioned tables:** Data is stored in partitioned tables, which are a collection of regular PostgreSQL tables.
-   **Transactional and analytical storage:** Some partitions reside in transactional storage (heap), while others are offloaded to analytical storage (PGA).
-   **Object storage:** Object storage is used to store offloaded data.

## Use cases

You can use tiered tables for the following use cases:

-   **Data archiving:** Move cold data to less expensive storage to optimize performance and cost.
-   **Time-based data management:** Roll off older data based on timeframes (for example, monthly, yearly).
-   **Compliance:** Retain data for long-term storage while keeping transactional tables small.
-   **Query optimization:** Improve the performance of analytical queries by using data in analytical storage.

## Requirements

The following requirements apply to tiered tables:

-   Tiered tables rely on PGD's autopartition feature.
-   Object storage is necessary for storing offloaded data.

## Recommendations

The following recommendations apply when using tiered tables:

-   Optimize queries to avoid performance bottlenecks when querying across transactional and analytical tables.
-   Carefully plan the offloading strategy based on query patterns and data access frequency.
-   Use automatic offloading for routine tasks and manual control for specific use cases.
-   Coordinate the lifecycle of the object storage with the PGD database lifecycle.
-   Evaluate using external systems to query offloaded data directly.
-   Be aware of potential data conflicts during restore operations and plan accordingly.
-   Implement processes to identify and manage orphaned tables in object storage.  Restoring to a point in time can lead to orphaned tables in object storage. Point-in-time recovery restores the metadata, but inconsistencies between the object store and the restored database can occur.

## Using

-   **Automatic offloading:** Configure the `offload_period` parameter to enable automatic offloading of partitions.
-   **Manual offloading:** Use commands to manually offload tables to analytical storage.
-   **Table inspection:** Use `\\d+` in psql to view table details and identify the partitions in heap or PGA storage.
-   **Data retrieval:** Query analytical data directly using another system, as it's stored in Iceberg tables.
-   **Data Modification:** To update offloaded data, restore the partition, perform the updates, and offload it again.

## Glossary

-   **Tiered tables:** A feature for managing data aging and offloading cold data.
-   **PGD:** EDB Postgres Distributed.
-   **Autopartition:** A PGD feature that automatically manages table partitions.
-   **Heap:** Storage for transactional data.
-   **PGA:** Storage for analytical (cold) data.
-   **Iceberg tables:** The format in which offloaded data is stored.
-   **Offload period:** A parameter that defines how often data is automatically offloaded.
