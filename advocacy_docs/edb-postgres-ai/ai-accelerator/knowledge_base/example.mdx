---
title: Knowledge Bases end-to-end example usage
navTitle: Example usage
description: Example of using knowledge bases in AI Accelerator.
---

This is a full end-to-end example of using knowledge bases in EDB Postgres AI - AI Accelerator.

```sql
-- Create extension
DROP EXTENSION aidb CASCADE;
CREATE EXTENSION aidb CASCADE;

drop table if exists test_source_table_ajz72eb cascade;
drop table if exists test_knowledge_base_ajz72eb_vector cascade;

-- Create source test table
CREATE TABLE test_source_table_ajz72eb
(
    id               INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    content          TEXT NOT NULL,
    unrelated_column TEXT
);
INSERT INTO test_source_table_ajz72eb
VALUES (43941, 'Catwalk Women Brown Heels'),
       (55018, 'Lakme 3 in 1 Orchid  Aqua Shine Lip Color'),
       (19337, 'United Colors of Benetton Men Stripes Black Jacket');


-- Create model
SELECT aidb.create_model('simple_model_ajz72eb', 'bert_local');

SELECT aidb.create_table_knowledge_base(
    name => 'test_knowledge_base_ajz72eb',
    model_name => 'simple_model_ajz72eb',
    source_table => 'test_source_table_ajz72eb',
    source_data_column => 'content',
    source_data_type => 'Text'
);


-- expect "Table"
SELECT aidb.get_knowledge_base_data_source('test_knowledge_base_ajz72eb');

SELECT * FROM aidb.knowledge_bases;

SELECT aidb.bulk_embedding('test_knowledge_base_ajz72eb');


-- Perform retrieval similarity search for the closest `key`
SELECT * FROM aidb.retrieve_key('test_knowledge_base_ajz72eb', 'orchid');
SELECT * FROM aidb.retrieve_key('test_knowledge_base_ajz72eb', 'orchid', 2);  -- Limit to top 2 results

SELECT * FROM aidb.retrieve_text('test_knowledge_base_ajz72eb', 'orchid');
SELECT * FROM aidb.retrieve_text('test_knowledge_base_ajz72eb', 'orchid', 2);  -- Limit to top 2 results


-- enable the auto embedding
SELECT aidb.set_auto_knowledge_base('test_knowledge_base_ajz72eb', 'Live');


-- add additional data to test auto-embedding
INSERT INTO test_source_table_ajz72eb
VALUES (11211, 'Bicycle'),
       (11311, 'What is this?'),
       (11411, 'Elephants');


-- check embeddings
SELECT id FROM test_knowledge_base_ajz72eb_vector;

-- delete one of the source rows
DELETE FROM test_source_table_ajz72eb WHERE id = 11211;

-- check embeddings
SELECT id FROM test_knowledge_base_ajz72eb_vector;

-- enable the auto embedding
SELECT aidb.set_auto_knowledge_base('test_knowledge_base_ajz72eb', 'Live');
INSERT INTO test_source_table_ajz72eb VALUES (212121, 'new value');

select aidb.delete_knowledge_base('test_knowledge_base_ajz72eb');
```

