---
title: Configuring and running the Agent for usage reporting in Internet-connected environments
navTitle: Configure and run the Agent

---

Configure the agent (deployed as `beacon-agent`) to allow it to connect to and fetch basic usage data from the source database and send it to EDB.

## Preparation

1.  Change to the [OS user you previously created](sa_agent_os_user) to perform the agent configuration.

1.  Set the following environment variable. This environment variable must be permanently available as it is required each time the agent starts.

    Set `$DSN` to the Data Source Name (DSN) to of a database of the server that you want to report usage about.

    For example, to connect as user `postgres` authenticated with password `password` to a database `postgres` on port 5432 you would specify:

    ```
    postgresql://postgres:password@localhost:5432/postgres
    ```

## Create a configuration file and run the agent

1.  Create a configuration directory for the agent in your home directory:

    ```shell
    mkdir ${HOME}/.beacon
    ```

    !!!Note
    If the location specified above is not convenient, you also use either:

    - `/etc/beacon`
    - The directory from which you execute any `beacon-agent` command. 
    
    The agent looks for its configuration file starting with `/etc/beacon`, then `${HOME}/.beacon`. As a final fallback, it searches the directory from which it's executed.
    !!!

1.  Inside this directory, create a new file `beacon_agent.yaml`

    ```shell
    touch .beacon/beacon_agent.yaml
    ```

1.  Copy and paste the following template into the new file. This template is designed to enable usage reporting.

    ```yaml
    ---
    agent:
    general:
      usage:
        company_code: <company-code>
        output:
          file:
            enabled: true
            path: beacon_usage.json
          http:
            enabled: true
    provider:
      onprem:
        runner:
          enabled: true
        databases:
          - resource_id: <resource_id>
            dsn: $DSN
    ---
    ```

    The placeholders denoted by `<>` should be replaced with appropriate values.
    Refer to [Parameter reference](/edb-postgres-ai/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/configure_agent/#parameter-reference) for explanations of each parameter and how to obtain the appropriate value.

1.  The agent is now configured, proceed to [running the agent](/edb-postgres-ai/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/run_agent/). 

1.  Review the `beacon_usage.json` to ensure that the information is accurate and does not contain any data you are not happy to share with EDB.

1.  Enable reporting to EDB by setting `general.metrics.usage.output.http.enabled` to `true` and rerunning the agent. 

## Next step

[Configure the agent to run as a service](/edb-postgres-ai/hybrid-manager/using_hybrid_manager/monitoring/mon_ext_dbs/mon_with_agent/run_as_service/) â–º Reports are generated every 12 hours while the Agent is running. 
