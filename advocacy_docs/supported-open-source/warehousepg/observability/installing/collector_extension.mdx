---
title: Installing the Extension and Collector
navTitle: Install the Extension and Collector
description: Install the Extension and Collector.
---

Install the WHPG Extension and WHPG Collector on your WHPG cluster coordinator.

## Download and install the Extension and Collector

1. Download the packages from the EDB repository:

    ```bash
    export EDB_SUBSCRIPTION_TOKEN=<your-token>
    export EDB_REPO=gpsupp
    curl -1sSLf "https://downloads.enterprisedb.com/$EDB_SUBSCRIPTION_TOKEN/$EDB_REPO/setup.rpm.sh" | sudo -E bash
    sudo dnf download edb-whpg-observability-extension
    sudo dnf download edb-whpg-observability-collector
    ```

1. Create a file `all_hosts` on your WHPG coordinator, which lists all hosts in the WHPG cluster. For example:

    ```ini
    cdw
    scdw
    sdw1
    sdw2
    sdw3
    ```

1. Use the gpssh utility to install the packages from the coordinator:

    <TabContainer syncKey="extension_collector">
    <Tab title="RHEL 8, 9">

    ```bash 
    gpssh -f all_hosts -e 'sudo dnf install -y whpg-observability-extension'
    gpssh -f all_hosts -e 'sudo dnf install -y whpg-observability-collector'
    ```

    </Tab>
    <Tab title="RHEL 7">

    ```bash 
    gpssh -f all_hosts -e 'sudo yum install -y whpg-observability-extension'
    gpssh -f all_hosts -e 'sudo yum install -y whpg-observability-collector'
    ```

    </Tab>
    </TabContainer>

## Create the WHPG Extension 

Connect to a database on your WHPG cluster. We recommend that you create a separate database for WHPG Observability. You must install the Extension in every database that you require metrics for.

```SQL
CREATE EXTENSION whpg_observability;
```

You should now see the `observability` schema created in the database.

## Configure the WHPG Collector 

Edit the file `/var/lib/whpg-observability-collector/observability.conf` on the coordinator host and save your changes.

```
[settings] # Do not change this
# Please update below details before running /var/lib/whpg-observability-collector/deploy-observability
# Connection url for the WHPG cluster to fetch segment hostnames, data dirs.
#WHPG_OBS_DSN="host=localhost port=5432 dbname=postgres user=gpadmin password=postgres sslmode=disable"

# The HTTP API endpoint for sending logs to Loki (Log Aggregation).
#LOKI_ENDPOINT="http://host.docker.internal:3100/loki/api/v1/push"

# The HTTP API endpoint for sending custom metrics via Remote Write to Prometheus.
#PROMETHEUS_ENDPOINT="http://host.docker.internal:9090/api/v1/write"
``` 

Ensure that you configure the following parameters:
- `WHPG_OBS_DSN`: Your WHPG cluster connection details. The database must be a database with the WHPG Extension installed, and the user must hold the superuser role.
- `LOKI_ENDPOINT`: Your configured host name and port number for the Loki endpoint for log files.
- `PROMETHEUS_ENDPOINT`: Your configured host name port number for the Prometheus endpoint for host-level metrics.


## Start the Collector service

Run the following command to deploy the configuration and start the service on all WHPG cluster nodes:

 ```bash
 /var/lib/whpg-observability-collector/deploy-observability 
 ```

 The WHPG Collector now runs in the background as the `alloy` service. You can manage this service using systemctl commands. For example:

Check status:

```bash
sudo systemctl status alloy
```

Enable on boot:

```bash
sudo systemctl enable alloy
```
