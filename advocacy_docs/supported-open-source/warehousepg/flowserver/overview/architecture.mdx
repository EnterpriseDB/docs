---
title: FlowServer for WarehousePG architecture
navTitle: Architecture
description: Understand the architechure of FlowServer for WarehousePG and its main components
---

Introduce the architechure.

![architechure](../images/architecture.png)

## Flowserver

FlowServer: main utility which starts an instance used for handling the request from the FlowCLI and manages the job to fetch data from Kafka/RabbitMQ and load it into WHPG with transformations.
FlowServer is a streaming data processing server that supports various data sources. It can be configured to read from sources like Kafka or RabbitMQ and write to a WareHousePG database. 
The server supports different data formats such as JSON, Avro, and CSV, and allows for flexible task management and scheduling options.
The server can be started with a configuration file that specifies the server settings, data sources, and target database configurations.
Prometheus: Configuration options for the Prometheus metrics endpoint.

The FlowServer service instance submits each load request transaction to the WHPG cluster coordinator instance. FlowServer uses the gpfdist protocol to store data in external tables that it creates or reuses.

The flow server can run on any host which could connect to whpg cluster, for example a standalone ETL server or the standby coordinator host.

## FlowCLI

A command tool. It provides many subcommands to submit and control the flow server jobs.
The flowcli is a command line interface for managing the WareHousePG streaming server jobs. It allows users to submit, start, stop, and monitor jobs.
The subcommands of flowcli is similar with gpsscli subcommands, but we optimize some of them.

The flow cli can run any host which could connect to the server

## Formatter extension

Formatter extension: database extension that runs on each segment. It formats the raw data into the the specific column type of target table.

## How FlowServer works

Flowserver workflow is a multi-stage transformation on loading data, includes filtering raw data, expression in config file, UDF, etc

**Prepare**

Prepare SQL, filter data.

**Formatter**

Avro, json, csv. 

Converts to external table.

**Transform**

Expression  UDF Mapping.

Write into target table.