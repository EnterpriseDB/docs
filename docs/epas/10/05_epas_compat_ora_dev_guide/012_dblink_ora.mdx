---
title: dblink_ora
---


dblink\_ora provides an OCI-based database link that allows you to SELECT, INSERT, UPDATE or DELETE data stored on an Oracle system from within Advanced Server.

***Connecting to an Oracle Database***

To enable Oracle connectivity, download Oracle's freely available OCI drivers from their website, presently at:

<http://www.oracle.com/technetwork/database/features/instant-client/index-100365.html>

For Linux, if the Oracle instant client that you've downloaded does not include the libclntsh.so library, you must create a symbolic link named libclntsh.so that points to the downloaded version. Navigate to the instant client directory and execute the following command:

> ln -s libclntsh.so.*version* libclntsh.so

Where *version* is the version number of the libclntsh.so library. For example:

> ln -s libclntsh.so.12.1 libclntsh.so

Before creating a link to an Oracle server, you must tell Advanced Server where to find the OCI driver.

Set the LD\_LIBRARY\_PATH environment variable on Linux (or PATH on Windows) to the lib directory of the Oracle client installation directory.

For Windows only, you can instead set the value of the oracle\_home configuration parameter in the postgresql.conf file. The value specified in the oracle\_home configuration parameter will override the Windows PATH environment variable.

The LD\_LIBRARY\_PATH environment variable on Linux (PATH environment variable or oracle\_home configuration parameter on Windows) must be set properly each time you start Advanced Server.

When using a Linux service script to start Advanced Server, be sure LD\_LIBRARY\_PATH has been set within the service script so it is in effect when the script invokes the pg\_ctl utility to start Advanced Server.

**For Windows only:** To set the oracle\_home configuration parameter in the postgresql.conf file, edit the file, adding the following line:

> oracle\_home = '*lib\_directory* '

Substitute the name of the Windows directory that contains oci.dll for *lib\_directory*.

After setting the oracle\_home configuration parameter, you must restart the server for the changes to take effect. Restart the server from the Windows Services console.

## dblink\_ora Functions and Procedures

dblink\_ora supports the following functions and procedures.

### dblink\_ora\_connect()

The dblink\_ora\_connect() function establishes a connection to an Oracle database with user-specified connection information. The function comes in two forms; the signature of the first form is:

> dblink\_ora\_connect(*conn\_name*, *server\_name*, *service\_name*, *user\_name*, *password*, *port*, *asDBA*)

**Where:**

> *conn\_name* specifies the name of the link.
>
> *server\_name* specifies the name of the host.
>
> *service\_name* specifies the name of the service.
>
> *user\_name* specifies the name used to connect to the server.
>
> *password* specifies the password associated with the user name.
>
> *port* specifies the port number.
>
> *asDBA* is True if you wish to request SYSDBA privileges on the Oracle server. This parameter is optional; if omitted, the default value is FALSE.

The first form of dblink\_ora\_connect() returns a TEXT value.

The signature of the second form of the dblink\_ora\_connect() function is:

> dblink\_ora\_connect(*foreign\_server*\_*name*, *asDBA*)

**Where:**

> *foreign\_server\_name* specifies the name of a foreign server.
>
> *asDBA* is True if you wish to request SYSDBA privileges on the Oracle server. This parameter is optional; if omitted, the default value is FALSE.

The second form of the dblink\_ora\_connect() function allows you to use the connection properties of a pre-defined foreign server when establishing a connection to the server.

Before invoking the second form of the dblink\_ora\_connect() function, use the CREATE SERVER command to store the connection properties for the link to a system table. When you call the dblink\_ora\_connect() function, substitute the server name specified in the CREATE SERVER command for the name of the link.

The second form of dblink\_ora\_connect() returns a TEXT value.

### dblink\_ora\_status()

The dblink\_ora\_status() function returns the database connection status. The signature is:

> dblink\_ora\_status(*conn\_name*)

**Where:**

> *conn\_name* specifies the name of the link.

If the specified connection is active, the function returns a TEXT value of OK.

### dblink\_ora\_disconnect()

The dblink\_ora\_disconnect() function closes a database connection. The signature is:

> dblink\_ora\_disconnect(*conn\_name*)

**Where:**

> *conn\_name* specifies the name of the link.

The function returns a TEXT value.

### dblink\_ora\_record()

The dblink\_ora\_record() function retrieves information from a database. The signature is:

> dblink\_ora\_record(*conn\_name*, *query\_text*)

**Where:**

> *conn\_name* specifies the name of the link.
>
> *query\_text* specifies the text of the SQL SELECT statement that will be invoked on the Oracle server.

The function returns a SETOF record.

### dblink\_ora\_call()

The dblink\_ora\_call() function executes a non-SELECT statement on an Oracle database and returns a result set. The signature is:

> dblink\_ora\_call(*conn\_name*, *command*, *iterations*)

**Where:**

> *conn\_name* specifies the name of the link.
>
> *command* specifies the text of the SQL statement that will be invoked on the Oracle server.
>
> *iterations* specifies the number of times the statement is executed.

The function returns a SETOF record.

### dblink\_ora\_exec()

The dblink\_ora\_exec() procedure executes a DML or DDL statement in the remote database. The signature is:

> dblink\_ora\_exec(conn\_name, command)

**Where:**

> *conn\_name* specifies the name of the link.
>
> *command* specifies the text of the INSERT, UPDATE, or DELETE SQL statement that will be invoked on the Oracle server.

The function returns a VOID.

### dblink\_ora\_copy()

The dblink\_ora\_copy() function copies an Oracle table to an EnterpriseDB table. The dblink\_ora\_copy() function returns a BIGINT value that represents the number of rows copied. The signature is:

> dblink\_ora\_copy(*conn\_name*, *command*, *schema\_name*, *table\_name*, *truncate*, *count*)

**Where:**

> *conn\_name* specifies the name of the link.
>
> *command* specifies the text of the SQL SELECT statement that will be invoked on the Oracle server.
>
> *schema\_name* specifies the name of the target schema.
>
> *table\_name* specifies the name of the target table.
>
> *truncate* specifies if the server should TRUNCATE the table prior to copying; specify TRUE to indicate that the server should TRUNCATE the table. *truncate* is optional; if omitted, the value is FALSE.
>
> *count* instructs the server to report status information every *n* record, where *n* is the number specified. During the execution of the function, Advanced Server raises a notice of severity INFO with each iteration of the count. For example, if FeedbackCount is 10, dblink\_ora\_copy() raises a notice every 10 records. *count* is optional; if omitted, the value is 0.

## Calling dblink\_ora Functions

The following command establishes a connection using the dblink\_ora\_connect() function:

> SELECT dblink\_ora\_connect('acctg', 'localhost', 'xe', 'hr', 'pwd', 1521);

The example connects to a service named xe running on port 1521 (on the localhost) with a user name of hr and a password of pwd. You can use the connection name acctg to refer to this connection when calling other dblink\_ora functions.

The following command uses the dblink\_ora\_copy() function over a connection named edb\_conn to copy the empid and deptno columns from a table (on an Oracle server) named ora\_acctg to a table located in the public schema on an instance of Advanced Server named as\_acctg. The TRUNCATE option is enforced, and a feedback count of 3 is specified:

> edb=\# SELECT dblink\_ora\_copy('edb\_conn','select empid, deptno FROM ora\_acctg', 'public', 'as\_acctg', true, 3);
>
> INFO: Row: 0
> INFO: Row: 3
> INFO: Row: 6
> INFO: Row: 9
> INFO: Row: 12
>
> dblink\_ora\_copy
> \-----------------
> 12
>
> (1 row)

The following SELECT statement uses dblink\_ora\_record() function and the acctg connection to retrieve information from the Oracle server:

> SELECT \* FROM dblink\_ora\_record( 'acctg', 'SELECT first\_name from employees') AS t1(id VARCHAR);

The command retrieves a list that includes all of the entries in the first\_name column of the employees table.