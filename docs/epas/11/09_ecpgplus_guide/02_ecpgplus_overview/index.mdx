---

title: "ECPGPlus - Overview"
---

<div id="ecpgplus_overview" class="registered_link"></div>

EnterpriseDB has enhanced ECPG (the PostgreSQL pre-compiler) to create ECPGPlus. ECPGPlus is a Pro*C-compatible version of the PostgreSQL C pre-compiler. ECPGPlus translates a program that combines C code and embedded SQL statements into an equivalent C program. As it performs the translation, ECPGPlus verifies that the syntax of each SQL construct is correct.

The following diagram charts the path of a program containing embedded SQL statements as it is compiled into an executable:

![](images/ecpgplus_embedded_sql_statements.png)

To produce an executable from a C program that contains embedded SQL statements, pass the program (`my_program.pgc` in the diagram above) to the ECPGPlus pre-compiler. ECPGPlus translates each SQL statement in `my_program.pgc` into C code that calls the `ecpglib` API, and produces a C program (`my_program.c`). Then, pass the C program to a C compiler; the C compiler generates an object file (`my_program.o`). Finally, pass the object file (`my_program.o`), as well as the `ecpglib` library file, and any other required libraries to the linker, which in turn produces the executable (`my_program`).

While the ECPGPlus preprocessor validates the *syntax* of each SQL statement, it cannot validate the *semantics*. For example, the preprocessor will confirm that an `INSERT` statement is syntactically correct, but it cannot confirm that the table mentioned in the `INSERT` statement actually exists.

***Behind the Scenes***

A client application contains a mix of C code and SQL code comprised of the following elements:

- C preprocessor directives
- C declarations (variables, types, functions, ...)
- C definitions (variables, types, functions, ...)
- SQL preprocessor directives
- SQL statements

For example:

>    `1  #include <stdio.h>`
>    `2  EXEC SQL INCLUDE sqlca;`
>    `3`
>    `4  extern void printInt(char *label, int val);`
>    `5  extern void printStr(char *label, char *val);`
>    `6  extern void printFloat(char *label, float val);`
>    `7`
>    `8  void displayCustomer(int custNumber)`
>    `9  {`
>   `10    EXEC SQL BEGIN DECLARE SECTION;`
>   `11      VARCHAR  custName[50];`
>   `12      float    custBalance;`
>   `13      int      custID = custNumber;`
>   `14    EXEC SQL END DECLARE SECTION;`
>   `15
>   16    EXEC SQL SELECT name, balance`
>   `17      INTO :custName, :custBalance`
>   `18      FROM customer`
>   `19      WHERE id = :custID;`
>   `20`
>   `21    printInt("ID", custID);`
>   `22    printStr("Name", custName);`
>   `23    printFloat("Balance", custBalance);`
>   24  }

In the above code fragment:

- Line 1 specifies a directive to the C preprocessor.

  C preprocessor directives may be interpreted or ignored; the option is controlled by a command line option (`-C PROC`) entered when you invoke ECPGPlus. In either case, ECPGPlus copies each C preprocessor directive to the output file (4) without change; any C preprocessor directive found in the source file will appear in the output file.

- Line 2 specifies a directive to the SQL preprocessor.

  SQL preprocessor directives are interpreted by the ECPGPlus preprocessor, and are not copied to the output file.

- Lines 4 through 6 contain C declarations.

  C declarations are copied to the output file without change, except that each `VARCHAR` declaration is translated into an equivalent `struct` declaration.

- Lines 10 through 14 contain an embedded-SQL declaration section.

  C variables that you refer to within SQL code are known as host variables. If you invoke the ECPGPlus preprocessor in Pro*C mode (-`C PROC`), you may refer to any C variable within a SQL statement; otherwise you must declare each host variable within a `BEGIN/END DECLARATION SECTION` pair.

- Lines 16 through 19 contain a SQL statement.

  SQL statements are translated into calls to the ECPGPlus run-time library.

- Lines 21 through 23 contain C code.
  C code is copied to the output file without change.

Any SQL statement must be prefixed with `EXEC SQL` and extends to the next (unquoted) semicolon. For example:

> `printf(“Updating employee salaries\n”);`
> `EXEC SQL UPDATE emp SET sal = sal * 1.25;`
> `EXEC SQL COMMIT;`
> `printf(“Employee salaries updated\n”);`

When the preprocessor encounters the code fragment shown above, it passes the C code (the first line and the last line) to the output file without translation and converts each `EXEC SQL` statement into a call to an `ecpglib` function. The result would appear similar to the following:

> `printf("Updating employee salaries\n");`
> `{`
>   `ECPGdo( __LINE__, 0, 1, NULL, 0, ECPGst_normal,`
>          `"update emp set sal = sal * 1.25",`
>          `ECPGt_EOIT, ECPGt_EORT);`
> `}`
> `{`
>   `ECPGtrans(__LINE__, NULL, "commit");`
> `}`
> `printf(“Employee salaries updated\n”);`