---

title: "Creating an ICU Collation"
---

<div id="creating_an_icu_collation" class="registered_link"></div>

Creating an ICU collation can be done a number of different ways.

- When creating a new database cluster with the `initdb` command, the `--icu-short-form` option can be specified to define the ICU collation to be used by default by all databases in the cluster.
- When creating a new database with the `CREATE DATABASE` command, the `ICU_SHORT_FORM` parameter can be specified to define the ICU collation to be used by default in that database.
- In an existing database, the `CREATE COLLATION` command can be used with the `ICU_SHORT_FORM` parameter to define an ICU collation to be used under specific circumstances such as when assigned with the `COLLATE` clause onto selected columns of certain tables or when appended with the `COLLATE` clause onto an expression such as `ORDER BY` *`expr`* `COLLATE` "*`collation_name`*".

The following describes the various ways of creating an ICU collation.

## CREATE COLLATION

Use the `ICU_SHORT_FORM` parameter with the `CREATE COLLATION` command to create an ICU collation:

> `CREATE COLLATION collation_name (`
>   `[ LOCALE = locale, ]`
>   `[ LC_COLLATE = lc_collate, ]`
>   `[ LC_CTYPE = lc_ctype, ]`
>   `[ ICU_SHORT_FORM = icu_short_form ]`
> `);`

To be able to create a collation, you must have `CREATE` privilege on the destination schema where the collation is to reside.

For information about the general usage of the `CREATE COLLATION` command, please refer to the PostgreSQL core documentation available at:

https://www.postgresql.org/docs/11/static/sql-createcollation.html

UTF-8 character encoding of the database is required. Any `LOCALE`, or `LC_COLLATE` and `LC_CTYPE` settings that are accepted with UTF-8 encoding can be used.

**Parameters**

*`collation_name`*

> The name of the collation to be added. The collation_name may be schema-qualified.

*`locale`*

> The locale to be used. Short cut for setting `LC_COLLATE` and `LC_TYPE`. If `LOCALE` is specified, then `LC_COLLATE` and `LC_TYPE` must be omitted.

*`lc_collate`*

The collation to be used. If LC_CTYPE is specified, then LC_COLLATE must also be specified and LOCALE must be omitted.

*`lc_ctype`*

> The character classification to be used. If `LC_COLLATE` is specified, then `LC_CTYPE` must also be specified and `LOCALE` must be omitted.

*`icu_short_form`*

> The text string specifying the collation attributes and their settings. This typically consists of an ICU short form name, possibly appended with additional collation attribute/value pairs. A list of ICU short form names is available from column `icu_short_form` in system catalog `pg_catalog.pg_icu_collate_names`.

**Example**

The following creates a collation using the `LROOT` ICU short form.

```
edb=# CREATE COLLATION icu_collate_a (LOCALE = 'en_US.UTF8', ICU_SHORT_FORM = 'LROOT');
CREATE COLLATION
```

The definition of the new collation can be seen with the following `psql` command.

```
edb=# \dO
                       List of collations
    Schema    |     Name      |  Collate   |   Ctype    |  ICU
--------------+---------------+------------+------------+-------
 enterprisedb | icu_collate_a | en_US.UTF8 | en_US.UTF8 | LROOT
(1 row)
```

## CREATE DATABASE

The following is the syntax for creating a database with an ICU collation:

`CREATE DATABASE` *`database_name`*

  `[ [ WITH ] [ OWNER [=]` *`user_name`* `]`

​    `[ TEMPLATE [=]` *`template`* `]`

​    `[ ENCODING [=]` *`encoding`* `]`

​    `[ LC_COLLATE [=]` *`lc_collate`* `]`

​    `[ LC_CTYPE [=]` *`lc_ctype`* `]`

​    `[ TABLESPACE [=]` *`tablespace_name`* `]`

​    `[ CONNECTION LIMIT [=]` *`connlimit`* `]`

​    `[ ICU_SHORT_FORM [=]` *`icu_short_form`* `]];`

For complete information about the general usage, syntax, and parameters of the `CREATE DATABASE` command, please refer to the PostgreSQL core documentation available at:

https://www.postgresql.org/docs/11/static/sql-createdatabase.html

When using the `CREATE DATABASE` command to create a database using an ICU collation, the `TEMPLATE template0` clause must be specified and the database encoding must be UTF-8.

The following is an example of creating a database using the `LROOT` ICU short form collation, but sorts an uppercase form of a letter before its lowercase counterpart (CU) and treats variable characters as non-ignorable (AN).

```
CREATE DATABASE collation_db
  TEMPLATE template0
  ENCODING 'UTF8'
  ICU_SHORT_FORM = 'AN_CU_EX_NX_LROOT';
```

The following `psql` command shows the newly created database.

```
edb=# \l collation_db
                                             List of databases
     Name     |    Owner     | Encoding |   Collate   |    Ctype    |        ICU        | Access privileges
--------------+--------------+----------+-------------+-------------+-------------------+-------------------
 collation_db | enterprisedb | UTF8     | en_US.UTF-8 | en_US.UTF-8 | AN_CU_EX_NX_LROOT |
(1 row)
```

The following table is created and populated with rows in the database.

```
CREATE TABLE collate_tbl (
    id              INTEGER,
    c2              VARCHAR(2)
);

INSERT INTO collate_tbl VALUES (1, 'A');
INSERT INTO collate_tbl VALUES (2, 'B');
INSERT INTO collate_tbl VALUES (3, 'C');
INSERT INTO collate_tbl VALUES (4, 'a');
INSERT INTO collate_tbl VALUES (5, 'b');
INSERT INTO collate_tbl VALUES (6, 'c');
INSERT INTO collate_tbl VALUES (7, '1');
INSERT INTO collate_tbl VALUES (8, '2');
INSERT INTO collate_tbl VALUES (9, '.B');
INSERT INTO collate_tbl VALUES (10, '-B');
INSERT INTO collate_tbl VALUES (11, ' B');
```

The following query shows that the uppercase form of a letter sorts before the lowercase form of the same base letter, and in addition, variable characters are taken into account when sorted as they appear at the beginning of the sort list. (The default behavior for `en_US.UTF-8` is to sort the lowercase form of a letter before the uppercase form of the same base letter, and to ignore variable characters.)

```
collation_db=# SELECT id, c2 FROM collate_tbl ORDER BY c2;
 id | c2
----+----
 11 |  B
 10 | -B
  9 | .B
  7 | 1
  8 | 2
  1 | A
  4 | a
  2 | B
  5 | b
  3 | C
  6 | c
(11 rows)
```

## initdb

A database cluster can be created with a default ICU collation for all databases in the cluster by using the `--icu-short-form` option with the `initdb` command.

For complete information about the general usage, syntax, and parameters of the `initdb` command, please refer to the PostgreSQL core documentation available at:

https://www.postgresql.org/docs/11/static/app-initdb.html

The following illustrates this process.

```
$ su enterprisedb
Password:
$ /usr/edb/as11/bin/initdb -U enterprisedb -D /tmp/collation_data --encoding UTF8 --icu-short-form 'AN_CU_EX_NX_LROOT'
The files belonging to this database system will be owned by user "enterprisedb".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

creating directory /tmp/collation_data ... ok
creating subdirectories ... ok
    .
    .
    .
Success. You can now start the database server using:

    /usr/edb/as11/bin/edb-postgres -D /tmp/collation_data
or
    /usr/edb/as11/bin/pg_ctl -D /tmp/collation_data -l logfile start
```

The following shows the databases created in the cluster which all have an ICU collation of `AN_CU_EX_NX_LROOT`.

```
edb=# \l
                                                  List of databases
   Name    |    Owner     | Encoding |   Collate   |    Ctype    |        ICU        |       Access privileges
-----------+--------------+----------+-------------+-------------+-------------------+-------------------------------
 edb       | enterprisedb | UTF8     | en_US.UTF-8 | en_US.UTF-8 | AN_CU_EX_NX_LROOT |
 postgres  | enterprisedb | UTF8     | en_US.UTF-8 | en_US.UTF-8 | AN_CU_EX_NX_LROOT |
 template0 | enterprisedb | UTF8     | en_US.UTF-8 | en_US.UTF-8 | AN_CU_EX_NX_LROOT | =c/enterprisedb              +
           |              |          |             |             |                   | enterprisedb=CTc/enterprisedb
 template1 | enterprisedb | UTF8     | en_US.UTF-8 | en_US.UTF-8 | AN_CU_EX_NX_LROOT | =c/enterprisedb              +
           |              |          |             |             |                   | enterprisedb=CTc/enterprisedb
(4 rows)
```

