---

title: "Array Binding"
---

<div id="array_binding" class="registered_link"></div>

Advanced Server's array binding functionality allows you to send an array of data across the network in a single round-trip. When the back end receives the bulk data, it can use the data to perform insert or update operations.

Perform bulk operations with a prepared statement; use the following function to prepare the statement:

> `PGresult *PQprepare(PGconn *conn,`
>
> ​                    `const char *stmtName,`
>
> ​                    `const char *query,`
>
> ​                    `int nParams,`
>
> ​                    `const Oid *paramTypes);`

Details of `PQprepare()` can be found in the prepared statement section.

The following functions can be used to perform bulk operations:

- PQBulkStart (see Section [6.3.1](https://www.enterprisedb.com/edb-docs/d/edb-postgres-advanced-server/user-guides/user-guide/11/EDB_Postgres_Advanced_Server_Guide.1.068.html#pID0E0SQB0HA))
- PQexecBulk (see Section [6.3.2](https://www.enterprisedb.com/edb-docs/d/edb-postgres-advanced-server/user-guides/user-guide/11/EDB_Postgres_Advanced_Server_Guide.1.068.html#pID0E0KQB0HA))
- PQBulkFinish (see Section [6.3.3](https://www.enterprisedb.com/edb-docs/d/edb-postgres-advanced-server/user-guides/user-guide/11/EDB_Postgres_Advanced_Server_Guide.1.068.html#pID0E0BQB0HA))
-  PQexecBulkPrepared (see Section [6.3.4](https://www.enterprisedb.com/edb-docs/d/edb-postgres-advanced-server/user-guides/user-guide/11/EDB_Postgres_Advanced_Server_Guide.1.068.html#pID0E03PB0HA))

## PQBulkStart

`PQBulkStart()` initializes bulk operations on the server. You must call this function before sending bulk data to the server. `PQBulkStart()` initializes the prepared statement specified in stmtName to receive data in a format specified by `paramFmts`.

**API Definition**

> `PGresult * PQBulkStart(PGconn *conn,`
>
> ​                       `const char * Stmt_Name,`
>
> ​                       `unsigned int nCol,`
>
> ​                       `const int *paramFmts);`

## PQexecBulk

`PQexecBulk()` is used to supply data (`paramValues`) for a statement that was previously initialized for bulk operation using `PQBulkStart()`.

This function can be used more than once after `PQBulkStart()` to send multiple blocks of data. See the example for more details.

**API Definition**

> `PGresult *PQexecBulk(PGconn *conn,`
>
> ​                     `unsigned int nRows,`
>
> ​                     `const char *const * paramValues,`
>
> ​                     `const int *paramLengths);`

## PQBulkFinish

This function completes the current bulk operation. You can use the prepared statement again without re-preparing it.

**API Definition**

> `PGresult *PQBulkFinish(PGconn *conn);`

## PQexecBulkPrepared

Alternatively, you can use the `PQexecBulkPrepared()` function to perform a bulk operation with a single function call. `PQexecBulkPrepared()` sends a request to execute a prepared statement with the given parameters, and waits for the result. This function combines the functionality of `PQbulkStart()`, `PQexecBulk()`, and `PQBulkFinish()`. When using this function, you are not required to initialize or terminate the bulk operation; this function starts the bulk operation, passes the data to the server, and terminates the bulk operation.

Specify a previously prepared statement in the place of `stmtName`. Commands that will be used repeatedly will be parsed and planned just once, rather than each time they are executed.

API Definition

> `PGresult *PQexecBulkPrepared(PGconn *conn,`
>
> ​                             `const char *stmtName,`
>
> ​                             `unsigned int nCols,`
>
> ​                             `unsigned int nRows,`
>
> ​                             `const char *const *paramValues,`
>
> ​                             `const int *paramLengths,`
>
> ​                             `const int *paramFormats);`

## Example Code (Using PQBulkStart, PQexecBulk, PQBulkFinish)

The following example uses `PGBulkStart`, `PQexecBulk`, and `PQBulkFinish`.

```
void InsertDataUsingBulkStyle( PGconn *conn )
{
    PGresult            *res;
    Oid                 paramTypes[2];
    char                *paramVals[5][2];
    int                 paramLens[5][2];
    int                 paramFmts[2];
    int                 i;

    int                 a[5] = { 10, 20, 30, 40, 50 };
    char                b[5][10] = { "Test_1", "Test_2", "Test_3",  "Test_4", "Test_5" };


    paramTypes[0] = 23;
    paramTypes[1] = 1043;
    res = PQprepare( conn, "stmt_1", "INSERT INTO testtable1 values( $1, $2 )", 2, paramTypes );
    PQclear( res );

    paramFmts[0] = 1;   /* Binary format */
    paramFmts[1] = 0;

    for( i = 0; i < 5; i++ )
    {
        a[i] = htonl( a[i] );
        paramVals[i][0] = &(a[i]);
        paramVals[i][1] = b[i];

        paramLens[i][0] = 4;
        paramLens[i][1] = strlen( b[i] );
    }

	res = PQBulkStart(conn, "stmt_1", 2, paramFmts);
	PQclear( res );
	printf( "< -- PQBulkStart -- >\n" );

	res = PQexecBulk(conn, 5, (const char *const *)paramVals, (const int *)paramLens);
	PQclear( res );
	printf( "< -- PQexecBulk -- >\n" );

	res = PQexecBulk(conn, 5, (const char *const *)paramVals, (const int *)paramLens);
	PQclear( res );
	printf( "< -- PQexecBulk -- >\n" );

	res = PQBulkFinish(conn);
	PQclear( res );
	printf( "< -- PQBulkFinish -- >\n" );
}
```

## Example Code (Using PQexecBulkPrepared)

The following example uses `PQexecBulkPrepared`.

```
void InsertDataUsingBulkStyleCombinedVersion( PGconn *conn )
{
	PGresult            *res;
	Oid                 paramTypes[2];
	char                *paramVals[5][2];
	int                 paramLens[5][2];
	int                 paramFmts[2];
	int                 i;

	int                 a[5] = { 10, 20, 30, 40, 50 };
	char                b[5][10] = { "Test_1", "Test_2", "Test_3", "Test_4", "Test_5" };

	paramTypes[0] = 23;
	paramTypes[1] = 1043;
	res = PQprepare( conn, "stmt_2", "INSERT INTO testtable1 values( $1, $2 )", 2, paramTypes );
	PQclear( res );

	paramFmts[0] = 1;   /* Binary format */
	paramFmts[1] = 0;

	for( i = 0; i < 5; i++ )
	{
		a[i] = htonl( a[i] );
		paramVals[i][0] = &(a[i]);
		paramVals[i][1] = b[i];

		paramLens[i][0] = 4;
		paramLens[i][1] = strlen( b[i] );
	}

res = PQexecBulkPrepared(conn, "stmt_2", 2, 5, (const char *const *)paramVals,(const int *)paramLens, (const int *)paramFmts);
	PQclear( res );
}
```

